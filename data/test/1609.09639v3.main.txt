# List of abbreviations

The following table describes the significance of various abbreviations
and acronyms used throughout the thesis.

## Chapter 1 Introduction to the non-linear optics

### 1.1 What is non-linear optics?

When you immerse a solid, either an insulator or a semiconductor, in an
electric field (see Fig. 1.1 ), the dipoles inside the material get
orientated along the field lines and create an internal field,

the polarisation @xmath , opposite to the field that generates it. This
naive picture, even if not correct for extended systems, gives us an
idea of the effect of an external electric field on a material. The
total electric field inside the solid @xmath is the sum of the external
plus the polarisation one:

  -- -------- -- -------
     @xmath      (1.1)
  -- -------- -- -------

This equation is one of the so-called ”Materials equations”, namely the
Maxwell equations for electric and magnetic fields in bulk materials,
where @xmath is the Electric Displacement and @xmath is the Total
Electric Field. In order to understand the origin of these two fields,
it is possible to write down their corresponding Gauss’s equations:

  -- -------- --
     @xmath   
  -- -------- --

From the above equations one can see that the Electric Displacement is
generated by the external charges while the Electric Field is due to the
sum of external plus the internal ones, namely the total charge. This
explains the structure of Eq. 1.1 being the total field equal to the
external one minus the polarisation that is the field generated by the
internal charges and opposed to the external one. In general we can
expand the polarisation @xmath in a power series of the total electric
field @xmath :

  -- -------- -- -------
     @xmath      (1.2)
  -- -------- -- -------

where @xmath is the intrinsic polarisation of the material and @xmath
are the response functions of increasing order. Equation 1.2 is valid
for a wide range of situations. However there are cases where this
expansion is not valid: 1) for very strong fields, beyond the
convergence radius of the expansion [ LKS @xmath 14 ] ; 2) when there is
an hysteresis and therefore there is not a univocal relation between
polarisation and electric field; 3) close to phase transitions where a
small external field can completely change the material properties. In
this thesis we will not consider any of these cases but we will
concentrate on the ”simpler” one, when the relation between polarisation
and electric field can be written in a power series. Moreover in the
present work we will always assume @xmath because we are not interested
in materials with intrinsic polarisation as for instance ferroeletrics.

After all these elucidations it is time to introduce non-linear optics.
If in Eq. 1.2 we limit the power series to the first term @xmath we can
describe all the phenomena which belong to the linear optics regime. All
the other terms @xmath describe the non-linear response. What does
non-linear response mean in practice? The simplest non-linear phenomena,
we obtain from the additional terms, can be easily understood if we
rewrite Eq. 1.2 in frequency domain for an homogeneous material:

  -- -------- -- -------
     @xmath      (1.3)
  -- -------- -- -------

From the first term of the RHS we immediately realise that the outgoing
light [i.e. the polarisation @xmath ] has the same frequency @xmath of
the incoming one [i.e. the electric filed @xmath ]. On the contrary
terms beyond the linear one contain sum or difference of many electric
fields and therefore the outgoing light could have a different
frequency, namely a colour different from the incoming one. For example
in the second harmonic generation(SHG), the outgoing light has a
frequency that is two times larger than the incoming one.
This simple effect, even it is easy to understand and visualise, it is
not something evident in our everyday lives. In fact the non-linear
coefficients of the polarisation expansion are very small, and therefore
in order to obtain a detectable non-linear response one needs a strong
light source. This is the reason why the first experimental measurement
of second-harmonic generation (SHG) dates 1961 [ FHPW61 ] , just few
years after the laser invention. [ Mai60 ] In this first experiment of
non-linear optics Franken and his collaborators were able to obtain a
SHG signal from a ruby crystal employing a monochromatic laser beam with
an intensity of @xmath volts/cm, see Fig. 1.2 .
Nowadays lasers with an intensity equivalent to the one used in the
Franken’s experiment are commercial available in shops, and SHG became a
common technique to double the laser frequency.
Of course non-linear optics is not limited to the SHG but the term
covers a large spectra of phenomena spanning saturation, sum frequency
generation, high harmonic and so on. In the next section we will show
some usages and applications of non-linear response.

### 1.2 What can be done with non-linear optics?

In the last thirty years the field of non-linear spectroscopy [ Blo82 ]
made progresses in leaps and bounds. The simplest commercial application
that everybody knows, is the green laser pointer used in conferences. In
this device the green light is obtained combining a red laser with a
non-linear crystal that doubles the frequency, see Fig. 1.3 . Nowadays
non-linear crystals are routinely used in laboratories to change shape,
length and intensity of laser beams.
Applications of non-linear optics are not limited to physics, they range
from optoelectronics to medicine.
For example nanocrystals with non-linear properties can be bounded to
proteins and then inserted in living systems. They become a tool to
probe protein dynamics. In fact under intense illumination, such as the
focus of a laser-scanning microscope, these SHG nanocrystals modify the
light colour and thus they can be imaged by means of the two-photon
microscopy. Since biological tissue do not present a particular
non-linear response, scientists can visualise the dynamics of the
proteins thanks to the nanocrystals. Unlike commonly used fluorescent
probes, SHG nanoprobes neither bleach nor blink. The resulting contrast
and detectability of SHG nanoprobes provided therefore unique advantages
for molecular imaging of living cells and tissues. [ PMWF10 ]

In quantum optics, non-linear crystals are used to create entangled
photons. A photon at high energy is transformed in two or more photons
with lower energy by means of reverse second or third harmonic
generation. These news outgoing photons can be used in quantum
information studies, quantum cryptography or for quantum computation,
due to their entangled states. [ KMW @xmath 95 ]

In condensed matter the non-linear response remains an essential tool to
characterise and explore electronic and structural properties of
materials. For example, since second harmonic generation can be produced
only in materials that lack of inversion symmetry, it became a tool to
probe phase transitions and phenomena the break this symmetry.
In presence of a macroscopic electric field as the one of
piezoelectrics, pyroelectrics, and ferroelectrics or a bulk
magnetizations as in ferromagnets the inversion symmetry is broken and a
simple SHG measurement as function of the temperature can be used to
discriminate between the different phases of these materials. In Fig.
1.4 it is shown how the SHG signal changes with the temperature in the
ferroelectric BaTiO @xmath . At 120° C there is no more signal and the
change is very abrupt. This confirms that 120° C is the temperature
where inversion symmetry is restored in BaTiO @xmath crystal as it loses
its ferroelectric properties.
Another import application of non-linear response is the
characterisation of surfaces and interfaces. Since SHG is much more
sensitive to the lattice orientation, compared with linear optics, it
can be used to scan a layer deposited on a surface and to identify
dimension and orientation of the different flakes. In a recent
experiment [ YYC @xmath 14 ] X. Yin et al. used this idea to develop a
nonlinear optical imaging technique that allows a rapid and all-optical
determination of the crystal orientations in 2D materials at a large
scale. In Fig. 1.5 one sees the main results of X. Yin et al., on the
left there is an image of a single-layer of MoS @xmath in linear optics
and on the right a SHG image of the same layer, where the different
colours represent different intensity of the SHG response. The flakes
and their orientation are clearly visible in the SHG image.

Instead, Y. Li at al. used SHG to probe the number of layers deposited
on a surface, using the fact that an even number of layers posses
inversion symmetry while an odd one does not. [ L @xmath 13 ]
Another domain where SHG plays a major role is surface spectroscopy. One
of the problem occurring to experimentalists is to disentangle bulk from
surface contribution in their measurements. SHG is one of the few
techniques that can probe the surface without the contributions from the
bulk. The reason lies in the fact that in solids with inversion
symmetries the bulk contribution is zero and the only source of SHG is
the surface one. This is true not only for bulk materials but also for
liquids that are in average symmetric but not at the liquid-liquid or
gas-liquid interfaces. In this cases SHG provides great insights on the
surface structure that sometime are difficult to probe with other
techniques. [ Eis96 ]
The importance of non-linear response for solids characterisation is not
limited to the SHG, but also other response functions find applications
in condensed matter physics. For example two-photon absorption that is
proportional to the imaginary part of the @xmath can be used to probe
excited states that are dark in linear optics. [ WDBH05 , CVG15 ]
Finally we want to conclude this section showing some negative sides of
the non-linear response. While in many applications the non-linear
response is the desired effect, there are cases where one tries to avoid
any non-linear phenomena. For example one of the limiting factor of the
light power that can be transported by optical fibers is the
self-focusing phenomena. Self-focusing is a non-linear optical process
generated by the third harmonic response in materials exposed to intense
electromagnetic radiation. A medium whose refractive index is modified
by the @xmath response acts as a focusing lens for an electromagnetic
wave characterised by an initial transverse intensity gradient, as the
one generated by a laser beam (see Fig. 1.6 ).

The peak intensity of the self-focused region keeps increasing as the
wave travels through the medium until medium damage interrupts this
process. At present no method is known for increasing the self-focusing
limit in optical fibers [ Pho ] .

In this section we covered a minimal part of the positive and negative
non-linear phenomena in research and applications, for a general
overview different books and reviews are available in literature. [
Boy08 , Blo82 ]

### 1.3 How to calculate non-linear response

The first attempt to calculate non-linear optical response in solids
from a quantum mechanics was done by means of density matrix formalism.
[ BS64 ] This formalism was already used in the past to derive local
field effects in linear optics [ Adl62 , Wis63 ] , to investigate a
non-linear phenomena like saturation of microwave resonances [ KS48 ] ,
and to describe nuclear magnetic relaxation [ KT54 , Hub61 , Blo56 ] .
One particular advantage of this formalism is that it allows to include
damping in an easy way.
The Hamiltonian that enters in the equations of motion(EOM) [Eq. 1.4 ]
for the density matrix [ VN27 ] can be decomposed in three parts: @xmath
that determines the unperturbed energy levels of the system, @xmath that
describes the coupling with the external perturbation, in our case a
monochromatic electro-magnetic field, and finally @xmath that includes
all relaxation processes.
We can thus write down the EOM for the density matrix as:

  -- -------- -- -------
     @xmath      (1.4)
  -- -------- -- -------

The last term of this equation is the one generated by the random
processes @xmath and it is due to the coupling with phonon modes,
external environments or generated by the electronic correlation. In the
literature different phenomenological models have been proposed for the
damping therm, the simplest one is:

  -- -------- -- -------
     @xmath      (1.5)
  -- -------- -- -------

Where the anti-commutator on the RHS is generated by the non-Hermitian
part of the Hamiltonian. [ Tok09 ]
A steady-state solution for EOM [Eq. 1.4 ] in ascending powers of the
coupling term may be found from the following hierarchy equations:

  -- -------- -------- -------- -- -------
     @xmath   @xmath   @xmath      (1.6)
     @xmath   @xmath   @xmath      (1.7)
     @xmath   @xmath   @xmath      (1.8)
  -- -------- -------- -------- -- -------

The first equation gives the density matrix at equilibrium. The second
equation describes the linear response. By Fourier analysis it is easy
to show that @xmath must contain the same frequencies as @xmath . The
@xmath is the first non-linear term. Differently from @xmath , @xmath
oscillates at a frequency that can be the sum or difference of the
incoming fields. This term describes second harmonic generation and
optical rectification and the dc term. The other terms @xmath ,
describes higher harmonic generations, saturation phenomena and so on.
From these hierarchy equations it is possible to derive the
corresponding equations for the response functions @xmath , @xmath … by
differentiating the density matrix respect to the external perturbation.
Density matrix formalism is not the only possibility to calculate
non-linear response. Expressions for the second order response functions
can be also derived directly from perturbation theory. [ CJWL97 , Lev90
, LHV10 ]
In the both the methods mentioned above, the response functions and
their corresponding Dyson equations are generally expressed by means of
sum over states, i. e. valence and conduction bands.
Expressing response functions in terms of valence and conduction bands
has the advantage to make easy the interpretation of the different peaks
appearing in the @xmath , @xmath …., however calculations can become
prohibitive as the number of bands and k-points increases. For this
reason, some groups took a different road to calculate non-linear
response functions. Dal Corso and Mauri used the ”2n+1” theorem in the
time-dependent density functional theory (TDDFT) framework to calculate
static nonlinear susceptibilities avoiding the sum over states. [ DCM94
] Other groups used a frequency dependent Sternheimer equation to obtain
dynamic polarisabilities and hyperpolarizabilities in molecular systems.
[ ABMR07 ]
Finally there is the possibility to follow in real-time the excitation
of the system, by solving Eq. 1.5 and then analysing the outgoing
polarisation or current. Although the real-time solution has a better
scaling with the system size than previous mentioned approaches, it is
not so common in the scientific literature. The reasons are twofold:
first the real-time solution has a large prefactor in the computational
time and therefore only for large systems it starts to become more
convenient, and second results analysis is more involved that in the
other methods.
However in last years different works appeared in the literature that
use real-time propagation to calculate non-linear response both for
molecular [ TVR07 , DVKEL13 ] and periodic systems. [ Gon13 ]
In the next chapters I will present a new real-time approach to study
non-linear response in extended systems that offers different advantages
respect the previous methods. [ AG13 ]

#### 1.3.1 Correlation effects and non-linear response

Until now we discussed how to calculate non-linear response but we did
not say anything about correlation effects neither on the Hamiltonian
that appears in Eq. 1.5 . In this section we briefly outline the
different approaches used in the past to take into account these effects
in the non-linear response.
The first calculations of non-linear response were based on empirical
pseudo-potentials, often underestimating or overestimating the
experimental values by one or two order of magnitudes. [ FS75 , MSvD87 ]
In the nineties Levine [ Lev90 ] presented for the first time an
ab-initio formalism for the calculation of the second-harmonic
generation. Sipe and coworkers extended the calculation of non-linear
response to the third harmonic generation eliminating unphysical
divergences that are present in the velocity gauge. [ SS00 , SG93 ]
Calculations based on ab-initio band structures already improved results
respect to previous approaches, however correlation effects were not
taken in account yet. Few years later, again Levine and coworkers
presented the first calculations of the second harmonic generation
including local-field effects and self-energy effects by means of a
scissor operator. [ LA89 , CJWL97 ]
Beyond these effects only a few works included electron-hole interaction
in the non-linear response. In particular excitonic effects have been
derived by Green’s function theory and included by means of
generalisations of Bethe-Salpeter equation (BSE) [ Str88 ] to higher
order response functions. Following this idea Chang et al. [ CSL01 ] and
Leitsman et al. [ LSHB05 ] presented an ab-initio many body framework
for computing the frequency dependent second-harmonic generation that
includes local fields and excitonic effects through an effective
two-particle Hamiltonian derived from the BSE and found a good agreement
with the experimental results.
More recently Hubener [ H1̈1 ] presented a full Bethe-Salpeter equation
for the second order response functions, while Virk and Sipe derived a
similar equation for the third harmonic generation. [ CJWL97 ]
Another possible way to include correlation effects, alternative to the
Green’s function theory, is Time-Dependent Density Functional Theory
(TDDFT) [ RG84 ] . TDDFT is in principle an exact theory to calculate
response functions in finite systems. However the exchange-correlation
functional that enters in the equations is unknown and has to be
approximated. Standard approximations that rely on local or semi-local
functionials miss long range contributions that are responsible of
excitonic effects [ BSDSR07 ] . Long range contribution can be included
in reciprocal or real-space or obtained by means of hybrid functionals [
BSDSR07 , FBA @xmath 14 ] . For extended systems the situation is more
complicated since TDDFT is not an exact theory for the optical response
(see Chapter 4 for a discussion).
Despite of these problems, TDDFT has been used to calculate linear and
non-linear response functions in both finite and extended systems, often
with very good results, and also in its real-time formulation. [ TVR07 ,
ABMR07 ]

## Chapter 2 Dynamical Berry’s phase and non-linear response

### 2.1 Why do we need Berry’s phase?

This section presents a simple introduction to the problem of
polarisation definition in extended systems and how it can be solved by
means of Berry’s phase concept.

For many years an unsolved problem in solid state physics was the
correct definition of polarisation in periodic systems. This definition
is intrinsically related to the one the dipole operator, that is a
problematic object for extended systems. In the literature different
wrong definitions of bulk polarisation have been proposed that we will
not cite here [ Res ] . In order to understand the problem, let’s start
the discussion from the polarisation in isolated systems. In a system
with open boundary conditions, the dipole operator is well defined and
therefore one can write down the polarisation as:

  -- -------- -- -------
     @xmath      (2.1)
  -- -------- -- -------

where @xmath is the electronic density. The simplest idea for the
definition of the polarization in periodic systems would be to
generalise the previous formula. The integral in Eq. 2.1 can be
redefined in different possible ways in periodic systems. We can average
the dipole operator on the whole material or consider its unit cell. In
the first case we obtain @xmath . In an insulator the contributions from
the dipoles inside the material cancel each other (as one can see from
Fig. 1.1 ) and only the surfaces contribute to the total polarisation
(see Fig. 2.1 ):

  -- -------- -- -------
     @xmath      (2.2)
  -- -------- -- -------

where @xmath is related to the charges accumulated on the surfaces. [
VKS93 ] This definition [Eq. 2.2 ] is not suitable for numerical
calculations because it requires the simulation of the entire sample and
moreover the above defined polarisation is not a bulk property but it
depends from the surfaces.
The second possibility is to define the polarisation as @xmath . But
this definition is completely arbitrary. In fact different choices of
the unit cell give completely different polarisations for the same
material, see Fig. 2.2 . A last possibility exists, the use of the
dipole matrix elements in terms of Bloch orbitals, but also in this case
there is problem since the dipole operator is unbounded in periodic
systems.

Finally let mention that also the well know Clausius-Mossotti formula
for the polarisability [ CM ] cannot be used in real solids because
wave-functions are not localised objects.
Two reasons make polarisation definition so difficult in solids. First
the dipole operator is ill defined in periodic systems, because @xmath
is not periodic while wave-functions are. Second, differently from
finite systems, the polarisation cannot be expressed as an integral on
the charge density [ MO98 ] . This second aspect can be better
understood if we write down the general relation between polarisation
and density:

  -- -------- -- -------
     @xmath      (2.3)
  -- -------- -- -------

In finite systems we impose the condition @xmath outside the sample
(Dirichlet boundary condition) and @xmath . In periodic system, it is
most useful to resolve the previous equation into Fourier components
@xmath , where @xmath denotes a reciprocal lattice vector and @xmath
belongs to the first Brillouin zone(BZ):

  -- -------- -- -------
     @xmath      (2.4)
  -- -------- -- -------

It follows from Eq. 2.4 that each Fourier component can be treated
separately. Now let us consider the limit @xmath and @xmath . In this
limit the macroscopic polarisation @xmath is not determined anymore by
the zero Fourier component of the density, which must vanish by charge
neutrality. Thus in the limit @xmath for an infinite crystal, the
polarisation contains additional information not included in the
density. [ MO98 ]
The problem of a correct definition of polarisation in periodic systems
was solved in 1993 by King-Smith and Vanderbilt. [ KSV93 ] In their
seminal paper they shown that bulk polarisation can be expressed as a
closed integral on the wave-function phase in the Brillouin zone, a
particular case of the Berry’s phase. Their formulation solved all
problems with the previous attempts to define the polarisation. In fact
the King-Smith and Vanderbilt(KSV) polarisation is a bulk quantity, its
time derivative gives the current and its derivatives respect to the
external field reproduce the polarisabilities at all orders.
In the next section we will introduce the Berry’s phase concept and will
present the KSV formula.

### 2.2 A simple introduction to the Berry’s phase

In this section we will introduce the Berry’s phase concept [ Ber84 ]
and show by means of simple arguments which is its relation with the
bulk polarisation.

We will not present the full derivation of the King-Smith and Vanderbilt
formula for the polarisation but we will explain the physical meaning of
the different terms appearing in the formula and how they are related to
the Berry’s phase.
Mathematical derivation of the KSV polarisation can be found in their
original paper [ KSV93 ] or in its generalisation to the many-body case
[ Res98 ] .
Suppose you have an Hamiltonian @xmath that depends from an external
parameter @xmath . For each value of @xmath it is possible to
diagolalise the Hamiltonian and obtain:

  -- -------- -- -------
     @xmath      (2.5)
  -- -------- -- -------

where @xmath and @xmath are respectively the eigenvalue and eigenstate
of @xmath for a fixed value of @xmath . Now we can define the phase
difference between two ground states with different @xmath values as:

  -- -------- -------- -------- -- -------
     @xmath   @xmath   @xmath      (2.6)
     @xmath   @xmath   @xmath      (2.7)
  -- -------- -------- -------- -- -------

This definition is similar to the one used in geometry to define the
angle between two vectors. Unfortunately @xmath cannot have a physical
meaning, because the phase of the wave-function is arbitrary and so the
phase difference. However if we construct a closed-path in the space
spanned by the @xmath parameter we get something new:

  -- -------- -------- -------- -------- -------
     @xmath   @xmath   @xmath            (2.8)
                       @xmath   @xmath   
  -- -------- -------- -------- -------- -------

Now the total phase change @xmath is gauge invariant because each
wave-function appears both as ket and bra in the previous formula. In
physics a gauge-invariant object is a potential physical observable, as
for instance the eigenvalues of an Hermitian operator. However @xmath is
an ”exotic” observable because it cannot be expressed in term of any
Hermitian operator. The reason for the existence of this strange kind of
observables lies in the fact that the Hamiltonian is not isolated and
the parameter @xmath represents the coupling with ”the rest of the
universe” (to use a sentence from Berry’s paper). In a truly isolated
system there cannot be any manifestation of the Berry’s phase and all
observables are eigenvalues of an Hermitian operator.

Different phenomena can be described in terms of Berry’s phase, as for
instance the Aharonov-Bohm effect [ WS89 ] , the Wannier-Stack ladder
spectra of semi-classical electrons [ Zak89 ] , and the Molecular
Aharonov-Bohm Effect. ¹ ¹ 1 The interpretation of this phenomena in
terms of Berry’s phase has been questioned in recent years. For a
discussion see Ref. [ MAKG14 ] and references there in.
Now we will show that also the polarisation in periodic systems can be
expressed as a Berry’s phase integral. We start from the simple case of
non-interacting electrons. The solution of a single particle Schrödinger
equation in an infinite crystal reduces to the one of the primitive cell
with Born-von-Karman boundary conditions:

  -- -------- -- -------
     @xmath      (2.9)
  -- -------- -- -------

where @xmath are solution of:

  -- -------- -- --------
     @xmath      (2.10)
  -- -------- -- --------

The Bloch theorem [ Blo29 ] guarantees that these wave-functions can be
expressed as:

  -- -------- -- --------
     @xmath      (2.11)
  -- -------- -- --------

where @xmath obeys to periodic boundary conditions. If we now insert the
Bloch wave-functions Eq. 2.11 in Eq. 2.10 we get a new equation for the
periodic orbitals @xmath :

  -- -- -- --------
           (2.12)
  -- -- -- --------

In this new equation we mapped a problem with @xmath -dependent boundary
conditions in a new problem with periodic boundary condition plus an
Hamiltonian that depends parametrically on @xmath .

A careful reader will now recognise that we are back to a situation
similar to the one presented in section 2.2 , an Hamiltonian that
depends from an external parameter @xmath . The question arises as which
physical observable represents the phase change generated by a closed
path in the @xmath space. This question was answered for the first time
in 1993 by King-Smith and Vanderbilt. [ KSV93 ] They shown that the
observable associated to the Berry’s phase of the @xmath vector is the
polarisation. Their formula reads:

  -- -------- -- --------
     @xmath      (2.13)
  -- -------- -- --------

where M is the number of valence bands, and the integral is performed
along the Brillouin zone, as shown in Fig. 2.4 .

The KSV polarisation [Eq. 2.13 ] is the natural extention to periodic
systems of the well known formula [Eq. 2.1 ] for isolated ones. In order
to see this let’s rewrite explicitly all terms appearing in both
formula:

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (2.14)
     @xmath   @xmath   @xmath      (2.15)
  -- -------- -------- -------- -- --------

We can see here that in periodic systems the dipole operator is replaced
by @xmath , the volume of the system by the one of the cell @xmath and
the integral on the wave-functions is split in a sum on k-points plus an
integral for each k-point. Notice that the dipole operator as derivative
respect to the @xmath -point will appear again in the equation of motion
when we define the Hamiltoanian in presence of an external electric
field (see Sec. 2.4.1 )
The previous formula has been also extended to the case of a finite
k-point sampling and more dimensions. The integral in dimensions larger
than one is performed along periodic lines in the BZ and summed up along
the perpendicular directions (see Section 2.4.1 ). King-Smith and
Vanderbilt demonstrated the validity of Eq. ( 2.13 ) by means of Wannier
functions. They supposed that is possible to map Bloch orbitals in
maximal localised Wannier functions then wrote the polarisation in terms
of the last ones, and finally show that this is equivalent to the Eq. (
2.13 ). Another proof was proposed some years later by R. Resta that
generalised the previous formula to the many-body case and show that it
reproduces the integral of the total current. [ Res98 ]
Now that we introduced the relation between Berry’s phase and
polarisation we are ready to use it for the non-linear response. In the
next sections we will introduce the non-linear response in solids and
present a new real-time formalism to calculate it.

### 2.3 General introduction

Ab-initio approaches based on Green’s function theory became a standard
tool for quantitative and predictive calculations of linear response
optical properties in Condensed Matter. In particular, the
state-of-the-art approach combines the @xmath approximation for the
quasi-particle band structure [ AG98 ] with the Bethe-Salpeter equation
in static ladder approximation for the response function. [ Str88 ] This
approach proved to effectively and accurately account for the essential
effects beyond independent particle approximation (IPA) in a wide range
of electronic systems, including extended systems with strong excitonic
effects. [ ORR02 ]

In contrast, for nonlinear optics ab-initio calculations of extended
systems rely in large part on the IPA [ SG93 ] with correlation effects
entering at most as a rigid shift of the conduction energy levels [ CME
@xmath 09 ] . Within time-dependent density-functional theory (TDDFT),
it has been recently proposed [ LHV10 ] an approach to calculate the
second-harmonic generation (SHG) in semiconductors that takes into
account as well crystal local-field and excitonic effects. However, this
promising approach [ CBB @xmath 12 ] is limited by the treatment of the
electron correlation to systems with weakly bound excitons. [ BSV @xmath
04 ]

Within Green’s function theory the inclusion of many-body effects into
the expression for the nonlinear optical susceptibilities is extremely
difficult. Furthermore the complexity of these expressions grows with
the perturbation order. Therefore it is not surprising that there have
been only few isolated attempts to calculate second-order optical
susceptibility using the Bethe-Salpeter equation [ LSHB05 , CSL01 ] and
no attempt to calculate higher-order optical susceptibilities. [ VS09 ]

Alternatively to the frequency-domain response-based approach, one can
obtain the nonlinear optical susceptibility in time-domain from the
dynamical polarisation @xmath of the system by using the expansion of
@xmath in power of the applied field

  -- -------- -- --------
     @xmath      (2.16)
  -- -------- -- --------

This strategy is followed in several real-time implementations of TD-DFT
[ YB96 ] . In these approaches the dynamical polarisation is obtained by
numerical integration of the equations of motion (EOMs) for the
Kohn-Sham system. [ TVR07 , CMR04 , MK08 ] So far applications regard
mostly nonlinear optical properties in molecules.

The time-domain approach presents three major advantages with respect to
frequency-domain response-based approaches. First, many-body effects are
included easily by adding the corresponding operator to the effective
Hamiltonian. Second, it is not perturbative in the external fields and
therefore it treats optical susceptibilities at any order without
increasing the computational cost and with the only limitation dictated
by the machine precision. Third, several non-linear phenomena and thus
spectroscopic techniques are described by the same EOMs. For instance,
by the superposition of several laser fields one can simulate sum- and
difference-frequency harmonic generation, or four-waves mixing. [ Boy08
]

Although this approach shows very promising results for molecular
systems, its extention to periodic system remains still limited. In
fact, due to the problems in defining the position operator and thus
@xmath , it is not trivial to apply Eq. ( 2.16 ) to systems in which
periodic boundary conditions (PBC) are imposed. As it was recognised for
example in Ref. [ AS95 ] , the same problem appears in the direct
evaluation of the nonlinear optical susceptibility in frequency-response
based approaches. In particular the dipole matrix elements between the
periodic part of the Bloch functions are ill-defined when using the
standard definition of the position operator. In that case, it is
possible to obtain correct expressions for the dipole matrix elements
from perturbation theory [ AS95 , SG93 , LHV10 , KKSP @xmath 15 ] at a
given order in the external field. Instead, in the real-time approach
one needs an expression valid at each order of the perturbation.

A correct definition of the polarisation operator in systems with PBC
has been introduced by means of the geometric Berry phase in the Modern
theory of polarisation. [ Res94 ] To our knowledge different schemes for
calculating the electron-field coupling consistently with PBC have been
proposed in Refs. [ SK08 , VS07 , SInV04 , KKSP @xmath 15 ] . In those
works the dipole matrix elements are evaluated numerically from the
derivative in the crystal-momentum ( @xmath ) space. The latter cannot
be carried out trivially because of the freedom in the gauge of the
periodic part of the Bloch functions. In fact, the gauge freedom leads
to spurious phase differences in the Bloch functions at two neighbouring
@xmath points and ultimately to spurious contributions to the numerical
derivative. Then, basically the four schemes [ SK08 , VS07 , SInV04 ,
KKSP @xmath 15 ] differ in how the gauge is fixed to eliminate the
spurious phase.

This chapter presents a real-time ab-initio approach to nonlinear
optical properties for extended systems with PBC in which the nonlinear
optical susceptibility are obtained through Eq. ( 2.16 ). To derive the
EOMs we follow the scheme of Souza et al. [ SInV04 ] based on the
generalisation of Berry’s phase to the dynamical polarisation (Sec.
2.4.1 ). Originally applied to a simple tight-binding Hamiltonian, this
approach is valid for any single-particle Hamiltonian and, as we discuss
in Sec. 2.4.2 , it can be applied in an ab-initio context with inclusion
of the relevant many-body effects. After detailing on how nonlinear
optical susceptibility is extracted from the dynamical polarisation
(Sec. 2.5 ), we show results for the second-harmonic generation (SHG) in
semiconductors (Sec. 2.6 ) and successfully validate them against
existing results from the literature obtained by response theory in
frequency domain.

### 2.4 Theoretical background

We consider a system of @xmath electrons in a crystalline solid of
volume @xmath (where @xmath is the number of the equivalent cells and
@xmath the cell volume) coupled with a time-dependent electric field
@xmath

  -- -------- -- --------
     @xmath      (2.17)
  -- -------- -- --------

where @xmath is the zero-field Hamiltonian, and @xmath describes the
coupling with the electric field. Here, we consider a generic
single-particle Hamiltonian @xmath . In Sec. 2.4.2 we specify the form
of @xmath and show how many-body effects are included by means of
effective single-particle operators. Of course, the choice of a
single-particle Hamiltonian prevents applications to systems with strong
static correlation such as Mott insulators or frustrated magnetic
materials. We assume the ground state of @xmath to be non-degenerate and
a spin-singlet so that the ground-state wave-function can be expressed
as a single Slater determinant. We also assume, as usual in treating
cell-periodic systems, Born-von Kármán PBC and define a regular grid of
@xmath @xmath -points in the Brillouin zone. With such assumptions, the
single-particle solutions of @xmath are Bloch-functions.

Regarding the electron-field coupling we assume classic fields and use
the dipole approximation, @xmath ( @xmath is the electronic charge).
However, because of the PBC the position operator is ill-defined. In
order to obtain a form for the field coupling operator compatible with
Born-von Kármán PBC, in this chapter we use the Berry’s phase
formulation of the position operator and consequently the polarisation.
As proved in Ref. [ SInV04 ] , in this formulation the solutions of
@xmath are also in a Bloch function form: @xmath , with @xmath being the
periodic part and @xmath being the band index. Notice that, even in the
Berry’s phase formulation, for very strong fields and with the number of
@xmath -points that goes to infinity the Hamiltonian Eq. 2.17 is
unbounded from below due to the Zener tunnelling. [ SK08 ] Nevertheless
the strength of the fields used in non-linear optics is well below this
limit. [ SK08 , SInV04 ]
In Sec. 2.4.1 we detail how, by starting from the Berry’s phase
formulation of polarisation, we obtain the EOMs in presence of an
external electric field within PBC.

#### 2.4.1 Treatment of the field coupling term

##### Berry’s phase polarisation

In this section we take a different path to obtain the KSV polarisation.
We start from the many-body polarisation operator proposed by R. Resta
and then we derive the single particle one, i.e. the KSV polarisation.
Developed in the mid-90s the Modern Theory of Polarisation [ Res94 ]
provides a correct definition for the macroscopic bulk polarisation, not
limited to the perturbative regime, in terms of the many-body geometric
phase

  -- -------- -- --------
     @xmath      (2.18)
  -- -------- -- --------

In Eq. ( 2.18 ) @xmath is the macroscopic polarisation along the
primitive lattice vector @xmath , @xmath , @xmath with @xmath the
primitive reciprocal lattice vector such that @xmath , and @xmath the
number of @xmath -points along @xmath , corresponding to the number of
equivalent cells in that direction, @xmath is the smallest distance
between two k-points along the @xmath direction. Note that in this
formulation the polarisation operator is a genuine many-body operator
that cannot be split as a sum of single-particle operators.
The polarization defined by the Eq. 2.18 is valid for any many-body
wavefunction on lattice or continuum [ Res98 , RS99 ] , now we will see
how this expression gets simplified in case of a single Slater
determinant.

By using the assumption that the wave-function can be written as a
single Slater determinant, the expectation value of the many-body
geometric phase in Eq. ( 2.18 ) can be seen as the overlap between two
single Slater determinants. The latter is equal to the determinant of
the overlap @xmath matrix built out of @xmath , the occupied Bloch
functions

  -- -------- -- --------
     @xmath      (2.19)
  -- -------- -- --------

Then we can rewrite Eq. ( 2.18 ) as

  -- -------- -- --------
     @xmath      (2.20)
  -- -------- -- --------

where @xmath is the spin degeneracy, equal to @xmath since we consider
here only spin-unpolarized systems, and @xmath is the number of @xmath
-points in the plane perpendicular to reciprocal lattice vector @xmath ,
with @xmath .

The overlap @xmath has dimensions @xmath , where @xmath is the number of
doubly occupied bands. However, from the properties of the Bloch
functions and by imposing they satisfy the so-called “periodic gauge”
@xmath , it follows that the integrals in Eq. ( 2.19 ) are different
from zero only if @xmath . Therefore the determinant of @xmath reduces
to the product of @xmath determinants of overlaps @xmath built out of
@xmath , the periodic part of the occupied Bloch functions:

  -- -------- -- --------
     @xmath      (2.21)
  -- -------- -- --------

This leads to the formula by which we compute the polarisation of the
system

  -- -------- -- --------
     @xmath      (2.22)
  -- -------- -- --------

Using matrix properties, [ PP12 ] the logarithm of the matrix
determinant can be rewritten as the trace of matrix logarithm, and so
Eq. ( 2.22 ) can be transformed as

  -- -------- -- --------
     @xmath      (2.23)
  -- -------- -- --------

more suitable to derive the EOMs. By taking the thermodynamic limit (
@xmath and @xmath ) of the latter expression one arrives at the
King-Smith and Vanderbilt formula for polarisation. [ KSV93 ] Since in a
numerical implementation we deal with a finite number of @xmath and
finite @xmath , we stick here to Eq. ( 2.23 ) with @xmath to derive the
EOMs.

##### Equations-of-motion

Following Ref. [ SInV04 ] we start from the Lagrangian of the system in
presence of an external electric field @xmath :

  -- -------- -- --------
     @xmath      (2.24)
  -- -------- -- --------

where @xmath is the energy functional corresponding to the zero-field
Hamiltonian:

  -- -------- -- --------
     @xmath      (2.25)
  -- -------- -- --------

with @xmath , and the last term @xmath is the coupling between the
external field and the polarization. Notice that @xmath does not connect
wave-functions with different @xmath vectors. To simplify the notation
we do not explicit the time dependence of the @xmath , but they should
be considered time-dependent in the rest of the chapter.

We derive the dynamical equations and the corresponding the Hamiltonian
from the Euler-Lagrange equations

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (2.26)
     @xmath   @xmath   @xmath      (2.27)
  -- -------- -------- -------- -- --------

To obtain the functional derivative of the polarisation expression in
Eq. ( 2.23 ) we use that [ SInV04 , NG01 ]

  -- -------- -- --------
     @xmath      (2.28)
  -- -------- -- --------

and that exchanging arguments ( @xmath ) in @xmath [Eq. ( 2.21 )] brings
a minus sign in Eq. ( 2.23 ). This leads to (see Ref. [ SInV04 ] for
details):

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (2.29)
     @xmath   @xmath   @xmath      (2.30)
  -- -------- -------- -------- -- --------

where @xmath , and from which we can define the field coupling operator

  -- -------- -- --------
     @xmath      (2.31)
  -- -------- -- --------

Notice that the field coupling operator in Eq. ( 2.31 ) is nonhermitian.
In order to have well defined Hermitian operators in the EOMs we replace
@xmath with @xmath . This is possible because at any time @xmath [
SInV04 ] . Finally, by using Eqs. ( 2.29 )-( 2.31 ) in Eq. ( 2.27 ) and
the Hermitian field coupling operator we obtain the EOMs:

  -- -------- -- --------
     @xmath      (2.32)
  -- -------- -- --------

Note that Eq. ( 2.31 ) contains a term proportional to

  -- -------- -- --------
     @xmath      (2.33)
  -- -------- -- --------

that has the form of the two-points central finite difference
approximation of @xmath , but for the fact that @xmath are used instead
of @xmath . As explained in Ref. [ SInV04 ] , the @xmath are built from
the @xmath [Eq. ( 2.30 )] in such a way that they transform as @xmath
under a unitary transformation @xmath .

In fact, there is a gauge freedom in the definition of @xmath , that is
@xmath , and since the Hamiltonian is diagonalized independently at each
@xmath , the gauge is fixed independently and randomly at each @xmath .
Then, standard (numerical) differentiation will be affected by the
different gauge choices at two neighbouring @xmath -points. Instead the
(numerical) derivative in Eq. ( 2.33 ) is gauge-invariant, or more
specifically is performed in a locally flat coordinate system with
respect to @xmath . In fact, in the thermodynamical/continuum limit,
Eq. ( 2.33 ) corresponds to the covariant derivative. The problem of
differentiating @xmath with respect to @xmath has been addressed also in
Refs. [ VS07 , SK08 , AT98 , KKSP @xmath 15 ] that use alternative
approaches to ensure the gauge-invariance. In the here-discussed
approach the definition of a numerical covariant differentiation
originates directly from the definition of the polarisation as a Berry
phase.

#### 2.4.2 Treatment of electron correlation

Correlation effects play a crucial role in both linear [ ORR02 ] and non
linear [ LHV10 , CME @xmath 09 ] response of solids. Since we assumed
that @xmath in Eq. ( 2.18 ) can be written as a single Slater
determinant, effects beyond the IPA can be introduced in @xmath through
an effective time-independent one-particle operator that can be either
spatially local as in time-dependent density functional theory, or
spatially non-local as in time-dependent Hartree-Fock.

However, both time-dependent density functional theory and
time-dependent Hartree-Fock are not suitable approaches to optical
properties of semiconductors: the former, within standard approximations
for the exchange-correlation approximations, underestimates the optical
gap and misses the excitonic resonances; the latter largely
overestimates the band-gap and excitonic effects.

In the framework of Green’s function theory a very successful way to
deal with electron-electron interaction in semiconductors is the
combination of the @xmath approximation for the quasi-particle band
structure [ SMH82 ] with the Bethe-Salpeter equation in static ladder
approximation for the response function. [ Str88 ]

We recently extended this approach to the real-time domain [ AGM11 ] by
mean of non-equilibrium Green’s function theory and derived a single
particle Hamiltonian that includes correlation from Green’s function
theory. These many-body corrections and their effect on the non-linear
properties will be discussed in Chapters 3 and 4 .
In this section we will show how the so-colled local field effects and
the quasi-particle corrections enter in our EOMs.
Here as starting point for our real-time dynamics, we choose the
Kohn-Sham Hamiltonian at fixed density as a system of independent
particles, [ KS65 ]

  -- -------- -- --------
     @xmath      (2.34)
  -- -------- -- --------

where @xmath is the electron-ion interaction, @xmath the Hartree
potential and @xmath the exchange-correlation potential. The advantage
of such a choice is that the Kohn-Sham system is the
independent-particle system that reproduces the electronic density of
the unperturbed many-body interacting system @xmath , thus by virtue of
the Hohenberg-Kohn theorem [ HK64 ] the ground-state properties of the
system. Furthermore, no material dependent parameters need to be input,
but for the atomic structure and composition.

As first step beyond the IPA, we introduce the corrections to the
independent-particle energy levels by the electron-electron interaction
through a (state-dependent) scissor operator

  -- -------- -- --------
     @xmath      (2.35)
  -- -------- -- --------

The latter can be calculated ab-initio e.g., via the @xmath approach
@xmath , or can be determined empirically from the experimental band gap
@xmath . We refer to this approximation as the independent
quasi-particle approximation (QPA):

  -- -------- -- --------
     @xmath      (2.36)
  -- -------- -- --------

Notice that in our approach the inclusion of a non-local operator in the
Hamiltonian does not present more difficulties than a local one, while
this is not a trivial task in the response theory in frequency domain [
LHV10 ] . As a second step we consider the effects originating from the
response of the effective potential to density fluctuations. By
considering the change of the Hartree plus the exchange-correlation
potential in Eq. 2.34 we will obtain the TD-DFT response. Here we
include just “classic electrostatic” effects via the Hartree part. We
refer to this level of approximation as the time-dependent Hartree (TDH)

  -- -------- -- --------
     @xmath      (2.37)
  -- -------- -- --------

In the linear response limit the TDH is usually referred as Random-Phase
approximation and is responsible for the so-called crystal local field
effects. [ Adl62 ]

Beyond the TDH approximation one has the TD-Hartree-Fock that includes
the response of the exchange term to fluctuations of the density matrix
@xmath . As discussed above this level of approximation is insufficient
for optical properties of semiconductors, normally worsening over TDH
results. Correlation effects beyond TD-Hartree will be discussed in
chapter 3 . We want to emphasise again that within this approach
many-body effects are easily implemented by adding terms to the
unperturbed independent-particle Hamiltonian @xmath in the EOMs [Eq. (
2.32 )]. Limitations may arise because of the computational cost of
calculating those addition terms. In the specific the large number of
@xmath -points needed to converge the SHG and THG spectra makes more
correlated approaches impracticable. However, much less @xmath -points
are needed for converging for example the screened-exchange self-energy
itself (see Chapter 3 ) and currently we are investigating how to
exploit this property and devise “double grid” strategies similar to the
one proposed in Ref. [ KBM @xmath 12 ] . In this chapter effects beyond
IPA are limited to the QPA and TDH.

Finally, when the wave-function cannot be approximated anymore with a
single Slater determinant (as in strong-correlated systems) the
evaluation of the polarisation operator [Eq. 2.18 ] becomes quite
cumbersome. [ SASR11 ] Also we are not aware of any successful attempt
to combine Berry’s phase polarisation with Green’s function theory or
density matrix kinetic equations beyond the screened Hartree-Fock
approximation (i.e. including scattering terms), even if some appealing
approaches have been proposed in the literature [ MRPB95 , CL11 , Shi14
, NK13 ] .

### 2.5 Computational scheme and numerical parameters

Figure 2.5 illustrates the computational scheme we use to calculate the
SHG and THG spectra. It consists in:

1.  we obtain the density, the KS eigenvalues, and eigenfunctions from a
    planewaves DFT code and then we calculate the quasi-particle
    corrections within the G @xmath W @xmath approximation. All these
    quantities define the zero-field Hamiltonian;

2.  we integrate the equation of motions [Eq. ( 2.32 )] in presence of a
    monochromatic electric field @xmath to obtain the @xmath from Eq. (
    2.22 )

3.  We post-process the @xmath to extract the nonlinear
    susceptibilities.

The latter two steps are repeated varying the laser frequency @xmath
within the energy range for which we calculate the spectra.

The scheme in Fig. 2.5 has been implemented in the development version
of the Yambo code. [ MHGV09 ] Kohn-Sham calculations have been performed
using the Abinit code, [ GBC @xmath 02 ] and the relevant numerical
parameters are summarized in Ref. [ AG13 ] . All the operators appearing
in the EOMs[Eqs. ( 2.32 ),( 2.37 ),( 2.36 )] have been expanded in the
Kohn-Sham basis set and the number of bands employed in the expansion is
again reported in Ref. [ AG13 ] .

Rigorously to have a fully ab-initio scheme, the scissor operator has to
be calculated using e.g., @xmath . In the examples presented in this
chapter we use an empirical values for the scissor operator (reported in
Ref. [ AG13 ] ) since the scope is to validate the computational scheme,
and to facilitate the comparison with other works in the literature.

The EOMs [Eq. ( 2.32 )] have been integrated using the following
algorithm [ KC08 ]

  -- -------- -- --------
     @xmath      (2.38)
  -- -------- -- --------

valid for both Hermitian and non-Hermitian Hamiltonians, and strictly
unitary for any value of the time-step @xmath in the Hermitian case. In
all real-time simulations we used a time-step of 0.01 fs.

In our simulations we switch on the monochromatic field at @xmath . This
sudden switch excites the eigenfrequencies of the system @xmath
introducing spurious contributions to the non-linear response. We thus
add an imaginary term into the Hamiltonian @xmath to simulate a finite
dephasing:

  -- -------- -- --------
     @xmath      (2.39)
  -- -------- -- --------

where @xmath are the valence bands of the unperturbed system and @xmath
is the dephasing rate. Then we run the simulations for a time much
larger than @xmath and sample @xmath close to the end of the simulation,
see Figure 2.6 . Since @xmath determines also the spectral broadening,
we cannot choose it arbitrary small. For example in the present
calculations we have chosen @xmath equal to 6 fs that corresponds to a
broadening of approximately 0.2 eV (comparable with the experimental
one) and thus we run the simulations for 50-55 fs.
Once all the eigenfrequencies of the system are filtered out, the
remaining polarisation @xmath is a periodic function of period @xmath ,
where @xmath is the frequency of the external perturbation and can be
expanded in a Fourier series

  -- -------- -- --------
     @xmath      (2.40)
  -- -------- -- --------

with @xmath , and complex coefficients:

  -- -------- -- --------
     @xmath      (2.41)
  -- -------- -- --------

To obtain the optical susceptibilities of order @xmath at frequency
@xmath one needs to calculate the @xmath of Eq. ( 2.40 ), proportional
to @xmath by the @xmath -th power of the @xmath . However, the
expression in Eq. ( 2.41 ) is not the most computationally convenient
since one needs a very short time step—significantly shorter than the
one needed to integrate the EOMs—to perform the integration with
sufficient accuracy. As an alternative we use directly Eq. ( 2.40 ): we
truncate the Fourier series to an order @xmath larger than the one of
the response function we are interested in. We sample @xmath values
@xmath within a period @xmath , as illustrated in Figure 2.6 . Then
Eq. ( 2.40 ) reads as a system of linear equations

  -- -------- -- --------
     @xmath      (2.42)
  -- -------- -- --------

from which the component @xmath of @xmath in the @xmath direction is
found by inversion of the @xmath Fourier matrix @xmath . We found that
the second harmonic generation converges with S equal to 4 while the
third harmonic requires S equal to 6. Finally we noticed that averaging
averaging the results on more periods can slightly reduce the numerical
error in the signal analysis.

Alternatively one can opt for a slow switch on of the electric field as
in Takimoto et al., [ TVR07 ] so that no eigenfrequencies of the system
are excited, and avoid to introduce imaginary terms in the Hamiltonian.
We found, however, that the latter approach also requires long
simulations, and on the other hand, it is less straightforward to
extract the @xmath .

### 2.6 Results

The main objective of this section is to validate the computational
approach described in Secs. 2.4 and 2.5 against results in the
literature for SHG obtained by the response theory in frequency domain.
In particular we chose to validate against results from Refs. [ LHV10 ,
HLV10 ] on bulk SiC and AlAs in which the electronic structures is
obtained—as in our case—from a pseudo-potential plane-wave
implementation of Kohn-Sham DFT with the local density approximation,
which makes the comparison easier. In the following we considered the
zinc-blende structure of SiC and AlAs for which the @xmath tensor has
only one independent nonzero component, @xmath (or its equivalent by
permutation).

Figure 2.7 show results for the magnitude of SHG in SiC at the IPA, QPA
and TDH level of theory. At all levels of approximation we obtained an
excellent agreement with the results in Ref. [ LHV10 ] . The minor
discrepancies between the curves are due to the different choice for the
@xmath -grid used for integration in momentum space: we used a @xmath
-centred uniform grid (for which we can implement the numerical
derivative) whereas Ref. [ LHV10 ] used a shifted grid. Figure 2.8 shows
results for the magnitude of SHG in AlAs at the IPA, QPA and TDH level
of theory. Also in this case results obtained from our real-time
simulations agree very well with the reference results and again the
small differences between the spectra can be ascribed mostly to the
different grid for @xmath -integration. As side results we can also
observe the effects of different levels of approximation for the
Hamiltonian on the SHG spectrum. In order to interpret those spectra
note that SHG resonances occur when either @xmath or @xmath equals the
difference between two single-particle energies. Then one can
distinguish two energy region: below the single-particle minimum direct
gap where only resonances at @xmath can occur, and above where both
@xmath or @xmath resonances can occur.
Regarding the quasi-particle corrections to the IPA energy levels by a
scissor operator, below the minimum Kohn-Sham direct band gap the IPA
spectrum is shifted by half of the value of the scissor shift (0.4 eV
for SiC and 0.45 eV for AlAs) and the spectral intensity reduced by a
factor 1.18 (SiC) and 1.25 (AlAs). Above the minimum Kohn-Sham direct
band gap instead the QPA spectrum cannot be simply obtained by shifting
and renormalizing the IPA one because of the occurrence of resonances at
@xmath , that are shifted and renormalised differently.
Regarding the crystal local field, their global effect is to reduce the
intensity with respect to the IPA. For SiC, the intensity is reduced by
about 15% below the gap, while above the band gap TDH and IPA have
similar intensities. For AlAs we observe a reduction of about 30% in
intensity for the whole range of considered frequencies, but for
frequencies larger than 4 eV (that is where the @xmath resonances with
the main optical transition occur) for which again the TDH and IPA have
similar intensities.

### 2.7 All gauges are equal but some gauges are more equal than others

In the previous sections we presented a real-time approach based on
Berry’s phase to calculate the non-linear response in solids. Here we
briefely discuss possible alternatives to this formulation together with
their advantages and disdvantages. In order to describe polarisation in
bulk materials, Berry’s phase is a necessary ingredient. However this is
true only for the intrinsic polarisation, because the polarisation
induced by an external field can be expressed as an integral of the
total current:

  -- -------- -- --------
     @xmath      (2.43)
  -- -------- -- --------

In periodic systems the current operator @xmath is always well defined
and therefore we do not need any special trick to carry out its
calculation. For this reason, even before the King-Smith-Vanderbilt
formula, some researchers [ BIRY00 ] presented real-time implementation
of time-dependent density functional theory in periodic systems where
the polarisation was obtained by current integration. Since scalar and
vector potentials associated to electromagnetic fields are gauge
dependent [ Jac02 ] it is always possible to choose a particular gauge
where all the coupling with the external field is described through the
vector potential @xmath . Therefore we do not need the dipole operator,
and we can write the Hamiltonian, in the so-called velocity gauge, as:

  -- -------- -- --------
     @xmath      (2.44)
  -- -------- -- --------

In this formulation one can complitely avoid the use of the Berry’s
phase. The vector potential that enters in the velocity gauge
Hamiltonian is realted to the electric field by the equation:

  -- -------- -- --------
     @xmath      (2.45)
  -- -------- -- --------

Although at first sight this choice seems to be more convenient and
simpler than the direct use of the polarisation, it presents different
inconvenients that motivated us to develop the new approach presented in
this chapter.
The length gauge, we used to define our Hamiltonian [Eq. 2.17 ], is
obtained from the multipolar gauge within the electric-dipole
approximation (EDA). [ Kob82 ] The multipolar gauge is given by the
condition @xmath (the @xmath superscript indicates the multipolar
gauge). The scalar and vector potentials are defined directly from the
electric and magnetic fields respectivelly: [ Kob82 , Jac02 ]

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (2.46)
     @xmath   @xmath   @xmath      (2.47)
  -- -------- -------- -------- -- --------

Then for zero-field, both @xmath and @xmath are zero. This is in general
not true for other gauge choices as the zero-field situation is
generally described by @xmath and @xmath where @xmath is an arbitrary
function of space and time that defines the gauge transformation. The
importance of having zero scalar/vector potentials in the zero-field
situation has been emphasised by several authors. Since the vector
potential can be different from zero alse in the case of zero-field in
the Hamiltonian of Eq. ( 2.44 ), it means that the eigenvalues and
eigenfunctions of the velocity gauge Hamiltonian are gauge dependent and
therefore cannot represent physical states not even at zero field.
Another advantage of using length gauge can be understood when we pass
from length to the velocity gauge through the gauge transformation:

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (2.48)
     @xmath   @xmath   @xmath      (2.49)
     @xmath   @xmath   @xmath      (2.50)
     @xmath   @xmath   @xmath      (2.51)
  -- -------- -------- -------- -- --------

where @xmath is the original Hamiltonian in lenght gauge [Eq. 2.51 ],
@xmath is the Hamiltonian in velocity gauge [Eq. 2.44 ] and @xmath is
the gauge transformation operator. In the full many-body Hamiltonian all
operators are local and therefore there is not problem to perform this
transformation. But in approximated Hamiltonians, non local operators
appear that do not commute with the Gauge transformation and therefore
they acquire an unusual dependence from the vectors potential:

  -- -------- -- --------
     @xmath      (2.52)
  -- -------- -- --------

One runs in this problem in presence for examples of non-local
pseudo-potentials (see section III of Ref. [ BIRY00 ] ) or more
seriously in presence of the exchange or self-energies derived from
Green’s function theory. Therefore real-time dynamics in presence of
non-local operators is much more complicated in velocity guage than in
the length one. Last but not least, the dephasing operator that appears
in the Hamiltonian [Eq. 2.39 ] do not commute with the gauge
transformation, this implies that in velocity gauge the smearing cannot
be simply added at the end of the calculations [ SBA @xmath 17 , LSS87 ]
but its full dynamics has to be taken in to account. Notice that also
the relation ( 2.43 ) between current and polarization is modified by
the presence of dephasing terms in the Hamiltonian. For example in
presence of a simple quasi-particle life-time @xmath the relation [Eq.
2.43 ] becomes [ Tok09 ] :

  -- -------- -- --------
     @xmath      (2.53)
  -- -------- -- --------

All these difficulties explain the common agreement in the scientific
literature that velocity gauge is not suitable or more difficult to use
to study non-linear response [ RB04 , AS95 ] .

### 2.8 Conclusions

In this chapter we presented an ab-initio real-time approach to
calculate nonlinear optical properties of extended systems in the length
gauge. The key strengths of the proposed approach are first, the correct
treatment of the coupling between electrons and the external field and
second the possibility to include easily correlation effects beyond the
IPA.

Regarding the treatment of the electron-field coupling, following the
work of Souza et al. [ SInV04 ] , we started from the Berry’s phase
formulation for the dynamical polarisation—a definition consistent with
the periodic boundart conditions (PBC)—to derive a covariant numerical
expression for the dipole operator in the EOMs.

Note that we worked in the length-gauge even if the velocity gauge may
appear a more natural choice. In fact, as opposed to the position
operator the velocity operator is consistent with the PBC. However, in
the velocity gauge even if the position operator disappears from the
Hamiltonian, it reappears in the phase factor for the wave-function [
LSS87 ] , so that the problem of re-defining the position operator
remains. Furthermore, the velocity gauge is plagued by unphysical
numerical divergences for the response at low frequencies [ AS95 ] .
Concerning effects beyond the independent-particle approximation, they
are included by simply adding the corresponding single-particle operator
to the Hamiltonian. This is an easy task when compared with deriving the
corresponding expressions for the nonlinear optical susceptibility. [
CME @xmath 09 , VS09 ] As an example, in the present chapter we have
included quasi-particle corrections to the band-gap by adding to the
Hamiltonian a scissor operator and crystal local-field effects by adding
the time-evolution of the Hartree potential. In principle, one can add
as well excitonic effects by adding the time-evolution of the screened
exchange self-energy (see chapter 3 ); or perform a real-time TD-DFT
calculations by adding the time-evolution of the exchange-correlation
potential (see chapter 4 ). Being the focus of this chapter the
validation of the proposed approach for calculating nonlinear
properties, the inclusion of these correlation effects is discussed in
the rest of this work. We have proved the validity of our approach by
comparing our results, obtained from real-time simulations, with results
in the literature obtained from direct evaluation of the second order
susceptibility in frequency-domain.

## Chapter 3 Correlation from non-equilibrium Green’s functions

### 3.1 A simple introduction to non-equilibrium Green’s functions

In this section we present a simple introduction to the non-equilibrium
Green’s functions, following the lines of Ref. [ DKK04 ] .
In quantum mechanics a many-body system is characterised by its
Hamiltonian, i. e. by:

  -- -------- -- -------
     @xmath      (3.1)
  -- -------- -- -------

where @xmath is the potential generated by the ions and @xmath is the
electron-electron interaction. This last term in the previous equation
makes the many-body problem impossible to solve in the case of three or
more interacting particles. However we can always try to find a solution
of the Hamiltonian [Eq. 3.1 ] as a linear combination of the
single-particle solutions of a non-interacting problem, i. e. the
solution of the above Hamiltonian without the electron-electron
interaction. The non-interacting solution constitutes a complete basis
set in the form:

  -- -------- -- -------
     @xmath      (3.2)
  -- -------- -- -------

where @xmath is the state without particles and the creation operators
@xmath create a particle in a given state @xmath of our single particle
Hamiltonian. The properties of the creation/destruction operators
guarantee the correct Fermi statistics. Once we have determined the
wave-function, or at least, an approximate wave-function, all the
observables can be expressed in terms of @xmath and @xmath operators.
Proceeding in this way is a formidable task, because in a solid the
number of particles is of the order of the Avogadro’s number @xmath ,
i.e. practically an infinite number of particles.
But we do not need all this information to characterise a physical
system. In fact the mean value of any single particle operator as
dipole, momentum, etc.. can be expressed in terms of the single particle
density matrix, without the need of the full wave-functions:

  -- -------- -------- -------- -- -------
     @xmath   @xmath   @xmath      (3.3)
     @xmath   @xmath   @xmath      (3.4)
  -- -------- -------- -------- -- -------

where @xmath is a single particle operator, and @xmath the one-body
density matrix. Obviously the mean-value of a s-particle operator may be
evaluated by means of the s-particle density matrix.
If we know the EOMs for the density matrix it will be possible to follow
the full many-body dynamics without passing by the full wave-function.
Based on this idea John Von Neumann in 1927 derived an equation for the
temporal evolution of the density matrix operator [ VN27 ] :

  -- -------- -- -------
     @xmath      (3.5)
  -- -------- -- -------

This equation can be obtained from the Schrödinger equation, and
provides an equivalent description of quantum mechanics. The major
problem of Eq. 3.5 is that it is not a closed equation. If we write down
explicitly [Eq. 3.5 ] for the single particle density matrix we
immediately realise that the r.h.s. depends from the two-body density
matrix, whose EOMs will depend from the three-body density matrix and so
on. This set of equations, called the BBGKY hierarchy
(Bogoliubov-Born-Green-Kirkwood-Yvon hierarchy), describes the full
dynamics of a system with a large number of interacting particles. [
Bon98 ]
The solution of the BBGKY hierarchy has the same complexity of the
initial Schrödinger equation. For this reason different scientists
searched for a closed form of Eq. 3.5 that involves only a limited order
of density matrices. The simplest decoupling of the hierarchy is
achieved by the application of the Hartree-Fock (HF) approximation:

  -- -------- -- -------
     @xmath      (3.6)
  -- -------- -- -------

In the HF the two-particle density matrix is expressed in terms of the
single particle one, and therefore the EOMs for single-particle density
matrix are closed. Clearly HF is not a satisfying approximation to
describe electronic properties of real-systems. In the literature many
different ways to close the BBGKY equations have been proposed that are
able to treat correlations at different levels (for a discussion see
Ref. [ Bon98 , RK02 ] and references there in).
The density matrix formalism is a very powerful tool to study the
many-body problems in a large spectra of situations, however it presents
two important limitations that motivated the development of Green’s
function theory. First of all, there are different situations where we
are interested in time-dependent (or frequency dependent) correlation
functions that are not directly accessible from the density matrix.
Second the decoupling of the BBGKY hierarchy equations is not an easy
task, especially in systems with many particles as for instance bulk
materials. Now we will see how it is possible to generalise the density
matrix approach to solve these two issues.
If we write the density matrices in term of field operators:

  -- -------- -- -------
     @xmath      (3.7)
  -- -------- -- -------

it follows that Green’s functions are a generalisation of s-particle
density matrices with field operators at different times:

  -- -------- -- -------
     @xmath      (3.8)
  -- -------- -- -------

Different arrangements of the field operators correspond to different
time-correlation functions, i.e. different Green’s functions: greater,
casual, retard or advanced. As in the case of density matrices the
properties of a full many-particle systems can be described in terms of
Green’s functions. But differently from density matrices we have a
direct access to dynamical properties, as for instance response
functions, excitation energies and so on (see Chapter 3 of Ref. [ DKK04
] ).
A central task of the theory is the determination of these functions.
The dynamics of the Green’s functions can be derived from the EOMs of
the field operators. For example for the @xmath we obtain:

  -- -------- -- -------
     @xmath      (3.9)
  -- -------- -- -------

where @xmath are indexes for both time and position, the @xmath is the
limit of @xmath with @xmath , and @xmath is the external potential. As
in the case of reduced density matrix, the EOMs for the single particle
Green’s functions are not closed and depend from two particle Green’s
functions and so on. The problem may, in principle, be solved using
equations similar to the BBGKY hierarchy, the so called Martin-Schwinger
hierarchy equations. However Green’s function presents a major advantage
that is the possibility to construct a single particle operator, the
self-energy @xmath , that is not local in time and space and allows us
to close the EOMs in the form:

  -- -------- -- --------
     @xmath      (3.10)
  -- -------- -- --------

where @xmath is the independent particle Green’s function and the
integral is performed on the Keldysh contour. ¹ ¹ 1 In this introduction
we have no space to derive and explain Eq. 3.10 , for more details see
the textbooks [ DKK04 , SW02 , KB62 , HJC08 ] .
This famous equation was derived for the first time by Kadanoff and Baym
and by Keldysh. It is a generalisation of the Dyson equation from the
field theory to quantum statistics. Equation 3.10 describes time
evolution of real-time Green’s functions under equilibrium and
non-equilibrium conditions.
Of course, all problems of the hierarchy equations are now transferred
to the self-energy construction. In the literature different approaches
have been proposed to construct self-energies. In this chapter we will
use the so-called GW approximation. The GW self-energy is the first
order correction, in term of screened Coulomb interaction, obtained from
many-body perturbation theory [ AG98 ] . This approximation has been
derived by Hedin [ Hed99 ] for the electron gas and then applied to
semiconductors by Hanke, Sham and Strinati [ SMH82 ] . ² ² 2 As it is
often the case in physics, the GW self-energy originates from previous
studies on the electron gas, based on perturbation theory in terms of
screened Coulomb interaction performed by DuBois, Kadanoff, Baym and
Bonch-Bruevich and Tyablikov. The GW corrections have shown a clear
improvement for band gaps [ AG98 , AJW99 ] , level ordering [ FAO @xmath
11 ] and gradients of the electronic levels respect to the atomic
displacements [ FBA @xmath 15 ] , when compared to available
experimental data.
In the next sections, starting from a non-equilibrium formulation of the
GW self-energy [ SBL04 ] , we will derive an effective single-particle
Hamiltonian for our real-time dynamics.

### 3.2 General Introduction

Real-time methods have proven their utility in calculating optical
properties of finite systems mainly within time-dependent density
functional theory (TDDFT). [ BIRY00 , CAO @xmath 06 , SSZL07 ] On the
other hand extended systems have been mostly studied by using many-body
perturbation theory (MBPT) within the linear response regime [ Str88 ] .
The different treatment of correlation and nonlinear effects marks the
range of applicability of the two approaches. The real-time TDDFT makes
possible to investigate nonlinear effects like second harmonic
generation [ TVR07 ] or hyperpolarizabilities of molecular systems [ CAO
@xmath 06 ] . However, as we will see in Chapter 4 TD-DFT is not a
correct theory to describe excitations at zero momentum @xmath in
extended systems. For this reason, even with the exact exchange
correlation functional TD-DFT is not suppose to reproduce the exact
response functions in solids. On the contrary MBPT allows to include
correlation effects using controllable and systematic approximations for
the self-energy @xmath , that is a one-particle operator non-local in
space and time. @xmath can be evaluated within different approximations,
among which one of the most successful is the so-called GW approximation
[ AJW99 ] . Since its first application to semiconductors [ SMH80 ] the
GW self-energy has been shown to correctly reproduce quasi-particle
energies and lifetimes for a wide range of materials [ AJW99 , FBD
@xmath 13 ] . Furthermore, by using the static limit of the GW
self-energy as scattering potential of the Bethe-Salpeter equation (BSE)
[ Str88 ] , it is possible to calculate response functions including
electron-hole interaction effects.

In recent years, the MBPT approach has been merged with
density-functional theory (DFT) by using the Kohn-Sham Hamiltonian as
zeroth-order term in the perturbative expansion of the interacting
Green’s functions. This approach is parameter free and completely
ab-initio [ ORR02 ] . However MBPT is a very cumbersome technique that,
based on a perturbative concept, increases its level of complexity with
the order of the expansion. As an example, this makes the extension of
this approach beyond the linear response regime quite complex, though
there have been recently some applications in nonlinear optics. [ CSL01
, LSHB05 , LHV10 ] A generalisation of MBPT to non-equilibrium
situations has been proposed by Kadanoff and Baym and Keldysh [ LPK94 ]
. In their seminal works the authors derived a set of equations for the
real-time Green’s functions, the Kadanoff-Baym equations (KBE’s), that
provide the basic tools of the non-equilibrium Green’s Function theory
and allow essential advances in non equilibrium statistical mechanics [
LPK94 ] . Both the standard MBPT and non-equilibrium Green’s Function
theory are based on the Green’s function concept. This function
describes the time propagation of a single particle excitation under the
action of an external perturbation. In the equilibrium MBPT, due to the
time translation invariance, the relevant variable used to calculate the
Green’s functions is the frequency @xmath . Instead, out of equilibrium,
in all non steady-state situations, the time variables acquire a special
role and much more attention is devoted to the their propagation
properties. The time propagation avoids the explosive dependence, beyond
the linear response, of the MBPT on high order Green’s functions.
Moreover the KBE are non-perturbative in the external field therefore
weak and strong fields can be treated on the same footing.

One of the first attempts to apply the KBE’s for investigating optical
properties of semiconductors was presented in the seminal paper of
Schmitt-Rink and co-workers. [ SRCH88 ] Later the KBE’s were applied to
study quantum wells, [ PH98 ] laser excited semiconductors, [ HH88 ] and
luminescence [ HGB01 ] . However, only recently it was possible to
simulate the Kadanoff-Baym dynamics in real-time. [ KKY99 , PvFVA09 ,
KB00 , DvL07 ] In this chapter we combine a simplified version of the
KBE’s with DFT in such a way to obtain a parameter-free theory that is
able to reproduce and predict ultra-fast and nonlinear phenomena in
crystalline solids and nano-structures (Sec. 3.3 ). This approach, that
we will address as real-time BSE (RT-BSE), reduces to the standard BSE
for weak perturbations (Sec. 3.3.3 ) but, at the same time when coupled
with Modern Theory of Polarisation (see Chapter 2 ), naturally describes
optical excitations beyond the linear regime. After discussing some
relevant aspects of the practical implementation of our approach (Sec.
3.4 ), we exemplify how it works in practice by calculating the optical
absorption spectra of h -BN, and we’ll apply it to the second harmonic
generation in monolayer h -BN and MoS @xmath .

### 3.3 The Real-Time Bethe-Salpeter equation

We derive here a novel approach to solve the time evolution of an
electronic system with Hamiltonian coupled with an external field,

  -- -------- -- --------
     @xmath      (3.11)
  -- -------- -- --------

where @xmath represents the electron-light interactions (see Sec. 3.4
for its specific form). As usually done in MBPT, @xmath is partitioned
in an (effective) one-particle Hamiltonian @xmath and a part containing
the many-particle effects @xmath .

In our derivation, we take as starting point the KBE’s that we briefly
introduce in Sec. 3.3.1 (see e.g. Refs. [ DKK04 ] for a systematic
treatment). Then, in Sec. 3.3.2 we proceed in analogy with the
equilibrium MBPT: first, we define @xmath as the Hamiltonian of the
Kohn-Sham system, second we introduce the same approximations for the
self-energy operator. As a result we obtain the analogous of the
successful @xmath +BSE approach for the non-equilibrium case. Indeed in
Sec. 3.3.3 we show that our approach, the real-time BSE (RT-BSE), reduce
to the @xmath +BSE in the linear regime. ³ ³ 3 Notice that a real-time
version of the Bethe-Salpeter equation was already proposed in Ref. [
SGHB03 ] as an efficient method to solve the BSE, but it was limited to
the linear response.

#### 3.3.1 The Kadanoff-Baym equations

Within the KBE’s, the time evolution of an electronic system coupled
with an external field is described by the equation of motion for the
non-equilibrium Green’s functions @xmath [ LPK94 , DKK04 , SW02 ] . To
keep the formulation as simple as possible and, being interested only in
long wavelength perturbations, we expand the generic @xmath in the
eigenstates @xmath of the @xmath Hamiltonian for a fixed momentum point
@xmath :

  -- -------- -- --------
     @xmath      (3.12)
  -- -------- -- --------

As the external field does not break the spatial invariance of the
system @xmath is conserved. Notice that both the Green’s functions and
the self-energies will depends from two times @xmath because we are in
an out-equilibrium situation. These two times can be also rewritten in
terms of @xmath and @xmath , where @xmath is the physical time and
@xmath a fictitious time related to quantum correlations.
Within a second-quantization formulation of the many-body problem, the
equation of motion for the Green’s function described by Eq. ( 3.12 )
are obtained from those for the creation and destruction operators.
However the resulting equations of motion for @xmath are not closed:
they depend on the equations of the two-particle Green’s function that
in turns depends on the three-particle Green’s function and so on. In
order to truncate this hierarchy of equations, one introduces the
self-energy operator @xmath , a non-local and frequency dependent
one-particle operator that holds information of all higher order Green’s
functions. A further complication arises with respect to the equilibrium
case because of the lack of time-translation invariance in
non-equilibrium phenomena that implies that @xmath and @xmath depend
explicitly on both @xmath . Then, one can define an advanced @xmath (
@xmath ), a retarded @xmath ( @xmath ), a greater and a lesser @xmath (
@xmath ) self-energy operators (Green’s functions) depending on the
ordering of @xmath on the time axis. Finally, the following EOM for the
@xmath is obtained (see e.g. Ch. 2 of Ref. [ DKK04 ] for more details):

  -- -- -- --------
           (3.13)
  -- -- -- --------

This equation, together with the adjoint one for @xmath , describes the
evolution of the lesser Green’s function @xmath that gives access to the
electron distribution ( @xmath ) and to the average of any one-particle
operator such as for example the electron density [Eq. ( 3.20 )], the
linear polarisation and the current. However, in general @xmath and
@xmath depend on @xmath , so that in addition to Eq. ( 3.13 ) the
corresponding equation for the @xmath has to be solved.

Then, in principle, to determine the non-equilibrium Green’s function in
presence of an external perturbation one needs to solve the system of
coupled equations for @xmath , known as KBE’s. Indeed, this system has
been implemented within several approximations for the self-energy in
model systems [ KKY99 , PvFVA09 ] , in the homogeneous electron gas [
KB00 ] , and in atoms [ DvL07 ] . The possibility of a direct
propagation in time of the KBE’s provided, in these systems, valuable
insights on the real-time dynamics of the electronic excitations, as
their lifetime and transient effects. [ KKY99 , PvFVA09 , KB00 , DvL07 ]
Nevertheless, the enormous computational load connected to the large
number of degrees of freedom de facto prevented the application of this
method to crystalline solids, large molecules and nano-structures. In
the next subsection we show a simplified approach—grounded on the
DFT—that while capturing most of the physical effects we are interest
in, makes calculation of “real-world” systems feasible.

#### 3.3.2 The Kohn-Sham Hamiltonian and an approximation for the
self-energy

In analogy to MBPT for the equilibrium case, we choose as @xmath in
Eq. ( 3.11 ) the Kohn-Sham Hamiltonian, [ KS65 ]

  -- -------- -- --------
     @xmath      (3.14)
  -- -------- -- --------

where @xmath is the electron-ion interaction, @xmath is the Hartree
potential and @xmath the exchange-correlation potential. Within DFT, the
Kohn-Sham Hamiltonian corresponds to the independent particle system
that reproduces the ground-state electronic density @xmath of the full
interacting system ( @xmath ), that is

  -- -------- -- --------
     @xmath      (3.15)
  -- -------- -- --------

where @xmath is the Kohn-Sham Fermi distribution.

The EOM for the @xmath [Eq. ( 3.13 )] can be greatly simplified by
choosing a static approximation for the self-energy,

  -- -------- -------- -- ---------
                          
     @xmath   @xmath      (3.16a)
     @xmath   @xmath      (3.16b)
  -- -------- -------- -- ---------

where the usual choice is @xmath , the so-called Coulomb-hole plus
screened-exchange self-energy (COHSEX) [ FDLvH88 ] . In Eq. 3.16a we
subtracted the correlation effects already accounted by Kohn-Sham
Hamiltonian @xmath . The COHSEX is composed of two parts:

  -- -------- -- --------
     @xmath      (3.17)
     @xmath      (3.18)
  -- -------- -- --------

where @xmath is the Coulomb interaction in the random-phase
approximation (RPA) and @xmath is the time-diagonal lesser Green’s
function @xmath . These two terms are obtained as a static limit of the
@xmath self-energy (see Ch.4 of Ref. [ DKK04 ] and Refs. [ FDLvH88 ,
SBL04 ] ).

If we insert the approximated self-energy Eqs. ( 3.16a )–( 3.16b ) in
Eq. ( 3.13 ), the EOM for the @xmath does not depend anymore on @xmath .
Moreover, since the COHSEX self-energy is local in time, and depends
only on @xmath , Eq.( 3.13 ) can be combined with the adjoint one for
@xmath in such a way to have a closed equation in @xmath :

  -- -------- -- --------
     @xmath      (3.19)
  -- -------- -- --------

where the term @xmath is the induced variation of the Hartree term that
generates the exchange in the BSE, and @xmath is the density obtained
from the @xmath as

  -- -------- -- --------
     @xmath      (3.20)
  -- -------- -- --------

After reducing to a single time, ( 3.19 ) is equivalent to a density
matrix approach with a potential local in time. However, despite the
full real-time COHSEX dynamics [Eq. 3.19 ] is an appealing option
considerably simplifying the dynamics with respect to the KBE’s, it
neglects the dynamical dependence of the self–energy operator. This, in
practice, induces a consistent renormalization of the quasi-particle
charge [ SMH80 ] in addition to an opposite enhancement of the optical
properties. [ MDS03 ] In the COHSEX approximation both effects are
neglected. At the level of response properties for most of the extended
systems dynamical effects are either negligible or very small ⁴ ⁴ 4
Recently it has been shown that dynamical effects in the BSE can be
important for finite systems, see Refs. [ PPHS11 , MR08 ] and it has
been shown that they partially cancel with the quasi-particle
renormalization factors. [ MDS03 ]

Therefore we modify Eq. 3.19 in order to include only the effect of the
dynamical self-energy on the renormalization of the quasi-particle
energies, that is the most important effect. Also in this case, our idea
is to proceed in strict analogy with equilibrium MBPT and to derive a
real-time equation that reproduces the fruitful combination of the
@xmath approximation—for the one-particle Green’s function—and of the
BSE with a static self-energy—for the two-particle Green’s function.
Indeed the @xmath +BSE is the state-of-the-art approach to study optical
properties within MBPT. [ ORR02 ] To this purpose Eq. ( 3.18 ) is
modified as:

  -- -------- -- --------
     @xmath      (3.21)
  -- -------- -- --------

@xmath is a scissor operator [ ORR02 ] that applies the @xmath
correction to the Kohn-Sham eigenvalues, @xmath ,

  -- -------- -- --------
     @xmath      (3.22)
  -- -------- -- --------

and @xmath is the solution of Eq. ( 3.21 ) for the unperturbed system (
@xmath )

  -- -------- -- --------
     @xmath      (3.23)
  -- -------- -- --------

where we assume that the Kohn-Sham Fermi distribution is not changed by
the scissor operator. Note further that in Eq. 3.21 , @xmath cancels out
because it is independent of @xmath .

Equation ( 3.21 ) is the key result of this work. It is equivalent to
assume that the quasi-particle corrections modify only the single
particle eigenvalues leaving unchanged the Kohn-Sham wave functions.
Within equilibrium MBPT this approximation is very successful for a wide
range of materials characterised by weak correlations (see e.g. Refs. [
ORR02 , AJW99 ] ).
Equation ( 3.21 ) can rewritten in term of density matrix as:

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (3.24)
     @xmath   @xmath   @xmath      (3.25)
  -- -------- -------- -------- -- --------

where @xmath and @xmath are the density and the single particle density
matrix at equilibrium. Eq. 3.25 is the Hamiltonian we will use in
combination with dynamical Berry phase to study the non-linear response
in low dimensional systems (see Sec. 3.4 ).

#### 3.3.3 The linear response limit

When an external perturbation @xmath is switched on in Eq. ( 3.21 ), it
induces a variation of the Green’s function, @xmath . In turns, this
variation induces a change in the self-energy and in the Hartree
potential. In the case of a strong applied laser field these changes
depend on all possible orders in the external field. However for weak
fields the linear term is dominant. In this regime it is possible to
show analytically that Eq. ( 3.21 ) reduces to the @xmath +BSE approach
[ Str88 , AJW99 ] . Proceeding similarly to Ref. [ PPHS11 ] we consider
the retarded density-density correlation function:

  -- -------- -- --------
     @xmath      (3.26)
  -- -------- -- --------

@xmath describes the linear response of the system to a weak
perturbation, represented in Eq. ( 3.11 ) by @xmath ,

  -- -------- -- --------
     @xmath      (3.27)
  -- -------- -- --------

We start by expanding @xmath in terms of the Kohn-Sham orbitals:

  -- -------- -- --------
     @xmath      (3.28)
  -- -------- -- --------

where @xmath is the momentum, and we define the matrix elements of
@xmath as,

  -- -------- -- --------
     @xmath      (3.29)
  -- -------- -- --------

Since we are interested only in the optical response, in what follows we
restrict ourselves to the case @xmath and drop the @xmath dependence of
@xmath (for the extension to finite momentum transfer see Ref. [ KB00 ]
). Inserting the expansion for @xmath [Eq. ( 3.28 )], @xmath [Eq. ( 3.20
)] and @xmath ( @xmath ) in Eq. ( 3.27 ) we obtain the following
relation linking the matrix elements of @xmath to the matrix elements of
@xmath :

  -- -------- -- --------
     @xmath      (3.30)
  -- -------- -- --------

Then, we can obtain the equation of motion for the matrix elements of
@xmath by taking the functional derivative of Eq. ( 3.21 ) with respect
to @xmath ,

  -- -------- -- --------
     @xmath      (3.31)
  -- -------- -- --------

Making use of the definitions in Eqs. ( 3.22 ) and ( 3.23 ), together
with Eq. ( 3.30 ), it can be verified that the functional derivative of
the one-electron Hamiltonian and of the external field give the
contribution

  -- -------- -- --------
     @xmath      (3.32)
  -- -------- -- --------

Note that @xmath is invariant with respect to time translations ( @xmath
depends only on @xmath ) since the functional derivative in Eq. ( 3.32
), as in the rest of the section, is evaluated at equilibrium ( @xmath
), and the unperturbed Hamiltonian does not depend on time. The term in
Eq. ( 3.31 ) containing the Hartree potential, which is not directly
depending on the external perturbation. This term is expanded with
respect to @xmath by using the functional derivative chain rule and the
definition of @xmath given by Eq. 3.30 as

  -- -------- -- --------
     @xmath      (3.33)
  -- -------- -- --------

A similar equation can be obtained for @xmath . Equation ( 3.33 ) for
Hartree potential and its analogous for the self-energy can be made
explicit by using

  -- -------- -------- -- --------
     @xmath   @xmath      (3.34)
     @xmath   @xmath      (3.35)
  -- -------- -------- -- --------

where the matrix elements of @xmath and @xmath are labelled accordingly
to Eq. ( 3.29 ). In Eq. ( 3.34 ) @xmath is the bare Coulomb potential,
responsible for the local field effects in the BSE. Then by inserting
Eq. ( 3.34 ) in Eq. ( 3.33 ) the functional derivative for the Hartree
term is

  -- -------- -- --------
     @xmath      (3.36)
  -- -------- -- --------

Similarly, an analogous equation is obtained for the self-energy (see
also Appendix A ),

  -- -------- -- --------
     @xmath      (3.37)
  -- -------- -- --------

where we neglected the part containing the functional derivative of the
screened interaction with respect to the external perturbation. This is
a basic assumption of the standard BSE that is introduced in order to
neglect high order vertex corrections. [ Str88 ]

Finally, we insert Eqs. ( 3.32 ), ( 3.36 ) and ( 3.37 ) in Eq. ( 3.31 ),
and by Fourier transforming with respect to @xmath we obtain

  -- -------- -- --------
     @xmath      (3.38)
  -- -------- -- --------

formally equivalent to the standard BSE.

### 3.4 Optical properties from a real-time BSE

In this section we describe how to combine the many-body Hamiltonian
[Eq. 3.25 ] with dynamical Berry’s phase. Then we validate our approach
against standard GW+BSE results and then apply it to the second harmonic
generation in low dimensional materials.

#### 3.4.1 Practical implementation and validation

As we have seen in Chapter 2 , in order to study non-linear phenomena in
solids and periodic nanostructures we cannot employ the standard dipole
operator used in the linear response formalism. In fact dipole matrix
elements are correct only for bands that do not cross, as for instance
valence and conduction bands. [ Blo62 ] But all physics beyond the
linear regime includes intra-band transitions and transition between
crossing bands.
Modern Theory of Polarisation [ SInV04 , AG13 ] provides the correct way
to couple electrons and external electric fields beyond the linear
regime. In presence of any single-particle Hamiltonian, as for instance
the one in Eq. 3.25 , it is possible to formulate an effective
time-dependent Schrödinger equation as:

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (3.39)
  -- -------- -------- -------- -- --------

Where @xmath are the periodic part of the Bloch states that determines
the system polarisation [Eq. 2.22 ], and the last term in the r.h.s
describes the coupling with the external field (see Chapter 2 ). Notice
that other choices consistent with the periodic boundary conditions are
possible, as for example an external field with the cell periodicity [
NFN01 ] , or an electric field with a finite momentum @xmath [ KB00 ] .
In these two cases we do not need the Berry’s phase formulation even in
the length gauge.
In order to illustrate and validate the real-time BSE approach and our
numerical implementation, we present an example on h -BN. This is a wide
gap insulator whose optical properties are strongly re-normalised by
excitonic effects and for which all the parameters necessary in DFT,
@xmath and response calculations, are known from previous studies [
WMR06 , WMG @xmath 08 , AGM11 ] . In this example we used Eq. ( 3.39 ),
with and without the self-energy terms. We refer to the former
approximation as RT-BSE, and to the latter as TDH. Within equilibrium
MBPT these two approximations would correspond to the BSE and RPA, and
in fact they reduce to BSE and RPA within the linear response limit
(Sec. 3.3.3 ).

In the example (Fig. 3.1 ), we simulated h -BN interacting with a weak
delta-like laser field. A delta-like laser field probes all frequencies
of the system and the Fourier transform of the macroscopic
polarizability provides directly the susceptibility, and thus the
dielectric constant:

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (3.40)
     @xmath   @xmath   @xmath      (3.41)
  -- -------- -------- -------- -- --------

Since we use a weak field, we expect negligible nonlinear effects. Then
accordingly with Sec. 3.3.3 , the results from RT-BSE and TDH can be
directly compared with the BSE and RPA within the standard MBPT
approach. All computational details are reported in Ref. [ AGM11 ] .
Indeed, in Figs. 3.1 (b) , 3.1 (d) the imaginary part of the dielectric
constant (optical absorption), obtained by Fourier transform of the
polarisations in Figs. 3.1 (a) , 3.1 (c) , is indistinguishable from
that obtained within equilibrium MBPT, validating our numerical
implementation. Beyond the linear regime we use the scheme described in
Sec. 2.5 to extract the non-linear coefficients that describe high order
response functions.

#### 3.4.2 Second Harmonic Generation in h-BN and MoS@xmath monolayers

In this section we apply the RT-BSE to study second harmonic
generation(SHG) in two dimensional crystals. [ ANCG15 , GA14a , GA14b ]
In recent years hexagonal boron nitride (h-BN) and the rich family of
transition metal di-chalcogenides, has attract the attention of the
scientific community for the possible applications to optoelectronics
and photonics. [ EM13 , M @xmath 13 ] Low dimensionality is responsible
for the unique electronic and optical properties of 2D crystals, but at
the same time is their limiting factor: because of the extremely short
optical absorption length the light-matter interaction in absolute terms
is inherently weak, though relatively very strong. [ EM13 ] Therefore
ongoing research focuses on finding out physical mechanisms to enhance
the SHG in those materials.

On a more fundamental level, SHG is extremely interesting since it
allows to probe symmetries and excitations not visible in the linear
regime [ L @xmath 13 , KNC @xmath 13 ] . In both cases it is important
to have the support and guide from the theory through accurate and
reliable numerical simulations.

Using the methodology developed in the previous chapters we investigate
the SHG in h-BN and MoS @xmath monolayers, two materials with promising
applications in optoelectronic and photonic devices. These two materials
share an hexagonal 2D structure but their electronic and optical
properties are quite different. The optical absorption of h-BN is
dominated by two very bright and strongly bound excitons. [ WMR06 , WMG
@xmath 08 ] Instead the optical absorption of MoS @xmath is
characterised by a weakly bound exciton, split by spin-orbit coupling, [
MLH @xmath 10 ] and by a brighter exciton in the continuum at about
3 eV. [ MSSH @xmath 13 ]

The interpretation of the linear optical properties of these materials
has been possible through ab initio calculations (e.g. Refs. [ MSSH
@xmath 13 , WMG @xmath 08 ] ). These computational studies captured the
peculiar nature of excitons in nanostructures [ SR06 ] by the inclusion
of the relevant correlation effects.

In contrast, large part of calculations of nonlinear optical properties
employ the independent particle approximation [ GL05 , MMG13 ] (IPA)
which are inadequate for low dimensional systems (see Fig. 3.2 ). [ SR06
]

In order to investigate the contribution of correlation effects on the
SHG spectra of h-BN and MoS @xmath monolayers, we use the RT-BSE
approach developed in this chapter. For both materials we disclose the
signature of bound excitons and show that excitonic effects not only
significantly modify the shape of the spectrum with respect to the IPA,
but strongly enhance its intensity. In the conclusions we comment how
this finding may open the possibility of engineering the SHG signal in
these materials.

##### Results

In order to simulate isolated hexagonal-BN and MSo @xmath monolayers we
used a supercell approach with a large distance between the sheets. Then
we propagate the time-dependent Schrödinger equation with the
Hamiltonian derived in Eq. 3.25 . Non-linear coefficients are obtained
from the real-time polarisation [Eq 2.22 ] as described in chapter 2 and
all numerical details are presented in Ref. [ GA14b ] .

##### h-BN monolayer

Hexagonal Boron-Nitride is a transparent insulating material with a
large band gap of about @xmath . Its optical properties are dominated by
strong bound excitons and they are nearly independent from the layers
arrangement. [ WMR06 , WMG @xmath 08 ] The single layer h-BN inherits
all these properties from its bulk counterpart.

In Fig. 3.3 we report the calculated absolute value of @xmath at
different levels of approximation. @xmath , where @xmath and @xmath are
the in-plane Cartesian directions, is the only independent in-plane
component of @xmath : all other components can be obtained from the
@xmath with simple symmetry considerations, for instance @xmath .

At IPA level [Fig. 3.3 (a)], the SHG presents a peak at @xmath and a
broad structure between @xmath . By comparison with the imaginary part
of the dielectric constant @xmath both at @xmath and @xmath [Fig. 3.3
(b)] calculated at the same level of theory, we can attribute the peak
at @xmath to two-photon resonances with @xmath transitions, and the
broad structure mostly to one-photon resonances with @xmath transitions,
with contributions around @xmath of two-photon resonances with @xmath
transitions.

This level of theory is the one usually employed in theoretical
calculations of SHG: in fact results for the h-BN monolayer were
previously obtained by Guo and Lin: [ GL05 ] Fig. 3.4 shows a very good
agreement between our results and those obtained in Ref. [ GL05 ] . In
the following we show how effects beyond the IPA—that is the additional
terms in Eq. ( 3.25 )—modify the SHG spectrum.

We start by adding crystal local field effects, included at the TDH
level [Fig. 3.3 (a)]. Because of the weak in-plane inhomogeneity of the
h-BN, local field effects are quite small—though they are not negligible
as for the absorption spectrum [Fig. 3.3 (b)]—and results in the
reduction of about 20% of the peak at @xmath . Next we consider the
renormalization of the band structure by quasiparticle corrections
within the @xmath approximation (IPA+ @xmath ) [Fig. 3.3 (c)]. For h-BN
this renormalization can be safely approximated by a rigid shift of the
conduction bands. Differently from the absorption spectrum [Fig. 3.3
(d)], the SHG is not simply shifted by @xmath corrections, but its shape
changes remarkably as a consequence of the more involved poles structure
of the second order susceptibility. [ LHV10 , HS96 ] In fact, the IPA+
@xmath shows two peaks: the first at about @xmath is the shifted
two-photon @xmath resonances peak which is attenuated by 40% with
respect to IPA [Fig. 3.3 (a)]; the second very pronounced peak at about
@xmath comes from the interference of @xmath one-photon resonances and
@xmath two-photon resonances.

Finally, in Fig. 3.3 (e) we consider the full Hamiltonian in Eq. ( 3.25
). In particular we add the self-energy terms that introduces an
attractive interaction between the excited electrons and holes [ Str88 ]
. The SHG spectrum presents four sharp and strong peaks and its onset is
red-shifted by about @xmath with respect to the the IPA+ @xmath [Fig.
3.3 (c)]. By comparing with the imaginary part of the dielectric
constant @xmath both at @xmath and @xmath [Fig. 3.3 (f)] calculated at
the same level of theory, the two couples of peaks can be identified
respectively as the two- and one-photon resonances with the excitons at
@xmath and @xmath . Fig. 3.3 (e) also shows again the SHG within the IPA
to emphasise the striking difference between the two spectra: the RT-BSE
spectrum presents features that are missing in IPA and more importantly
is twice as strong than IPA at the exciton resonances.

In Table 3.1 we report the value of the second optical susceptibility at
@xmath , @xmath , extrapolated from the SHG behaviour at small
frequencies. Again, at the IPA level our result agrees with the one of
Guo and Lin [ GL05 ] within the error bar. Adding the effects beyond
IPA, modifies the @xmath value, and in particular within RT-BSE we found
a value smaller by about 10% than at the IPA level.

Excitonic effects in SHG spectrum have been treated as well in a TD-DFT
framework [ LHV10 ] by using the so-called long-range-corrected (LRC)
approximation, [ BSV @xmath 04 ] a semi-empirical simple model for the
screened electron-hole attraction, that includes only the long-range
part of the interaction. In Fig. 3.3 (f) we see the @xmath calculated
within the LRC approximation: as earlier recognised, this approximation
fails for strong excitons. In fact by tuning the empirical parameter for
the screening we could get the position of the first exciton, though its
intensity is strongly overestimated (see caption of Fig. 3.3 ), but in
no way we could get the second excitonic peak. Those pitfalls would be
reflected in the SHG spectrum, though we did not test it in our
approach. Then clearly the h-BN monolayer and similar low dimensional
materials with strong excitonic effects cannot be treated within the
approach proposed in Ref. [ LHV10 ] .

##### MoS@xmath monolayer

MoS @xmath differs from h-BN in several aspects. First, while the h-BN
has an indirect minimum band gap as its bulk counterpart, in MoS @xmath
an indirect-to-direct band gap transition occurs passing from the bulk
to the monolayer due to the vanishing interlayer interaction. Second,
spin-orbit coupling plays an important role in this material, splitting
the top valence bands, as visible from the absorption spectrum,
presenting a double peak at the onset. [ MLH @xmath 10 ] Third, Mo and S
atoms in the MoS @xmath monolayer are on different planes resulting in a
larger inhomogeneity than for the h-BN. Figure 3.5 presents the SHG
spectra @xmath at the different level of approximations of Eq. ( 3.25 ).
At the lowest IPA level [Fig. 3.5 (a)], the SHG presents three main
features: a small peak at 1 eV, which originates from two-photon
resonances with transitions close to the minimum gap at the @xmath
point; a larger peak around @xmath eV, which originates from two-photon
resonances with transitions along the high symmetry axis between @xmath
and @xmath where the highest valence and lowest conduction bands are
flat and there is a high density of states; a broad structure between
@xmath eV which originates from one-photon resonances with transitions
at @xmath and along @xmath and two-photon resonances with transitions to
higher conduction bands. Note that we do not include spin-orbit coupling
in Eq. ( 3.25 ). The latter is expected to split the lowest peak into
two weaker sub-peaks [ MSSH @xmath 13 ] , but to leave unaffected the
second peak, the most important when it comes to applications and
central to our analysis. [ M @xmath 13 ] Because of the quite strong
inhomogeneity of the MoS @xmath monolayer, the addition of crystal local
field effects within the TDH strongly modifies the SHG [Fig. 3.5 (b)].
In particular the main peak at @xmath eV merges with the plateau at
@xmath eV while a peak appears around @xmath eV. Finally, within the
RT-BSE, we add the quasi-particle effects and electron-hole interaction
[Fig. 3.5 (c)]. The small shoulder around @xmath eV, below half of the
@xmath gap (1.25 eV, grey dotted vertical line in the figure),
originates from two-photon resonances with the bound excitons around
@xmath eV which are well visible in the experimental absorption spectra.
[ MLH @xmath 10 ] The main peak at about @xmath eV, present in the IPA
spectrum but washed out by local field effects within the TDH, is
restored by the electron-hole interaction and its intensity is two times
larger than in the IPA case. This peak corresponds to a two-photon
resonance with the bright exciton at 3 eV observed in the absorption
spectrum, [ MSSH @xmath 13 ] and its position and shape agrees well with
the experimental measurements of Malard et al. [ M @xmath 13 ] for the
SHG between @xmath eV, also reported in Fig. 3.5 (c). The calculated
spectrum also shows a strong one-photon resonance with this exciton at
3 eV. With respect to h-BN, where the IPA is clearly inadequate when
compared with the RT-BSE [Fig. 3.3 (e)], here IPA and RT-BSE presents
similar features, at approximately the same position [Fig. 3.5 (c)]. In
fact, this different behaviour could be expected from the linear optical
response of these materials, as discussed in the Introduction.
Nevertheless, also in this case the electron-hole interaction proved to
be key for SHG as it doubles the intensity of the main peak in the
visible range, the one that is relevant for applications in nonlinear
optics.

### 3.5 Conclusions

We presented a novel approach for ab-initio calculation of linear and
non-linear optical properties in bulk materials and nano-structures that
uses a real-time extension of the BSE. The proposed approach combines
the flexibility of a real-time approach with the strength of MBPT in
capturing electron-correlation. It allows to perform computationally
feasible simulations beyond the linear regime. Being the approach based
on the non-equilibrium Green’s Function theory, it is possible to
include effects such as lifetimes, electron-electron scattering [ PPHS11
] and electron-phonon coupling [ Giu16 ] in a systematic way. We
validated the RT-BSE in the case of h -BN calculating the optical
absorption and comparing it with the results from equilibrium GW+BSE,
then we applied the same methodology to study the non-linear response of
two-dimensional crystals. We found that electron-hole interaction
greatly enhances the SHG signal in 2D crystals with respect to the
independent-particle picture. Specifically, for the h-BN monolayer one-
and two-photons resonances with bound excitons produce strong signatures
in the SHG spectrum with intensities two times larger than expected from
the IPA. In MoS @xmath , though the shape of the spectrum is not
strikingly modified by excitonic effects as for h-BN, the electron-hole
interaction enhances, again by about 200%, the SHG signal in the visible
range with respect to the IPA. This finding may provide a spin-off for
the quest of materials with high SHG. In fact—given that the SHG signal
depends largely on the electron-hole interaction that in turn depends on
the electronic screening—the SHG intensity can be tuned by changing the
electronic screening. Then, it may be possible, as proposed in Ref. [ G
@xmath 12 ] , to engineer meta-materials with a high SHG by combining
layers of different 2D crystals [ G @xmath 12 ] so to change the
electronic screening, and further enhance the electron-hole interaction
effects. As side finding, our results emphasise that it is critical for
theoretical and computational approaches to accurately include
electron-hole interaction, together with quasiparticle and local field
effects, in order to predict non-linear optical response in low
dimensional materials. In this regard, our recently proposed approach [
AG13 , AGM11 ] is quite promising as it imports into the very flexible
real-time framework—apt to treat nonlinear optics—the combination of
BSE+ @xmath successfully applied to the linear optical response of
low-dimensional materials.
The interested reader can find other applications of the RT-BSE in Refs.
[ ANCG15 , ACG17 ] .

## Chapter 4 Density functional polarisation theory

### 4.1 Time-dependent Density Functional Theory in periodic systems

Density functional theory (DFT) [ KS65 , HK64 ] is a standard approach
for calculating ground-state properties of extended and finite systems [
KBP96 , Jon15 ] . Time-dependent density functional theory (TDDFT) is an
extension of the ground-state formalism that allows to investigate the
properties and dynamics of many-body systems in the presence of
time-dependent potential. TDDFT is based on the Runge-Gross (RG) theorem
[ RG84 ] that establishes a one-to-one correspondence between
time-dependent densities and time-dependent one-body potentials. For
example when we consider an isolated molecule and an electric filed as
perturbation by means of TDDFT we have access its optical response. As
for the DFT case, the RG theorem just guarantees the existence of the
mapping, but do not provide a way to construct it. Different
approximations for the time-dependent (or frequency dependent)
exchange-correlation functional have been proposed in the literature.
Exchange correlation functional have been obtained from the ones of the
DFT, including long range corrections or derived from more accurate
methods [ ORR02 , FBA @xmath 14 ] . The response equations of TDDFT have
been encoded in standard quantum chemical packages [ VBG @xmath 10 ] ,
and real-time TDDFT is currently used to simulate the short time
dynamics of excited electrons [ CAO @xmath 06 ] .
Despite the success of TDDFT in molecular systems, the situation is more
complicated in extended system. In fact, although other methods, as for
instance Green’s function theory [ Str88 ] , provide a similar accuracy
in extended [ AJW99 ] and finite systems [ BA11 , FDD @xmath 12 ] , this
is not the case of TDDFT.
Due to the lower computational cost of TDDFT respect to Green’s function
formalism it would be desirable to have the same accuracy in extended
and finite systems.
The first idea one can have it is that the available exchange
correlation functionals, for some reason, are not enough precise to
describe excitation in solids. Unfortunately the problem is more
serious. [ MSB03 ] In order to understand from where the problem
originates, let’s go back to the original statement of the RG theorem.
In the first part of the proof, RG established a one-to-one
correspondence between potentials and currents. Then in the second part
of their work, they used the continuity equation to relate currents to
densities in order to prove the mapping between densities and
potentials. The problem in the RG proof stays in the use of the
continuity equation. As we saw in the introduction to chapter 2 there is
not a univoque mapping between current and density in periodic systems.
In fact the mapping between currents and densities requires that certain
surface integral involving the density and the potential vanishes. For
finite systems this condition can be given rigorously at the surface in
which the density vanishes. For a periodic system, one might try to
choose a surface around which the density and potential are periodic but
for a uniform field the linearity of the potential prevents this, and
TDDFT does not apply.
The problem of TDDFT in periodic system was also illustrated by means of
a simple example in the paper of Maitra et. al. [ MSB03 ] . They
considered a free electron gas on a ring subjected to a constant uniform
electric field. In this case it is possible to write down the exact
solution of the problem. One finds that the electric field modifies only
the phase of the single particle orbitals, leaving the density
unchanged. This result shows that different electric fields give rise to
exactly the same density and therefore there is not an unique mapping
between density and external field.
In order to solve the problems with TDDFT in periodic systems and
extension was presented some years ago, the Time-Dependent Current
Density Functional Theory(TDCDFT) [ GD88 ] . This formulation uses the
direct mapping between the external potential and the current density,
without reels on the continuity equation.
In this section we will use a simplified versions of TDCDFT, i.e. the
Density-Functional Polarization Theory (DFTP). In DFTP one uses the
relation between polarization and current to construct a theory that
relies on density and polarization instead of current density. The
possibility to use the polarisation as additional variable besides the
density it is a valid approximation when it is possible to disregard the
transverse term of the current. Since we are interested in the optical
response in the limit of long-wave length limit, this is a valid
approximation.
In the rest of this chapter we will introduce DFTP, and explain how to
build functionals in term of polarization and density. Then we will use
these functionals in our real-time approach to study non-linear response
of bulk semiconductors.

### 4.2 General Introduction

In periodic systems in presence of a time-dependent homogeneous electric
field only the one-to-one correspondence between the time-dependent
currents and potentials (scalar and vector) can be established and
time-dependent current density functional theory (TD-CDFT) is then the
correct theoretical framework. [ MSB03 , GD88 ] In particular it is the
optical limit, i.e. the case in which the transferred momentum @xmath ,
which cannot be described starting from the density only. One could
still work with functionals that depends on the density–only, but there
is a price to pay. All the equations have to be worked out with a finite
but very small momentum and the @xmath limit can be performed only at
the end of the calculation. Furthermore in order to describe excitonic
effect the exchange–correlation functionals have to be ultra–nonlocal
and to diverge as @xmath . [ RORO02 ] Such an approach is used within
the linear response framework but it is not feasible within a real time
framework since for practical reasons calculations have to be performed
directly at @xmath . Thus one needs to go beyond the density–only
treatment. As a clear indication of this, the macroscopic polarisation
and the response functions cannot be calculated within a density–only
scheme at @xmath . [ Mar74 ] Problems are not limited to the
time–dependent case. Even in the static limit, e.g. for dielectrics in a
static homogeneous electric field, Gonze and coworkers proved that “the
potential is not a unique functional of the density, but depends also on
the macroscopic polarisation” . [ GGG95 ] In this case then the theory
has to be generalised to consider functionals of both the density and
the polarisation in what is called density–polarisation functional
theory (DPFT). The latter can be obtained from TD-CDFT in the static
limit.

Here we propose a real–time approach based on DPFT for calculating the
optical response properties of dielectrics, thus considering functionals
of both the time–dependent density and the macroscopic bulk
polarisation. Real–time approaches allows in principle to calculate the
optical response at all order so to access nonlinear properties [ TVR07
] , including nonperturbative extreme nonlinear phenomena [ LKS @xmath
14 ] and to simulate real–time spectroscopy experiments. [ OSSY15 ] It
is highly desirable then to have computational inexpensive first
principles real–time approaches, such as TD-DFT, that include excitonic
effects. In particular here we consider an effective electric field
which is a functional of the macroscopic polarisation. We employ simple
local functionals of the polarisation [ MSB03 , Ber15 ] either fitted to
reproduce the linear optical spectra [ BSV @xmath 04 ] or derived from
the jellium with gap model kernel. [ TTC @xmath 13 ]

In the following, we review DPFT and we extend it to the case of
time-dependent electric fields. We discuss briefly the approximations
for the effective-electric field and we present how the relevant
response functions are calculated from the macroscopic polarisation.
Then, we show that for the optical absorption, the second- and
third-harmonic generation of semiconductors the simple local functionals
of the polarisation account for excitonic effects similarly to the
ultranonlocal kernel within the density-only response framework. In the
conclusion we discuss the proposed approach as an alternative to
existing schemes based on TD-DFT and TD-CDFT.

### 4.3 Density polarisation functional theory

#### 4.3.1 Static case

An infinite periodic crystal (IPC) in a macroscopic electric field
@xmath does not have a ground-state. Therefore the Hohenberg-Kohn
theorem cannot be applied and DFT cannot be used. In particular the
density does not suffice to describe the system as the one-to-one
mapping between density and external potential does not hold: one can
devise an external macroscopic electric field that applied to a system
of electrons in an IPC does not change its density @xmath . The works of
Gonze Ghosez and Godby, [ GGG95 ] Resta [ Res96 ] , Vanderbilt [ Van97 ]
and of Martin and Ortiz [ MO97 ] established that in addition to the
density, the macroscopic (bulk) polarisation @xmath is needed to
characterise IPC in a macroscopic electric field. With some cautions the
proof of the Hohenberg-Kohn theorem can be extended [ MO97 ] to
demonstrate the existence of the invertible mapping

  -- -------- --
     @xmath   
  -- -------- --

where @xmath is the periodic microscopic part of the external potential.
Then the total energy of an IPC is a functional of both the electron
density @xmath and the macroscopic polarisation @xmath :

  -- -------- -- -------
     @xmath      (4.1)
  -- -------- -- -------

where @xmath , the internal energy, is a universal functional of both
@xmath and @xmath (see Ref. [ MO97 ] for details), and is defined in the
usual way as the sum of the expectation the kinetic and
electron-electron interaction operators

  -- -------- -- -------
     @xmath      (4.2)
  -- -------- -- -------

The difference with the internal energy within standard DFT is that the
@xmath -particle wavefunction @xmath is not an eigenstate of the
original Hamiltonian (which does not have a ground state), but of an
auxiliary Hamiltonian which commutes with the translation operator (see
Ref. [ MO97 ] for details). Notice that DPFT is not the only way to
treat IPC in a electric field within a density functional framework: as
an alternative Umari and Pasquarello proposed @xmath -DFT, a density
functional theory depending on the electric field. [ UP05 ]

The Kohn-Sham equations can be extended as well to treat IPC in a
macroscopic electric field. [ MO97 ] In particular the Kohn-Sham crystal
Hamiltonian takes the form:

  -- -------- -- -------
     @xmath      (4.3)
  -- -------- -- -------

which is a functional of both the density and the polarisation. In Eq. (
4.3 ) the Kohn-Sham microscopic (periodic) potential @xmath is defined
as

  -- -------- -- -------
     @xmath      (4.4)
  -- -------- -- -------

@xmath , @xmath are respectively the microscopic external and Hartree
potential. The total classical potential is defined as @xmath . @xmath
is the functional derivative of the exchange–correlation energy with
respect to the density. @xmath here describes the field generated by the
ions, i.e. the electron–ion interaction in the Coulomb gauge and
neglecting retardation effects. The last term of the RHS of Eq. ( 4.3
)—that originates from the last term in the RHS of Eq. ( 4.1
)—constitutes the key difference with respect to the zero-field KS
equations. @xmath is the polarisation operator derived by
functional-differentiating @xmath [Eq. ( 2.22 )] with respect to the KS
eigenstates. @xmath is the KS macroscopic field

  -- -------- -- -------
     @xmath      (4.5)
  -- -------- -- -------

that contains the corresponding macroscopic components of @xmath . Note
that these macroscopic components cannot be included via the potential
which would be ill defined when imposing periodic boundary conditions.
The @xmath is defined as the partial derivative of the xc energy with
respect to the polarisation density field. The sum of the macroscopic
external and Hartree fields defines the total classical field:

  -- -------- -- -------
     @xmath      (4.6)
  -- -------- -- -------

At zero-field, that is when no macroscopic external electric field
@xmath is applied, the macroscopic component of the ionic potential and
of the Hartree component exactly cancel as a consequence of the charge
neutrality of the system and the macroscopic xc component vanishes. In
this situation standard density-only functional theory can be used.

As @xmath and @xmath are functionals of the density and the
polarisation, the Kohn-Sham equations for the KS orbitals @xmath have to
be solved self-consistently with the density (spin unpolarized case)

  -- -------- -- -------
     @xmath      (4.7)
  -- -------- -- -------

and the polarisation expressed in terms of a Berry phase [Eq. ( 2.22 )].

#### 4.3.2 Time-dependent case

The Runge-Gross theorem [ RG84 ] is the basis of TD-DFT. It establishes
the one-to-one mapping between the time-dependent scalar potential and
the time-dependent density. For the case in which a time-dependent
vector potential is present Ghosh and Dhara [ GD88 ] showed that the
mapping can be established between the current-density and the vector
potential. More recently Maitra and co-workers [ MSB03 ] showed that
TD-CDFT is the correct framework for IPC in homogeneous electric fields.

The time-dependent change in the polarisation density field @xmath is
related to the time-dependent current-density @xmath by

  -- -------- -- -------
     @xmath      (4.8)
  -- -------- -- -------

In a dielectric we can then use either @xmath or @xmath as main variable
to describe an IPC in a time-dependent finite homogeneous electric
field. Furthermore we can consider separately the microscopic and the
macroscopic components of @xmath : @xmath and @xmath . The latter
quantity is fully determined by the density through the continuity
equation. Then we can extend to the time-dependent case the one-to-one
mapping

  -- -------- --
     @xmath   
  -- -------- --

The time–dependent Kohn-Sham crystal Hamiltonian has the same form of
the equilibrium KS Hamiltonian [Eq. ( 4.3 )] with the only difference
that now potentials and wavefunctions are time–dependent:

  -- -------- -- -------
     @xmath      (4.9)
  -- -------- -- -------

We rewrite the external field and potential as the contribution at
equilibrium, @xmath and @xmath plus the time-dependent perturbation:

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (4.10)
     @xmath   @xmath   @xmath      (4.11)
  -- -------- -------- -------- -- --------

Then,

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (4.12)
     @xmath   @xmath   @xmath      (4.13)
  -- -------- -------- -------- -- --------

where the @xmath superscript denotes that the functional is evaluated in
presence of the equilibrium fields, thus at equilibrium density and
polarisation. We then restrict ourselves to consider the case with no
external macroscopic electric field at equilibrium, i.e. @xmath , and to
a macroscopic-only time dependent perturbation, i.e. @xmath . Therefore

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (4.14)
     @xmath   @xmath   @xmath      (4.15)
  -- -------- -------- -------- -- --------

Finally, the TD-KS equations for the periodic part @xmath of the Bloch
function can be expressed as

  -- -------- -- --------
     @xmath      (4.16)
  -- -------- -- --------

and have to be solved consistently with the time-dependent density and
polarisation. The latter has the same form of the static polarisation
[Eq. ( 2.23 )] with the difference that @xmath are the time-dependent
valence bands.

In the time dependent case and within the EDA, it can be shown
straightforwardly that the Hamiltonian in Eq. ( 4.9 ) can be derived
from the KS Hamiltonian of TD-CDFT with a gauge transformation from the
velocity to the length gauge. [ MSB03 ]

### 4.4 Expressions for the Kohn-Sham electric field

The KS electric field in Eq. ( 4.5 ) is the sum of three components. It
seems natural to consider the external component @xmath as an input of
the calculation, i.e. @xmath . The total classical field @xmath is then
calculated from Eq. ( 4.6 ) by adding the Hartree component that in the
EDA is the polarisation @xmath . This is not the only possible choice
nor always the most convenient. When calculating linear and nonlinear
optical susceptibilities, which do not depend on the total or external
fields, it is numerically more convenient to choose the total classical
field as input field. As this work objective is the calculations of
optical susceptibilities we adopt indeed @xmath . The two choices for
the input field, i.e. either the total or external field, have been
referred as “longitudinal geometry” and “transverse geometry” by Yabana
and coworkers [ YSS @xmath 12 ] and are discussed in more length in
Appendix B .

While the choice of the input field is a matter of computational
convenience, the choice of the expression for the xc macroscopic
electric field is critical to the accuracy of the results. Like the
microscopic xc potential no exact expression is known and one should
resort to an approximation for the functional form of the xc field.
Contrary to the microscopic xc potential for which hundreds of
approximations exist, [ MOB12 ] except for the work of Aulbur and
coworkers [ AJW96 ] we are not aware of approximations for the xc
macroscopic field. What does exist in the literature are xc kernels
within the TD-DFT and TD-CDFT that give a non-zero contribution to the
response in the optical limit. In what follows we link the xc kernel
with the macroscopic field (similarly to Refs. [ MSB03 , Ber15 ] ). In
fact in the linear response limit the exchange-correlation electric
field is related to the polarisation @xmath (see for example Refs. [
MSB03 ] , [ Ber15 ] ) through the xc kernel @xmath . The latter
describes how the xc electric field (both microscopic and macroscopic)
changes when the polarisation is perturbed. @xmath can be defined
independently through the Dyson equation connecting the polarisation
response function of the physical system, @xmath , to the polarisation
response function of the KS system, @xmath . By rewriting the relation
between @xmath and @xmath in reciprocal space ¹ ¹ 1 In general the
expression of the xc electric field in terms of @xmath is an integral
along a path in the infinite dimensional space of the
densities/macroscopic polarizations. Such integral does not depend on
the path if @xmath is defined as a functional derivative of some
function. Furthermore here we consider the case where @xmath is a local
(or semi–local) functional. Then the infinite dimensional integral
reduces to a simple three-dimensional integral which, in reciprocal
space, can be represented as a sum over the @xmath vectors. one obtains
[ MSB03 ] for the macroscopic component ( @xmath )

  -- -------- -- --------
     @xmath      (4.17)
  -- -------- -- --------

and for the microscopic components @xmath ( @xmath )

  -- -------- -- --------
     @xmath      (4.18)
  -- -------- -- --------

The first term on the RHS of Eq. ( 4.17 ) is directly proportional to
the macroscopic polarisation, the second term involves the density and
is the microscopic contribution to the macroscopic field. Note that as
we assume the EDA we do not have the contribution from the microscopic
transverse current as in Maitra and coworkers. [ MSB03 ] The variation
of the microscopic xc potential @xmath can be written in terms of the
microscopic components @xmath as

  -- -------- -- --------
     @xmath      (4.19)
  -- -------- -- --------

Berger [ Ber15 ] has recently proposed an approximation for @xmath from
current-density functional theory. The approximation however requires
the knowledge of the Random-Phase-approximation (RPA) static dielectric
function: while within a linear response approach this does not require
any additional calculation, within a real-time approach the RPA static
dielectric function needs to be computed beforehand. Furthermore Berger
[ Ber15 ] neglects the microscopic contribution.

An alternative way to derive approximations for @xmath is to rely on the
standard TD-DFT xc kernel @xmath . The latter describes how the xc
potential changes when the density is perturbed and is defined from the
Dyson equation relating the density-density response of the physical and
the KS system. The two kernels can be related via the equation

  -- -------- -- --------
     @xmath      (4.20)
  -- -------- -- --------

where @xmath is the metric tensor.

For example the long-range corrected (LRC) approximations @xmath , which
take the form

  -- -------- -- --------
     @xmath      (4.21)
  -- -------- -- --------

can be used. Then @xmath can be approximated with any of the @xmath (we
assume @xmath ) proposed in the literature. Unfortunately all the
approximations proposed so far [ BSV @xmath 04 , BFN @xmath 05 ] neglect
the dependence of @xmath on the reciprocal lattice versors. Furthermore
most of the approximations relies on empirical parameters, with the
exception of the family of bootstrap kernels [ RBV @xmath 15 , SDSG11 ]
that relate @xmath to the electronic screening in an expression
equivalent to that derived by Berger from TD-CDFT.

In this work, we derive the @xmath needed in Eq. ( 4.17 ) from the
Jellium with Gap Model (JGM) kernel proposed by Trevisanutto and
coworkers. [ TTC @xmath 13 ] The latter kernel is a functional of the
electronic density @xmath and of the fundamental gap of the material
@xmath . In the optical limit the JGM kernel takes the form of a
long-range corrected approximation with @xmath defined as the cell
average [ TTC @xmath 13 ] of

  -- -------- -- --------
     @xmath      (4.22)
  -- -------- -- --------

In the equation above @xmath , where @xmath is a functional of the
density found by fitting the local field factor of the homogeneous
electron gas from Quantum Montecarlo data. [ CDSOP98 ]

For cubic systems we thus consider @xmath with

  -- -------- -- ---------
                 
     @xmath      (4.23a)
     @xmath      (4.23b)
  -- -------- -- ---------

where @xmath is the Fourier transform of Eq. ( 4.22 ) and @xmath is the
identity tensor. Notice that we symmetrized @xmath so to obtain a
Hermitian kernel. Other strategies of symmetrization have been proposed
in the literature, see Ref. [ TTC @xmath 13 ] and reference therein.
Like standard approximations for the kernel this approximation neglects
memory effects (i.e. the macroscopic field at time @xmath depends on the
values of the density and polarisation only at time @xmath ) and it is
thus frequency independent.

Finally, inserting this approximation for the kernel [Eq. ( 4.23 )] in
the expression for the xc fields [Eq. ( 4.17 )–( 4.18 )] and using Eq. (
4.19 ) we obtain

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      
     @xmath   @xmath   @xmath      (4.24)
  -- -------- -------- -------- -- --------

where the second term in the RHS of Eq. ( 4.18 ) is zero due to our
symmetrization strategy [Eq. ( 4.23 )]. In our calculations we will use
either Eq. ( 4.24 ) and or an @xmath approximation for the macroscopic
xc electric field in which @xmath is a parameter which gives the best
agreement between the computed and experimental optical absorption
spectra. The two approximations will be referred as JGM polarisation
function (JGM-PF) and optimal polarisation functional (opt-PF).

### 4.5 Computational details

The eigensolutions @xmath of the zero-field Hamiltonian are calculated
using the plane-wave pseudopotential density-functional code abinit [
GBC @xmath 02 ] within the local density approximation for the
exchange-correlation energy. All the numerical details regarding the
atomic structure, the number of bands, cutoff and pseudopotential are
detailed in Ref. [ GSA16 ] . Respect the previous chapters, here we used
a finite difference five-point midpoint formula, proposed by Nunes and
Gonze, [ NG01 ] to calculate the @xmath -derivative appearing the EOM [
Eq. 2.31 ].

  -- -------- -- --------
     @xmath      (4.25)
  -- -------- -- --------

where @xmath is the number of @xmath -points along the reciprocal
lattice vector @xmath and

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (4.26)
     @xmath   @xmath   @xmath      (4.27)
  -- -------- -------- -------- -- --------

In the definition for the projector [Eq.( 4.27 )] @xmath are
gauge-covariant, [ SInV04 ] i.e. are constructed so that transform under
unitary transformation in the same way as @xmath (see Section 2.4.2 ).
The truncation error in this expression converges as @xmath whereas the
three-point midpoint formula proposed in Ref. [ SInV04 ] and used in our
previous works [ AG13 , GA14b ] converges as @xmath . Though more
cumbersome, we prefer Eq. ( 4.25 ), since we noticed that when using
polarisation dependent functionals the EOMs are very sensitive to
numerical error. The final EOM we propagate is

  -- -------- -- --------
     @xmath      (4.28)
  -- -------- -- --------

where @xmath is the time-dependent Kohn-Sham crystal Hamiltonian [ Eq.
4.9 ], @xmath is the scissor operator and @xmath is a phenomenological
dephasing operator defined in Sec. 2.5 .

### 4.6 Results

We considered the optical properties of bulk Si, which has a diamond
structure, and GaAs, AlAs and CdTe, which have zincblende structure. The
two structures are similar, both are face-centred cubic systems with a
two atom basis (at the origin, and at 1/4 of the unit cell in each
direction). In silicon the two atoms are identical, in the zincblende
structures are the different atoms of the II-VI (CdTe) or III-V (GaAs
and AlAs) compound. In terms of crystal symmetries this implies that at
variance with silicon they miss the inversion symmetry, and therefore
have a dipole-allowed SHG. In what follows we study linear and nonlinear
optical properties contrasting the standard TD-LDA with the real-time
DPFT approach.

#### 4.6.1 Optical absorption

The experimental optical spectra on Si [ LGVC87 ] , GaAs [ LGLC87 ] ,
CdTe [ AKS93 ] and AlAs [ GKP93 ] (Fig. 4.1 , black dashed lines) show
qualitative similarities. They all present two main features, a peak at
about 3-3.5 eV (referred as @xmath ) and stronger second peak at 4.5-5.0
eV (referred as @xmath ). In GaAs and CdTe, containing heavier
third/fourth rows atoms, the @xmath peak is split because of the
spin-orbit interaction. Note that we do not include spin-orbit in the
Kohn-Sham Hamiltonian and therefore we do not reproduce the splitting at
any level of the theory.

Figure 4.1 compares the experimental spectra with results obtained
within the RPA and the TD-LDA (without scissor correction). For the
considered systems the two approximations produce very similar spectra.
As the only difference between the TD-LDA and the RPA is the microscopic
xc potential, one can infer that the effect of the latter is minor as
already discussed in the literature. [ BSDSR07 , ORR02 ] The most
striking difference between the experimental and calculated spectra is
the onset that is underestimated by 0.5–1.0 eV. When a scissor operator
is added (see Ref [ GSA16 ] ) the agreement is improved though for Si,
GaAs and AlAs the @xmath peak is slightly blue-shifted and more
importantly the @xmath peak is either underestimated or appears as a
shoulder. Indeed the underestimation of the @xmath peak intensity in
semiconductor by TD-LDA (and similar TD-DFT approximations) is well
known and a signature of missing long-range correlation (see for example
Refs. [ HS79 , HS80 , BSDSR07 , ORR02 ] ). Comparison of the RPA spectra
and the independent particle approximation (IPA) spectra shows that
crystal local fields effects mostly reduces the intensity of the @xmath
peak by 15–25%. The experimental optical spectrum of CdTe is well caught
within the RPA, but for the overestimation of the @xmath peak intensity.

Figure 4.2 shows the effects of the macroscopic xc field that is added
through the approximated PFs discussed in Sec. 4.4 . For Si, GaAs and
AlAs a clear improvement is observed for the opt-PF: both intensity and
position of the peaks are reproduced reasonably well. For CdTe adding
the xc macroscopic field lead to an overestimation of the @xmath peak
intensity which was well caught within the RPA. On the other hand the
@xmath intensity ratio is better reproduce by the PFs than within RPA.
For the JGM-PF the agreement is in general less satisfactorily. In
particular for Si the @xmath peak intensity is still visibly
underestimated, while for AlAs it is overestimated. The main difference
between the two approximation is the value of @xmath : in the opt-PF,
@xmath is a parameter optimised to reproduce the optical spectra; in the
JGM-PF @xmath is determined from the jellium with a gap model. The model
does not reproduce the optimal value. For Si, @xmath and for AlAs @xmath
respectively smaller and larger than the optimal value reported in Ref.
[ GSA16 ] . It is worth to notice that the xc macroscopic field in the
JGM-PF has as well a microscopic contribution. For AlAs this
contribution is singled out in the right panel of Fig. 4.7 where it is
shown to reduce slightly the absorption. For silicon (not shown) the
microscopic contribution to the macroscopic field is negligible.

#### 4.6.2 SHG of GaAs, AlAs and CdTe

In zincblende structures the only independent non-zero SHG component [
Boy08 ] is @xmath (or its equivalent by permutation). The module of the
calculated @xmath for the systems under study is reported in Fig. 4.3
and compared with experimental values where available. Note that when
the energies are not corrected by a scissor (left panel) for both GaAs
and CdTe a large part of the energy range of the SH spectra is in the
absorption region where both one-photon and two-photon resonances
contribute to the intensity. For AlAs the part of the SH spectra below
2 eV is instead in the transparency region of the material (only
two-photon contributions). When the scissor-correction to the energy is
applied (right panel), the transparency region for GaAs and CdTe is
below 1 eV and for CdTe below 3 eV. In the transparency region only
two-photon resonances contribute. Comparing the TD-LDA with the RPA and
the independent particle (IP) spectra (left panel) shows that crystal
local field effects (that tend to reduce the overall SH intensity) are
partially compensated by the microscopic exchange-correlation effects
(that tend to increase the SH intensity). In general both effects are
relatively stronger than for the optical absorption. Applying the
scissor correction does not correspond to a simple shift (like in the
optical absorption case) but changes the spectra. Firstly the SH
intensity is reduced overall (because of sum rules), secondly the
intensity is redistributed as the scissor modifies the relative position
of one-photon and two-photon resonances (that are shifted by a half of
the scissor value). For GaAs and CdTe the addition of macroscopic
correlation through the approximated PF leads to an enhancement of about
40% in GaAs and 80% in CdTe with respect to the RPA. On the other hand
as discussed for those systems local field effects are very large and in
fact the spectra form the PF are not significantly different than at the
IP level, meaning an almost exact cancellation of the crystal local
effects and the macroscopic xc effects as describe by the approximated
PFs. Only in the case of AlAs, the macroscopic correlation enhances
significantly the SH, adds features and redistributes relative weights
with respect to the IPA. Regarding the comparison with experiment (right
panel), in GaAs the peak at 1.5 eV and the feature at 2.2 eV in the
experimental SHG are fairly reproduced by the opt-PF and JGM-PF
approximations. All approximations significantly overestimate the SH for
energies below 1 eV. A similar breakdown of the opt-PF approximation
(that within the response theory context corresponds with the long-range
corrected kernel) has been observed by Luppi and coworkers and traced
back to the errors in the theoretical macroscopic dielectric function. [
LHV10 ] For CdTe, the approximation that is closer to experimental
results (which however are available only around 1 eV) is the RPA while
both PF approximations overestimate the experimental SH. This is
consistent with the results for optical absorption for which the RPA
gives the best agreement among all approximations considered.

We have also compared our results from real-time simulations with those
obtained from a response approach by Luppi and co-workers [ LHV10 ] and
we found a good agreement, slightly better than our previous work [ AG13
] thanks to the higher order approximation for the covariant derivative
[Eq. ( 4.25 )]. In the left panel of Fig. 4.3 we show for example the
comparison for the RPA. There is a very good correspondence between the
two spectra for AlAs. For GaAs there are small, but still visible
differences which we argue are due to the different pseudopotentials
used. In fact we obtain a similar variation in our results when
repeating the calculations with different pseudopotentials. It is known
that SHG is very sensitive to changes in the electronic structure and
that is turn changes when using different pseudopotentials. This is
particularly true in the case of GaAs and the sensitivity on the
pseudopotential choice was also observed in the referenced calculations.
Note that in the pseudopotentials we used @xmath orbitals are considered
as core electrons, whereas they are included as valence electrons in the
calculation of Luppi and coworkers. [ LHV10 ] On the other hand
pseudopotentials including @xmath electrons that we were testing did not
provide a much better agreement.

#### 4.6.3 THG of Si

Figure 4.4 shows the calculations for @xmath and @xmath , the modules of
the @xmath and @xmath components of the THG of Si [ MvDS89 ] . These
were deduced from calculations with the input field either along the
@xmath or along the @xmath direction.

The TD-LDA spectra (top panels) both present two main features, a peak
around 0.9 eV (three-photon resonance with @xmath ) and a shoulder
around 1.4 eV (three-photon resonance with @xmath ). Both features are
more intense and pronounced in the @xmath . Results within TD-LDA
resemble closely those obtained within the RPA and IP approximation. For
the @xmath three-photon resonance the microscopic exchange-correlation
effects cancel with the local-field effects, so that TD-LDA almost
coincides with the IP approximation. For higher energies instead, the
TD-LDA and RPA spectra are practically identical. Applying a scissor
operator does not simply shift the peaks by an amount of about 1/3 of
the scissor value. The overall intensity of the spectra is reduced (as
expect from sum rules) and as well the relative intensity of the @xmath
/ @xmath resonances changes. Specifically the ratio is close to or even
smaller than @xmath in the scissor corrected spectra, while is @xmath in
the uncorrected spectra. The macroscopic exchange-correlation introduced
with the approximations for the PF (bottom panels) enhances the
intensity of the spectra and as well the @xmath / @xmath ratio.
Consistently with what observed for the linear response, the largest
@xmath (opt-PF for silicon) produces the largest correction.

Experimental measurements are available for the ratio @xmath between the
THG signal obtained with @xmath and @xmath incident angles and for the
ratio @xmath between the THG signal obtained with circularly polarised
light and linearly polarised light at @xmath incident angle. From those
measurements then @xmath and the phase @xmath can be deduced. [ MvDS89 ]
The experimental results are reported in Fig. 4.5 . Both @xmath and
@xmath present two features at about 1.1 eV and 1.4 eV in correspondence
of the three-photon @xmath and @xmath resonances. All the theoretical
results are very similar irrespective of the approximation used and the
differences observed for the @xmath and @xmath in Fig. 4.4 . The results
from the scissor corrected approximations (right panels) are just
shifted by 1/3 of the scissor operator. When compared with the
experiment all the approximation reasonably reproduce the behaviour at
energies lower than 1 eV. However for both @xmath and @xmath (we
consider here only the scissor corrected approximations which have
resonances at the correct energies) the peak in correspondence of the
@xmath resonance is missing and the feature in correspondence of the
@xmath resonance much less pronounced than in experiment. When compared
with calculations from Moss and coworkers [ MGSvD90 ] at the independent
particle level from the electronic structure calculated either with
empirical tight-binding and semi-ab-initio band-structure techniques,
the intensity we found for @xmath and @xmath are similar to the latter,
but the main spectral features are similar to the former. To notice that
the THG based on empirical tight-binding shows in the @xmath and @xmath
spectra a peak at 1.1 eV.

### 4.7 Discussion

It is interesting to analyse how an apparently simple approximation such
as @xmath correctly “distinguishes” where to increase the optical
absorption spectrum at RPA level. This information is “encoded” in the
macroscopic polarisation. In fact, in the linear response limit the
effective Kohn-Sham electric field within the proposed PF approximations
takes the form

  -- -------- --
     @xmath   
  -- -------- --

That is, the intensity of the applied field is either amplified or
reduced depending on the sign of @xmath —as @xmath for any positive
@xmath . In Fig. 4.6 (upper panel) we see that indeed the sign of @xmath
follows closely that of the correction induced by @xmath . To gain an
insight on how the sign of @xmath is linked to the localisation of the
excitation we consider the phasor representation of @xmath : the complex
argument @xmath (see bottom panel of Fig. 4.6 ) gives the phase delay
between @xmath and @xmath . In particular a delay of @xmath corresponds
to in-phase oscillation of the macroscopic polarisation current @xmath (
@xmath ) with @xmath : where the optical absorption is negligible those
oscillations are plasmons; in regions with non-negligible optical
absorption they can be considered as a signature of delocalized
excitations (note that in fact the optical absorption it as a maximum at
@xmath ). Heuristically, for more localized excitations we may expect a
phase delay larger than @xmath , and for delocalized excitations a phase
delay smaller than @xmath . Then, the @xmath , and @xmath which is
proportional to it, are negative for localized excitations and positive
for the more delocalized ones. A correction proportional to @xmath then
increases the absorption in correspondence of more localised excitation
and decreases it for more delocalized excitations. Note as well that in
the RPA the phase delay is overestimated. Then the absorption,
proportional to @xmath is too small for @xmath (localized excitation)
and too large for @xmath (delocalised excitation).

### 4.8 Summary and conclusions

We have implemented a real-time density functional approach suitable for
infinite periodic crystals in which we work within the so-called length
gauge and calculate the polarisation as a dynamical Berry phase. [
SInV04 ] This approach, in addition to the electron density considers
also the macroscopic polarisation as a main variable and extends to the
time-dependent case the DPFT introduced in the nineties [ GGG95 , Res96
, Van97 , MO97 ] to correctly treat IPC in electric fields within a
density functional framework. In the corresponding time-dependent KS
equations next to the microscopic xc potential also appears a
macroscopic xc electric field which is a functional of the macroscopic
polarisation (and eventually of the microscopic density). We have
derived approximations for the xc electric field exploiting the
connection with long-range corrected approximations for xc kernel within
the linear response theory. We have considered two approximations, the
optimal polarisation functional, linked to the long-range corrected xc
kernel proposed on Ref. [ BSV @xmath 04 ] and the Jellium with a gap
model polarisation functional linked to the analogous approximation for
the xc kernel. [ TTC @xmath 13 ] We have applied this approach, that we
refer to as real-time DPFT, to calculate the optical absorption, second
and third harmonic generation in different semiconductors (Si, GaAs,
AlAs and CdTe). We have compared results with “standard” real-time
TD-DFT, namely without macroscopic xc effects, and to experimental
results where available. The general trend is an overall improvement
over standard TD-DFT as to be expected from the results obtained within
the response framework. [ BSV @xmath 04 ] Of the considered
approximations, the opt-PF provides the best agreement with the
experiment. We verified this finding also with other materials, the zinc
chalcogenides ZnX (X= S, Se, and Te) [ GA16 ] , not reported in the
present chapter.

The approach here proposed combines the flexibility of a real-time
approach, with the efficiency of DPFT in capturing long-range
correlation. It allows calculations beyond the linear regime (e.g.
second- and third-harmonic generation, four-wave mixing, Fourier
spectroscopy or pump-probe experiments) that includes excitonic effects.
It is an alternative approach to real-time TD-DFT for extended system
proposed by Bertsch, Rubio and Yabana. [ BIRY00 ] At difference with our
approach the latter uses the velocity gauge—which has the advantage of
using the velocity operator that is well defined in periodic
systems—rather than the position operator that requires special
attention. On the other hand, although this approach have shown
promising results, [ YSS @xmath 12 , Gon13 ] it turns to be quite
cumbersome for studying response functions beyond the linear regime due
to the presence of divergences that in principle should cancel, but that
are difficult to treat numerically. [ AS95 ] Furthermore non-local
operators—such as pseudo-potentials or the scissor operator—are
cumbersome to threat in velocity gauge [ Tok09 ] while they are trivial
in length-gauge.

Similarly to any density-functional approaches, a delicate point is the
approximation of the xc effects. In addition to the xc potential as in
standard DFT, in this approach we also need an approximation for the
macroscopic xc field. Though for the systems here studied the opt-PF
approximation seems to work well, such a good performance cannot be
expected in general. For example, based on the experience from linear
response calculations, this approximation is not expect to work very
well for large gap insulators or systems with a reduced dimensionality
(e.g. nanostructures or layers) in which the electronic screening is
small. [ SKRA03 ] Furthermore, in the opt-PF the @xmath is chosen has a
material dependent parameter rather than obtained from first-principles.
In this respect within the other approximation here studied, JGM-PF,
@xmath is determined from first-principles but not always has the
optimal value. Further studies then should try to develop universal
approximations to the polarisation functional, possibly going beyond the
linear response formulation that was here used in the derivation of the
polarisation functionals.

## Chapter 5 Conclusions

In this thesis we presented a new formalism to study non-linear response
of solids and nanostructures. Our approach is based on a real-time
solution of an effective Schrödinger equation. Our starting point is the
parameter free Kohn-Sham Hamiltonian. Then we include correlation
effects trought single-particle operators in the Hamiltonian. We
consider three important effects that are known to affect linear and
non-linear response in solids: the GW correction to the Kohn-Sham band
structure; the local field effects that are due to the density response
in inhomogeneous materials; and the electron-hole interaction generated
by the screened exchange. We found that inclusion of these three effects
is crucial to reproduce and predict non-linear response. In particular
in low dimensional materials the electron-hole interaction can double
the SHG response. Finally we consider a more efficient approach derived
from Density Functional Polarisation Theory, an extension of TD-DFT to
periodic systems. We show that simple functionals that depend only from
density and polarisation are able to catch large part of these
correlation effects. Thanks to the strong efficiency of the TD-DFPT
approach, it will be possible to extend this kind of simulations to a
large spectra of materials and structures.

### Future developments and perspectives

The coupling between Modern Theory of Polarisation and correlation
effects described by means of NEGF or TD-DFPT was the successful outcome
of this thesis. However the story does not end here. There are still
some open questions that are waiting for an answer. In particular the
inclusion of non empirical dephasing terms in the real-time dynamics,
and the application of this approach to complex spectroscopic
techniques. A correct dephasing can be obtained by means of
non-equilibrium Green’s function theory. However a key ingredient of our
formalism is the phase difference generated by the external perturbation
and this quantity cannot be easily obtained from Green’s functions or
other perturbtive approaches. This makes the coupling of these two
worlds quite cumbersome. Some authors proposed rather complicated
solutions to these problems, that didn’t find a general application in
the scientific community. Another possible route is to pass for the
velocity gauge, but in this case the non-locality of the many-body
operators make the dynamics difficult to solve. The second problem
and/or prospective is the application of the present formalism to
complex spectroscopic techniques as four-wave-mixing,
Fourier-spectroscopy and two-dimensional spectroscopy. These techniques
requires multiple laser sources and a deeper analysis to extract data
from real-time simulations. For these reasons we are currently working
on new techniques as wave-let analysis and compress sensing to reduce
simulation time and access to new phenomena in an efficient way. Finally
there all the numerical implementation and code parallelization that we
did not discuss in the present manuscript. At present we created a very
efficient code for the non-linear response and we hope it will be
released under GPL licence at the beginning of the next year.

### Acknowledgements

First of all I want to acknowledge all my collaborators: Myrta Grüning,
Davide Sangalli, Andrea Marini and Elena Cannuccia. Then a special thank
is due to Elena for reviewing part of this manuscipt. Finally I am
grateful to the TSN group for their warm welcome. This work used the
computing facilities of the Atomistic Simulation Centre–Queen’s
University Belfast, of the CINaM Aix-Marseille Université, of the ARCHER
UK National Supercomputing Service ( http://www.archer.ac.uk ) through
EPSRC grant EP/K0139459/1 allocated to the UKCP Consortium, and of the
“Curie” national GENGI-IDRIS supercomputing centre under contract No.
x2012096655. I acknowledge also the EUSpec Cost Action MP1306.

## Appendix A An efficient method to update the COHSEX self–energy
during the time evolution

In this appendix we show how we store and update the @xmath self-energy
in a efficient manner. First of all we neglect the variation of the
screened interaction @xmath with respect to the @xmath by setting to
zero the functional derivative @xmath (see Sec. 3.3.3 ). Within this
approximation the @xmath does not contribute to the time evolution,
therefore only @xmath needs to be updated:

  -- -------- -- -------
     @xmath      (A.1)
  -- -------- -- -------

The KBE involves the matrix elements @xmath :

  -- -------- -- -------
     @xmath      (A.2)
  -- -------- -- -------

where

  -- -------- -- -------
     @xmath      (A.3)
  -- -------- -- -------

In order to rapidly update @xmath after a variation of @xmath , we store
the matrix elements:

  -- -------- -- -------
     @xmath      (A.4)
  -- -------- -- -------

in such a way that @xmath can be rewritten as

  -- -------- -- -------
     @xmath      (A.5)
  -- -------- -- -------

The @xmath matrix can be very large, but its size can be reduced by
noticing that: (i) the matrix @xmath is Hermitian respect to the @xmath
indexes; (ii) the number of k and q points is reduced by applying the
operation symmetries that are left unaltered by the applied external
field; (iii) for converging optical properties only the bands close to
the gap are needed. As an additional numerical simplification we
neglected all terms such that @xmath , where @xmath is a cutoff that, if
chosen to be @xmath does not appreciably affect the final results. In
principle by using an auxiliary localised basis set [ SCHG97 , FBA
@xmath 14 ] one can obtain a further reduction of the matrix dimensions,
but in the present work we did not explore this strategy.

## Appendix B Induced field and response functions

One of the objectives of atomistic simulations is the calculation of the
macroscopic dielectric function or of related response functions of
dielectrics. Within TD-DFT such goal is achieved via the calculations of
the microscopic density–density response function @xmath , defined via
the equation

  -- -------- -- -------
     @xmath      (A.1)
  -- -------- -- -------

Here @xmath are the reciprocal lattice vectors and @xmath the frequency
obtained from the Fourier transforms @xmath and @xmath . In addition to
@xmath , the irreducible response function @xmath and the auxiliary
response function @xmath can be defined via

  -- -------- -------- -------- -- -------
     @xmath   @xmath   @xmath      (A.2)
     @xmath   @xmath   @xmath      (A.3)
  -- -------- -------- -------- -- -------

To linear order and at finite momentum (i.e. @xmath ), the longitudinal
microscopic dielectric function can be derived from the response
functions,

  -- -------- -- -------
     @xmath      (A.4)
     @xmath      (A.5)
  -- -------- -- -------

The longitudinal macroscopic dielectric function can then be obtained as
@xmath . Absorption experiment however are described at @xmath where the
dielectric function @xmath can be obtained only via a limiting process.
They are defined as

  -- -------- -------- -------- -- -------
     @xmath   @xmath   @xmath      (A.6)
     @xmath   @xmath   @xmath      (A.7)
  -- -------- -------- -------- -- -------

As we observed in the introduction this approach is at least problematic
in real time simulation, where it is numerically more convenient to
directly work at @xmath and thus the density–density response function
cannot be used.

Within DPFT the key quantity is the one which relates the macroscopic
electric field @xmath or @xmath to the first order polarisation @xmath .

  -- -------- -- -------
     @xmath      (A.8)
     @xmath      (A.9)
  -- -------- -- -------

@xmath is the (first–order) polarizabilty; @xmath is the
quasi–polarizability. Since we obtain the polarizability dividing the
Fourier transform of the time–dependent polarisation with the input
electric field, we obtain either @xmath or @xmath depending on whether
we divide by @xmath or @xmath . Notice that in this framework we have
already made the distinction between macroscopic fields, described in
terms of @xmath , and microscopic ones, described in terms of @xmath .
@xmath and @xmath are thus macroscopic functions. The longitudinal
dielectric function can be obtained, to first order in the field, as

  -- -------- -------- -------- -- --------
     @xmath   @xmath   @xmath      (A.10)
     @xmath   @xmath   @xmath      (A.11)
  -- -------- -------- -------- -- --------

where @xmath is any of the diagonal components of @xmath .

More in general the @xmath -order polarisation can be expressed as

  -- -------- -- --------
     @xmath      (A.12)
  -- -------- -- --------

where @xmath is the @xmath -order polarizability related to @xmath
-order nonlinear optical properties. Also here we could define the
@xmath as the response to the external field. The two can be related
from the equation

  -- -------- -- --------
     @xmath      (A.13)
  -- -------- -- --------

As for the linear case we obtain either @xmath ot @xmath depending for
whether field we divide the polarisation @xmath or @xmath . However,
since usually @xmath is the quantity considered in the literature the
last choice is more convenient in nonlinear optics.

In practice, in real-time simulations we can choose to provide as input
field the total @xmath or the external one @xmath . In the first case we
propagate the equation:

  -- -------- -- --------
     @xmath      (A.14)
  -- -------- -- --------

while in the second case we propagate the coupled Schödinger plus
Maxwell equations:

  -- -------- -- --------
     @xmath      (A.15)
  -- -------- -- --------

In this last case the total field is generated directly by the Maxwell
equation. Since response functions are independent from the field, the
two formulations provide the same response functions. However in
numerical simulations, the first approach is preferable because we know
analytically the total field. This allow us to have less numerical noise
while extracting the @xmath coefficients and we can probe precisely the
frequencies we are interested in.

Nevertheless if one is interested in quantities that depend from the
field intensity, as for instance electro-absorption, saturation etc..
the correct formulation is the second one. In fact in a real material
electrons cannot couple directly to the external field but they couple
to the sum the external plus the field generated by the electron
them-self. For a discussion on this point and a more rigorous treatment
see Ref. [ YSS @xmath 12 ] .
As example of these two formalisms let’s consider the case of an
insulator subject to a delta function field, @xmath , in independent
particle approximation. If you use @xmath as the total one, the
polarisation will oscillate according to the electron-hole frequencies,
while if we couple the Schödinger equation to the Maxwell one the
polarisation will oscillate according to the plasmon frequencies, as
depicted in Fig. B.1 . This can be easily understood from Eq. A.8 and
A.9 . In the first case the polarisation divided by the total field
(that is a constant) is proportional to the EELs, while in the second
case dividing the polarisation for the external one gives directly the
dielectric constant. This explain the different behaviour of the
polarisation in the two cases.

## Appendix C List of publications

-   Optical properties of periodic systems within the current-current
    response framework: numerical pitfalls and solutions
    D. Sangalli, J. A. Berger, C. Attaccalite, M. Grüning and P.
    Romaniello, in preparation (2016)

-   Excitonic effects in third harmonic generation: the case of carbon
    nanotubes and nanoribbons
    C. Attaccalite, E. Cannuccia and M. Grüning, in preparation (2016)

-   Dielectrics in a time-dependent electric field: A real-time approach
    based on density-polarization functional theory
    M. Grüning, D. Sangalli, and C. Attaccalite, Phys. Rev. B 94 ,
    035149 (2016)

-   Performance of polarisation functionals for linear and nonlinear
    optical properties of bulk zinc chalcogenides ZnX (X = S, Se, and
    Te)
    M. Grüning and C. Attaccalite, Phys. Chem. Chem. Phys., 18 ,
    21179 (2016)

-   Optical properties of Cu-chalcogenide photovoltaic absorbers from
    self-consistent GW and the Bethe-Salpeter equation
    Sabine Körbel, David Kammerlander, Rafael Sarmiento-Pèrez, Claudio
    Attaccalite, Miguel A. L. Marques, and Silvana Botti, Phys. Rev. B
    91 , 075134 (2015)

-   Strong second harmonic generation in SiC, ZnO, GaN two-dimensional
    hexagonal crystals from first-principles many-body calculations
    C. Attaccalite, A. Nguer, E. Cannuccia, M Grüning, Phys. Chem. Chem.
    Phys. 17 , 9533 (2015)

-   Second harmonic generation in h-BN and MoS 2 monolayers: Role of
    electron-hole interaction
    M. Grüning, C. Attaccalite, Phys. Rev. B 89 , 081102 (2014)

-   Nonlinear optics from an ab initio approach by means of the
    dynamical Berry phase: Application to second-and third-harmonic
    generation in semiconductors
    C. Attaccalite, M. Grüning, Phys. Rev. B 88 , 235113 (2013)

-   Real-time approach to the optical properties of solids and
    nanostructures: Time-dependent Bethe-Salpeter equation
    C. Attaccalite, M. Grüning, A. Marini, Phys. Rev. B 84 ,
    245110 (2011)