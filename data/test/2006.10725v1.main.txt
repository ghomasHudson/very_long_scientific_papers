##### Acknowledgements. When I was a beginning student, I saw number
theory as a fractured subject. There seemed to be no unified motivation
for the problems and no unified method for their solutions. In fact, the
saying that number theory is “the queen of mathematics” seemed like less
of a compliment and more of an assertion that number theory did not know
how to stand on its own. Well, I have grown a lot since those days: I
now see number theory – or at least arithmetic geometry – as a
beautifully coherent collection of concepts and methods. That coherence
has only grown in the last few decades, thanks to number theorists,
geometers, logicians, combinatorialists, topologists, and analysts whose
work has either purposefully or accidentally contributed to arithmetic
geometry. I am, then, incredibly thankful to those who put in sweat and
tears before me so that I had a foundation upon which to work. Special
thanks go to Jon Pridham, Kobi Kremnitzer, and Damian Rössler, who read
earlier versions of this work in confirmation and transfer and provided
much-needed feedback. I am particularly grateful for those who have seen
mathematics as part of a larger humane project, and to those who seek to
make math a more open and accepting field which sees the world’s
problems as its own problems. My growth into the mathematician I am
today was initiated by Professor David Zureick-Brown, my undergraduate
advisor, who opened my eyes to the world of number theory and especially
the method of Chabauty. I would not have finished this process without
the many mathematical friends and colleagues who were willing to sit
down and discuss math or anything-but-math: Alexander
Gietelnik-Oldenziel; Alex Saad; Jay Swar; Nadav Gropper; Alyosha
Latyntsev; Ma Luo (for teaching me so much about Hodge theory of
relative completions); Netan Dogra (who read through an earlier draft of
this, was there more than once when I thought things were crashing down,
and has taught me a lot of good math); Jan Vonk (who answered many
questions about arithmetic geometry); Carl Wang–Erickson (for email
exchanges explaining his work that went far above and beyond the call of
duty, and for his absolutely clear writing.) And I am thankful for the
non-mathematical friends who have inspired me: my flatmates (for more
reasons than I can count); many sensitive and compassionate minds of the
Marshall scholarship; the ever-knowledgable companions at Oxford JSoc;
singers in Brasenose Chapel Choir; Ben St. Clair and Victoria Mousley
(for always providing a home away from home); David Elitzer and Rhea
Stark (for listening to my troubles with open ears and open hearts);
Josh Lappen (who is a true mensch); and others who supported me more
than I will ever understand. My wonderful family has been there in the
ups and downs of the last few months, and I will always be grateful for
that. Above all, it is impossible to express the fullness of the
gratitude I owe to my advisor, Professor Minhyong Kim, for pushing me to
write this DPhil when I was just a few months from submitting my MSc
thesis. His patience, mathematical wisdom, and broad set of interests
that seem to span every subject known to humanity have inspired his
students and grand-students, and I am privileged to have had his time
and guidance. I share the sentiment that he describes in the paper that
announced non-abelian Chabauty: “I seem to have accumulated quite a debt
of gratitude even in writing this simple paper…”

{romanpages}

###### Contents

-    1 Introduction
    -    1.1 The method of Chabauty, Coleman, and Kim
    -    1.2 Main results
        -    1.2.1 Étale realizations
        -    1.2.2 de Rham realizations
        -    1.2.3 The Chabauty–Kim diagram for relative completions
        -    1.2.4 Related results
    -    1.3 Future work
    -    1.4 Notation
-    2 The Relative Completion
    -    2.1 Relative completions: algebraic theory
    -    2.2 Overview: relative completions for the motivically inclined
-    3 Stacky Non-Abelian Galois Cohomology
    -    3.1 Interpreting cohomology stacks: torsors vs. cohomology
        classes
    -    3.2 A review of classical Selmer conditions
    -    3.3 @xmath -adic Hodge Theory and Selmer conditions
        -    3.3.1 Crystallinity over a point and in a family
        -    3.3.2 Stacky Selmer conditions
        -    3.3.3 Agreement with the abelian case
        -    3.3.4 Rational points land in Block–Kato stacks
-    4 Representability of Cohomology Stacks
-    5 Cohomology Stacks of Groups with Conjugation Action
    -    5.1 Representability of stacks without Selmer conditions
    -    5.2 Selmer stacks of groups with conjugation action
-    6 de Rham and Crystalline Realizations; @xmath -adic Period
    Mappings
    -    6.1 Hodge theory
    -    6.2 Frobenius weights
        -    6.2.1 Why do Frobenius weights matter?
    -    6.3 From crystalline to dR to Hodge
        -    6.3.1 Moving to @xmath
    -    6.4 de Rham torsor spaces
        -    6.4.1 A new definition for admissible torsors
        -    6.4.2 Flag varieties and Rapoport–Zink spaces
        -    6.4.3 Applying period domains to group schemes that come
            with a filtration
        -    6.4.4 Sharpening the definition of admissible torsors even
            more
        -    6.4.5 The de Rham moduli space: moduli of doubly admissible
            torsors
    -    6.5 Analyticity of the Albanese for the relative completion;
        the crystalline fundamental group
        -    6.5.1 Density of @xmath -adic period mappings
-    7 Applications to Fundamental Groups
    -    7.0.1 Cutting down the Selmer stack in the Gauss–Manin case
    -    7.0.2 @xmath is algebraic when @xmath is geometric
    -    7.1 Bloch–Kato logarithm
        -    7.1.1 The stacky logarithm and the Chabauty–Kim diagram
        -    7.1.2 Dimension theory for algebraic stacks
    -    7.2 An example: the projective line minus three points
-    A Tannakian Categories
    -    A.1 Interpretation via Zariski closures and universality
-    B Relevant Concepts in Arithmetic Geometry: Étale Local Systems,
    Gauss–Manin, and Chen’s @xmath Theorem
    -    B.1 Recollections on étale maps and local systems
    -    B.2 Vector bundles with integrable connection
    -    B.3 The Gauss–Manin connection
-    C Stacks, Sites, and Pseudofunctors
    -    C.1 Stacks and geometric contexts
    -    C.2 Facts on quotient stacks
-    D Rigid and Formal Geometry
    -    D.1 Definitions and properties
    -    D.2 The formal geometric context
    -    D.3 Rigid analytic geometry and the generic fiber construction:
        from @xmath to @xmath and back again
    -    D.4 Strat-representability

## Chapter 1 Introduction

This thesis centers around the Chabauty–Kim method, a method for proving
Diophantine finiteness using @xmath -adic analysis. The Chabauty-Kim
method, which belongs in fact to many mathematicians, is a fundamental
example of the unity of theory and method that have permeated arithmetic
geometry in the last half-century or so. The unified theory lies in the
concept of a motive and its realizations. The unified method, on the
other hand, can broadly be termed the “box principle.” This principle
refers to the fact that finiteness results in arithmetic geometry arise
when one is able to place the desired object in a more structured box.
The Chabauty-Kim method uses this principle to show finiteness of
rational points, using Selmer varieties as a box.

In this thesis, we advance Chabauty–Kim theory by constructing a
Chabauty–Kim diagram, including Selmer stacks and de Rham moduli spaces,
for relative Malcev completions of fundamental groups as studied by
Hain, Olsson, Pridham, and others. This advance is an essential next
step in the Chabauty-Kim theory because it injects some non-unipotency
into a theory which has thus far only worked with the unipotent
fundamental group.

More broadly, this work can be seen as a first inroads in the program to
relate the Chabauty–Kim method to the recent work of Lawrence and
Venkatesh [ 67 ] reproving Faltings’ Theorem. On the technical side,
there are many theorems left to prove, such as broader representability
and algebraicity of Selmer stacks; and there are restrictions that can
likely be removed, such as the simple-connectedness of algebraic
monodromy. Finally, there are certainly many more connections to the
work of Lawrence and Venkatesh that need exploring, for example the
question of applying our method directly to Kodaira–Parshin families.
Despite this to-do list, we see many exciting developments in what we
have done here and hope this work inspires others to leave their
unipotent or reductive silos. Experts in Chabauty–Kim may want to skip
to our main example ( 7.2 ) after Section 1.2 to see the theory in
action.

### 1.1 The method of Chabauty, Coleman, and Kim

To give context to our main results, we now explain Kim’s approach to
Diophantine finiteness – itself a vast generalization of the ingenious
method of Chabauty that Coleman used in the 1980’s to give bounds on
rational points on hyperelliptic curves of low Mordell-Weil rank [ 22 ]
. The canonical exposition of the work of Chabauty and Coleman is the
essay by McCallum and Poonen [ 69 ] . Even more recently, the method of
Chabauty and Coleman has been combined with tropical geometry to give
uniform bounds on rational points on some curves of low Mordell-Weil
rank. For more information on this train of ideas, see the work [ 56 ]
of Katz, Rabinoff, and Zureick-Brown.

Finally, we highlight the recent progress on quadratic Chabauty by
Balakrishnan, Dogra, Müller, Besser, and others. Quadratic Chabauty is
an explicit realization of Kim’s method in the first case that classical
Chabauty cannot deal with [ 6 ] .

For all of the materials that follow, we recommend above all the
original papers of Kim and the work of Deligne that inspired it [ 30 ] .

Consider a curve @xmath over a number field @xmath , such that @xmath
has a smooth model @xmath over the ring @xmath of @xmath -integers of
@xmath for some finite set of places @xmath . Fix a basepoint @xmath if
one is available. (The Chabauty–Kim method says nothing about whether a
basepoint exists, though the nonemptiness of the set of rational points
is closely related to fundamental groups via Grothendieck’s section
conjecture; cf. for example [ 51 ] .)

Finally, let @xmath be a place not in @xmath (i.e. at which @xmath has
good reduction) with @xmath the rational prime under @xmath . Let @xmath
be the set of places of @xmath that includes all places in @xmath and
all primes dividing @xmath . Kim’s generalization of Chabauty’s method
centers on the commutative diagram (now called “Kim’s Cutter”)

  -- -- --
        
  -- -- --

There is one such diagram for every natural number @xmath , and one
hopes that analyzing the diagram for high enough @xmath might yield some
sort of finiteness for the set @xmath . Experience actually shows that
with enough skill this diagram can yield explicit equations for @xmath
inside of @xmath . We will explain the maps in this diagram throughout
this work. Suffice it to say that the two cohomology groups are called
Selmer varieties, and the quotient on the right hand side might be
called the de Rham period domain; the map @xmath is the non-abelian
version of Bloch and Kato’s logarithm (it is a souped-up version of
Faltings’ @xmath functor), and the two vertical maps send a point to the
unipotent étale path torsor associated to that point.

An important point is that the maps @xmath and @xmath are algebraic,
while iterated integration is @xmath -adic analytic.

The analysis should work as follows if one thinks that @xmath ought to
be finite:

  1  

    Show that the diagonal integration map is Zariski dense in @xmath

  2  

    Show that the dimension of @xmath is strictly less than that of

      -- -------- --
         @xmath   
      -- -------- --

    so that there is a nonzero algebraic function @xmath vanishing on
    the image of this global Selmer variety in the de Rham period space.

  3  

    By the commutativity of the diagram, @xmath vanishes on the image of
    elements of @xmath under the integration map, which we may denote
    @xmath . Then @xmath is a function on @xmath that vanishes on @xmath
    . Furthermore, @xmath is nonzero on @xmath because @xmath has
    Zariski-dense image.

  4  

    The composition @xmath is a nonzero @xmath -adic analytic function
    on @xmath , and any such function has finitely many zeros on a
    @xmath -adic disc. Since @xmath is covered by a finite number of
    discs (namely residue discs), there are only finitely many rational
    points on @xmath . Here we use the fact that @xmath is a curve.
    There has been a slew of recents results using Ax–Schanuel-type
    methods to show that @xmath can cut out an algebraic subset of
    @xmath , which allows one to apply the method to higher-dimensional
    varieties [ 52 , 34 ] .

By far the most difficult step of this process is the second; it
invariably uses deep results on the dimensions of global Galois
cohomology groups.

If one is interested in explicit equations for the rational points, one
then needs equations for the image of @xmath in @xmath . In the
classical method of Chabauty these equations are found
residue-disc-by-residue-disc using linear algebra, but the method
becomes significantly more difficult as @xmath increases (i.e. as the
situation becomes less linear.) One approach is through Massey products,
which provide relations in Galois cohomology. This approach, implemented
for example in [ 5 ] , achieves the ultimate desiteratum of an explicit
analytic equation for integral points that holds uniformly across all
residue discs.

We pause to observe that the use of the unipotent fundamental group
comes into almost every stage of the Chabauty-Kim process: iterated
integration is the same as solving a unipotent system of differential
equations, Selmer varieties have up until now only been defined for a
unipotent fundamental group, and the very process of proving bounds on
Galois cohomology always involves reducing to the case of linear Galois
representations using unipotence. Incorporating non-unipotent
information will, therefore, take us seemingly far afield of the
classical Chabauty formalism. Yet, as we will see, the non-unipotent
version of Chabauty will involve different linear invariants (such as
adjoint Galois cohomology) which deepen the theory.

### 1.2 Main results

In this thesis we prove the following results. For the entirety of this
thesis, @xmath will denote a number field, and @xmath the ring of @xmath
-integers of @xmath for @xmath a set of places of @xmath . If @xmath is
a scheme over a field, @xmath denotes the base change of @xmath to the
algebraic closure of the field.

#### 1.2.1 Étale realizations

We give a detailed introduction to the relative completion in the main
text, but let us say for now that the étale realization of the relative
completion of the fundamental group of @xmath – denoted @xmath – is a
quotient of the pro-algebraic completion of the geometric étale
fundamental group of a scheme. It is defined by fixing an étale @xmath
-local system @xmath on @xmath , and considering the Tannakian category
containing @xmath and closed under extension, tensor product, dual,
quotient, and direct sum. The relative étale fundamental group @xmath is
the Tannakian fundamental group of this category; when @xmath is defined
over the base field and suitably “unramified,” this fundamental group
has an action by the Galois group @xmath of the maximal extension of
@xmath unramified outside of some set @xmath which includes the primes
of bad reduction for @xmath and @xmath and all primes over @xmath .

The best way to understand @xmath at a first approximation is that it
fits into an exact sequence

  -- -------- --
     @xmath   
  -- -------- --

where @xmath is unipotent and @xmath is the algebraic closure of the
monodromy of @xmath . In this sense, it combines the monodromy-theoretic
methods of classical period mappings with a unipotent part that is
reminiscent of Kim’s theory.

Our first result is the construction of cohomology and Selmer stacks for
@xmath , as well as maps from integral points into them assuming certain
conditions on @xmath . Here is a precise statement.

###### Theorem.

( 7.0.4 )

Let @xmath be a smooth and proper morphism of schemes over @xmath , with
their generic fibers over @xmath being denoted @xmath and @xmath . Let
@xmath denote the @xmath ^(th) relative geometric étale cohomology of
@xmath with coefficients in @xmath , and @xmath the relative unipotent
fundamental group of @xmath with respect to @xmath and a fixed basepoint
@xmath . Furthermore, let @xmath be a place of @xmath not contained in
@xmath , and @xmath the rational prime below @xmath . Finally, let
@xmath be a set of primes containing @xmath and all primes of @xmath
above @xmath .

There exist stacks on the rigid-analytic site, denoted

  -- -------- --
     @xmath   
  -- -------- --

and

  -- -------- --
     @xmath   
  -- -------- --

that parameterize Galois-compatible torsors for @xmath which are
crystalline at @xmath and have type @xmath ; if the monodromy group
@xmath is semisimple and simply connected then there is a commutative
diagram

  -- -- --
        
  -- -- --

Here @xmath refers to taking a certain relatively unipotent torsor of
paths from @xmath to @xmath ; @xmath is the restriction of Galois
representations; @xmath is a triple that indicates the substack
corresponding to torsors with @xmath -adic Hodge type, residual
representation, and in the global case, weight equal to that of the
stalks of @xmath (see Definition 7.0.2 .)

###### Remark 1.

The monodromy @xmath will always be semisimple in geometric situations.
Its simple-connectedness does not seem universal, but many cases (such
as the full symplectic group) satisfy this hypothesis.

We call the stacks in the theorem Selmer stacks. For those used to the
unipotent Selmer variety formalism, we should say here that stackiness
enters the picture because our Selmer stacks are something like a
combination of Kim’s Selmer varieties and moduli stacks of Galois
representations.

One hopes to show, as in the work of Kim [ 62 , Section 1] , that these
two stacks and their simpler avatars without Selmer conditions are
representable by some geometric object. (They would naturally be
representable as rigid-analytic stacks and preferably be algebraizable
to algebraic stacks over @xmath .) As a first step toward
representability, we prove the following statement, which already uses
difficult work of Pottharst on continuous cohomology of families of
Galois representations [ 78 ] .

To state our result, we need the notion of strat-representability: see
Definition D.4 . The reader should imagine that a stack in groupoids
@xmath is strat-representable if it has a stratification such that each
piece is representable as a rigid-analytic stack.

###### Theorem.

(Theorem 4.0.1 )

Preserve the notations of the previous theorem. The continuous
cohomology stack @xmath is strat-representable in the category of
rigid-analytic stacks, where @xmath is @xmath or @xmath .

We also explain the challenges that keep us from proving
(strat-)representability of Selmer stacks (Remark 14 and the discussion
preceding it.)

#### 1.2.2 de Rham realizations

One can play the same game with the relative de Rham cohomology @xmath
of a smooth and proper family, and from it one obtains in exactly the
same way the de Rham relative completion, @xmath . Our other strain of
results regards the creation of a de Rham period space which classifies
torsors for the de Rham relative completion that are “doubly admissible”
in a certain sense. The word “doubly” refers to the fact that they
combine Kim’s admissibility of torsors with weak admissibility in the
sense of @xmath -adic Hodge theory. The reader should think of this
moduli space as combining the flag-variety approach of Lawrence and
Venkatesh with the unipotent Albanese approach of Hain and Kim.

The de Rham moduli space is an open rigid-analytic substack

  -- -------- --
     @xmath   
  -- -------- --

The Frobenius-invariant subgroup is intimately related to the headaches
that Lawrence and Venkatesh overcome in bounding the centralizer of
Frobenius, and our methods show how one might eliminate these headaches.
Let us explain.

The subgroup @xmath is a priori huge, since it is a subgroup of a
pro-algebraic group. However, a deep result of Olsson on the weights of
Frobenius acting on the unipotent radical of @xmath imply that @xmath is
no bigger than the centralizer of Frobenius @xmath in the monodromy of
the local system @xmath . In other words, the @xmath -invariant part has
no effect on the dimensions of the de Rham period space as we move up
the “unipotent tower” of @xmath . This fact has the potential to
eliminate the centralizer of Frobenius headache – at the expense, of
course, of much more challenging motivic and stack-theoretic arguments.
For the full discussion, see our discussion of the relative unipotent
version of Besser’s Tannakian Coleman integration in Theorem 6.2.6 .

#### 1.2.3 The Chabauty–Kim diagram for relative completions

Last but not least, the various motivic realizations of the relative
completion have known comparisons due to Olsson, Pridham, Hain, and
others. Assume that both @xmath and @xmath are semisimple and simply
connected. Taken together with a simple generalization of the Bloch–Kato
logarithm, these comparisons give us a complete diagram of stacks
(Section 7.1.1 )

  -- -- --
        
  -- -- --

that strictly generalizes the Chabauty–Kim diagram when @xmath is the
identity, i.e. when @xmath is just the unipotent completion of the
fundamental group. We also prove a number of other results, such as
analyticity of the Albanese map (Section 6.5 ) and
strat-representability of the Selmer stack for the reductive quotient of
the étale relative completion (Section 5.2 .) Last but not least, we
assume “all conjectures” and show how one could prove Siegel’s theorem
for the affine modular curves @xmath ( @xmath ) using Eisenstein classes
(Section 7.2 .) The case @xmath is that of the projective line minus
three points.

###### Remark 2.

The semisimplicity and simple-connectedness of @xmath also has to be
checked on a case-by-case basis. This condition, and the one on the
monodromy above, arises because we must use a theorem of Kneser on
vanishing of Galois cohomology for semisimple and simply-connected
algebraic groups to produce points on certain path torsors. These
conditions could likely be removed in future work by using
non-archimedean stacks in the étale topology, but we have avoided that
here because descent in the étale topology is much more complicated for
rigid spaces than for schemes.

#### 1.2.4 Related results

The reader might see some superficial similarities between our
cohomology stacks and the non-abelian cohomology schemes of Hain’s paper
[ 44 ] , which proves some representability results for non-abelian
cohomology sets related to relative completions. However, his results
regard unipotent fundamental groups, so they are really quite different
than those of the current paper.

Much of the work on motivic relative completions after Hain comes from
the work of Pridham. The reader is directed to the invaluable works [ 80
] and [ 79 ] for a high-level (and highly homotopical) analysis of
relative Malcev completions of fundamental groups.

There has been a flurry of recent work applying relative completions to
modular forms and periods. Both Hain [ 45 ] and Brown [ 17 ] and many
others have fruitfully applied relative completions to understanding
these arithmetic problems. As we see in the section on the projective
line minus three points, these works are quite related to our problem.

We note that our use of the phrase “relatively unipotent" clashes with
that of a body of work that uses this phrase for a kind of relative
fundamental group @xmath , for example in [ 93 ] . These two meanings
are sometimes related by pushforward and pullback of sheaves on @xmath
and @xmath . Aside from the connection of our work to elliptic
polylogarithms, we do not delve further into this relationship.

### 1.3 Future work

The most urgent result that one needs in order to apply Chabauty–Kim for
relative completions is (strat-)representability and algebraicity of
Selmer stacks for the relative completion.

Once that happens, it would be wonderful to have a theory of Coleman
integration for the relative completion to make the work more explicit;
@xmath -adic integrals of modular forms were studied by Coleman, but
computational tools would be welcome to form conjectures on vanishing of
integrals of modular forms on rational points.

Most of our theory could be applied to the entire pro-algebraic
completion of the fundamental group if the relevant @xmath -adic Hodge
theory were more developed in that case. Pridham’s work on pro-algebraic
homotopy types gets us most of the way.

Even though we apply Chabauty for the relative completion to the
projective line minus three points in this work, we need to assume the
Fontaine–Mazur conjecture for three-dimensional Galois representations
(in addition to algebraicity of the relevant Selmer stacks.) One would
like to give an unconditional proof of at least Siegel’s theorem. One
approach might involve showing that the cocyles @xmath for which the
dimension of @xmath jumps are cut out by @xmath -adic equations in

  -- -------- --
     @xmath   
  -- -------- --

Finally, though the goal of this work was to bring the method of
Chabauty–Kim closer to the method of Lawrence–Venkatesh, we have not yet
applied our work to Kodaira–Parshin families. The first step would be to
understand the cohomology of the local systems coming from these
families. Alternatively, one could approach finiteness (via the original
formulation of the Shafarevich Conjecture) using relative completions
for the moduli space of curves, which have a rich arithmetic and
geometric theory (see [ 43 ] , [ 46 ] .)

### 1.4 Notation

We have tried throughout to keep uniform algebraic notation: @xmath is a
general number field with places @xmath , @xmath is a @xmath -adic field
with residue field @xmath , @xmath is the maximal unramified
subextension of @xmath and @xmath is the valuation ring of @xmath . If
@xmath is a scheme over @xmath and @xmath is an @xmath -algebra, we
often write @xmath for @xmath .

We usually denote a Tannakian category by @xmath and its fundamental
group by @xmath ; if the Tannakian category is a thick subcategory of
another category @xmath generated by an implicit object @xmath , we
usually supress @xmath and write just @xmath for the thick subcategory
and @xmath or @xmath for its fundamental group. All torsors are right
torsors.

## Chapter 2 The Relative Completion

### 2.1 Relative completions: algebraic theory

A reference for the following material is [ 45 , Part 1, Section 3] .
Let @xmath be a Tannakian category with fundamental group @xmath , and
@xmath a distinguished element of @xmath that we will generally suppress
in our notation. We denote by @xmath the Tannakian fundamental group of
@xmath the Tannakian subcategory generated by @xmath inside @xmath . (By
this we mean it contains @xmath and is closed under tensor product,
dual, quotient, and direct sum.) A general note about our Tannakian
categories notation: If @xmath are two fiber functors on a Tannakian
category @xmath , we write @xmath for the scheme @xmath – if these two
fiber functors come from points @xmath in a geometric situation, we will
simply write @xmath .

We make the following assumption throughout this work: @xmath is
reductive, or equivalently, every element of the tensor category
generated by @xmath is semisimple.

###### Definition 2.1.1.

Let @xmath be the subcategory of @xmath defined by the property that its
elements have a filtration by subobjects

  -- -------- --
     @xmath   
  -- -------- --

such that each representation @xmath factors through the map @xmath ; in
other words, the associated graded of @xmath lies in @xmath .
Equivalently, @xmath is the thick tensor subcategory generated by @xmath
. We call this the category of objects of @xmath that are unipotent
relative to @xmath , or if @xmath is implicit just the relatively
unipotent objects.

Finally, we will refer to @xmath as either the relative unipotent
fundamental group of @xmath or as just the relative completion, with
@xmath and @xmath implicit.

(Note that the terminology relative completion is slightly misleading
because there is no completion going on yet.) When @xmath is the tensor
unit, the category @xmath is the traditional category of unipotent
objects. For brevity, denote by @xmath the fundamental group of @xmath .
There is a map @xmath given by including the Tannakian category
generated by @xmath into the thick Tannakian category generated by
@xmath . Also, the inclusion of the full subcategory of truly unipotent
objects induces a surjection from the fundamental group of objects
unipotent relative to @xmath to the fundamental group of unipotent
objects.

###### Proposition 2.1.2.

The homomorphism @xmath induces an exact sequence

  -- -------- -- -------
     @xmath      (2.1)
  -- -------- -- -------

where @xmath is pro-unipotent.

###### Proof.

The surjectivity of @xmath follows from the fact that @xmath is a full
subcategory of @xmath , and that the former is closed under subobjects
in the latter [ 72 ] .

Now let @xmath denote the subgroup of @xmath which fixes the associated
graded of any element of @xmath for any filtrations as above, i.e. the
@xmath -representations @xmath are trivial for all objects @xmath and
all filtrations whose associated gradeds descend to @xmath
-representations. From this description it is clear that @xmath is
precisely the kernel of the map @xmath .

Let us show that @xmath is unipotent by induction. There is an
increasing sequence of subcategories @xmath that bounds by @xmath the
number of terms in the filtration associated to objects of @xmath ;
denote by @xmath its fundamental group, and @xmath the subgroup which
fixes the associated graded of @xmath -filtrations, as before. The
inclusion @xmath gives a map @xmath whose kernel @xmath consists of
elements which fix (the fiber of) all objects of @xmath . Let @xmath ;
then the action of @xmath on @xmath factors through @xmath because
@xmath . But @xmath acts trivially on the associated graded by
definition, and so @xmath acts unipotently on @xmath for all @xmath .

Now @xmath is unipotent because it acts unipotently on representations
of @xmath . One sees this by embedding @xmath into some @xmath and
observing that @xmath acts unipotently on the canonical representation
of @xmath . This argument moreover shows that @xmath is the unipotent
radical of @xmath , since any presentation of @xmath as an extension of
a reductive group by a unipotent group is unique up to conjugation.
Thus, since @xmath is the inverse limit of the @xmath , it is
pro-unipotent. ∎

We use the following notation for a pro-algebraic group that is an
extension of a reductive group by a pro-unipotent group. Let @xmath
denote the @xmath -th level of the lower central series with @xmath ,
and so on and so forth, setting also @xmath and @xmath . The notation
@xmath will refer to the extension obtained by pushing out 2.1 by the
map @xmath .

We can use this machinery to construct a generalized version of the
unipotent or Malcev completion of an abstract group.

###### Definition 2.1.3.

Let @xmath be a continuous and Zariski-dense homomorphism of a
topological group @xmath into an reductive group @xmath over a
topological field @xmath . Consider the Tannakian category @xmath of all
finite dimensional continuous representations of @xmath defined over
@xmath and its Tannakian subcategory @xmath of representations unipotent
relative to @xmath , as defined above.

The relative completion of @xmath with respect to @xmath , and over
@xmath , is defined as the Tannakian fundamental group of @xmath .

This relative completion has an important universal property which
mirrors that of the Malcev completion. Preserve the notation of the last
definition, writing @xmath for the relative completion and @xmath for
its unipotent radical.

###### Proposition 2.1.4.

Let @xmath be a proalgebraic group which is an extension

  -- -------- --
     @xmath   
  -- -------- --

where @xmath is unipotent, and suppose there exists a map @xmath whose
composition with @xmath is @xmath . Then there is a map @xmath that
makes the following diagram commute, where the horizontal arrow is
@xmath :

  -- -- --
        
  -- -- --

The proof of this fact proceeds in exactly the same way as the result
that the Tannakian fundamental group of all representations is precisely
the algebraic envelope over @xmath , cf. A.1 .

The operation of taking relative completions is functorial in the sense
that if one is given two representations @xmath and @xmath and a map
@xmath such that @xmath , there is a morphism @xmath “making all of the
relevant diagrams commute.”

###### Example 2.1.5.

We may apply the technology of the relative completion to étale
fundamental groups as follows.

Suppose @xmath is a scheme defined over any field @xmath , that @xmath
is a @xmath -local system on @xmath such that the pullback of @xmath to
@xmath has reductive monodromy group @xmath . Write @xmath for the
Tannakian relative completion of the category of @xmath -local systems
with respect to @xmath (equivalently, with respect to the morphism
@xmath defined by @xmath .)

Now the Galois action can be defined functorially: @xmath acts on @xmath
and thus on the category of @xmath -relatively unipotent local systems
on @xmath . The functoriality of Tannakian reconstruction implies that
an action by equivalences of this category induces an action by
automorphisms on its fundamental group.

An equivalent and more conventional way to define the Galois action is
using a conjugation action. We start with the so-called Fundamental
Exact Sequence

  -- -------- --
     @xmath   
  -- -------- --

Here @xmath refers to the profinite étale fundamental group. The
basepoint @xmath provides a section of this map, using the functoriality
of Galois categories, and then @xmath acts on @xmath by conjugation.
Secondly, @xmath also acts on @xmath by conjugation using the Galois
action on the stalk of @xmath at @xmath , and the map

  -- -------- --
     @xmath   
  -- -------- --

is equivariant with respect to these two actions.

Given this equivariance, the functoriality of the relative completion
furnishes an action of @xmath on @xmath .

Last but not least, we cover an essential bit of homological algebra
that is important to computations and comparisons with the relative
completion. For any extension @xmath of a reductive @xmath by a
unipotent @xmath as above and any representation @xmath of @xmath , we
have a Lyndon–Hochschild–Serre spectral sequence

  -- -------- --
     @xmath   
  -- -------- --

But @xmath is reductive and thus has vanishing higher cohomology; so the
terms of the spectral sequence are zero if @xmath . We thus obtain an
equality

  -- -------- --
     @xmath   
  -- -------- --

Now suppose that we have two such extensions of @xmath , with a map
between them. With some algebraic work one shows that the morphism
@xmath is an isomorphism if the induced map

  -- -------- --
     @xmath   
  -- -------- --

is an isomorphism for all irreducible representations @xmath of @xmath .
The point is that both sides will have an interpretation as certain (de
Rham, étale, etc.) cohomology groups on a space @xmath , which we can
compare.

### 2.2 Overview: relative completions for the motivically inclined

In the next sections we will define and discuss various “relative
completions” of motivic fundamental groups. Again, we use quotation
marks here because the resulting fundamental group will not always be
the relative completion of a group in the category of sets with respect
to a representation. However, they will always come from a thick
Tannakian subcategory of a larger category, as we explained in the last
section.

In any case, we take this section to prepare the reader for the motivic
story that she is about to read in various realizations. The protagonist
of our story is a smooth quasi-projective scheme @xmath over @xmath ,
and in its arsenal lay a vector bundle with integrable connection on
@xmath ( @xmath ) or @xmath , or an isocrystal on the special fiber of
@xmath at @xmath , or a @xmath -local system on @xmath that is defined
over @xmath . Betti local systems also play an important role in our
story.

Being motivic, these act like they are realizations of one true entity,
@xmath . The best way to obtain such an object will be to start with a
smooth and proper morphism @xmath and push forward a “trivial motive" to
obtain the relative de Rham cohomology, or fiberwise geometric étale
cohomology, etc. We call this the “Gauss–Manin case” because the de Rham
realization of this process is the Gauss–Manin connection.

The Tannakian fundamental group of (the various realizations of) @xmath
in the category of local systems over @xmath , or the category of vector
bundles, or… will be denoted @xmath , as in the last section. Then
Deligne’s machinery of algebraic geometry in a Tannakian category says
that the structure sheaf @xmath always has the structure of an
ind-motive over @xmath , i.e. an ind- @xmath -local system, or an
ind-vector bundle with integrable connection, or…

We then take the cohomology @xmath . For smooth and proper @xmath , we
have formality theorems of the following kind, given by Olsson, Pridham,
and Hain:

The Lie algebra @xmath of the unipotent radical @xmath of @xmath in each
category is a quotient of the free Lie algebra on @xmath with relations
given by the cup products of these elements into @xmath .

These types of theorems are generalizations of Chen’s original @xmath
-de Rham theorem and the amazing formality result of Deligne, Griffiths,
Morgan, and Sullivan [ 31 ] . In the classical setting of unipotent
Tannakian fundamental groups, this formality result says precisely that
@xmath is the quotient of the free Lie algebra on @xmath by cup product
relations.

When @xmath is not projective, one can still use the Leray and Adams
spectral sequence and weight arguments to give a presentation for @xmath
. For our purposes, the important statement is as follows [ 80 , proof
of Proposition 3.4] . We write @xmath for @xmath projective and @xmath
some normal crossings divisor such that @xmath has tame monodromy around
@xmath , and @xmath for the inclusion of @xmath into @xmath .

The Lie algebra @xmath of the unipotent radical @xmath of @xmath in each
category is a quotient of the free Lie algebra on @xmath with relations
given by cup product and spectral sequence maps between these groups and
wedge and tensor products of the groups @xmath , @xmath , and @xmath .

The most difficult weight argument appears in the crystalline case,
where one needs the recent work of Abe and Caro [ 1 , Main Theorem] for
the above statement.

Now that we have some motivation for the motivic story, we begin to
build moduli spaces for the étale relative completion.

## Chapter 3 Stacky Non-Abelian Galois Cohomology

As the conjectures of Bloch-Kato and others have shown, the theory of
Galois representations is a central organizing principle in number
theory. And as soon as one begins to study any group representations,
one immediately becomes interested in the cohomology of the given group
with values in a representation – these groups are the derived functors
of the invariants.

For us, the important fact is that the étale fundamental group of a
scheme defined over a number field comes with an action of the Galois
group of the base field. The étale fundamental group can therefore
rightly be called a non-abelian Galois representation. Let us define
stacky Galois cohomology of these non-abelian Galois representations and
prove that it satisfies the single most important property of group
cohomology: as much as possible, it converts short exact sequences of
representations to long exact sequences in cohomology. First we must
define what we mean by an exact sequence of groupoids.

###### Definition 3.0.1.

  (1)  

     A homomorphism of groupoids is a functor between the underlying
    categories.

  (2)  

     We call a groupoid @xmath pointed if it has a distinguished
    isomorphism class, called the point of @xmath and usually denoted
    @xmath .

  (3)  

     A homomorphism of groupoids @xmath is called pointed if it sends
    the point of @xmath to the point of @xmath .

  (4)  

     The kernel of a homomorphism of pointed groupoids is the
    subcategory sent to the point, and the image of such a homomorphism
    is the essential image of the functor. We say that a sequence of
    homomorphisms of groupoids is exact if the kernel of the second map
    is equal the image of the first.

We now have the technology to discuss non-abelian cohomology groupoids.
The basic material on short exact sequences below is from the canonical
reference, Serre’s book on Galois cohomology [ 84 , Chapter 1, Section
5] – though Serre does not use the language of groupoids.

###### Definition 3.0.2.

Consider @xmath , a topological group, acting continuously on a
topological group @xmath . The action of @xmath on @xmath will be
denoted @xmath .

  (0th Cohomology Group)  

     We define

      -- -------- --
         @xmath   
      -- -------- --

  (1st Non-abelian Cohomology Groupoid – non-stacky)  

     The set of continuous 1-cocycles of @xmath with values in @xmath is

      -- -------- --
         @xmath   
      -- -------- --

    There is an action of @xmath on @xmath given by

      -- -------- --
         @xmath   
      -- -------- --

    and the quotient groupoid by this action is the first cohomology
    groupoid @xmath . It has a canonical point given by the isomorphism
    class of the trivial 1-cocycle.

The following construction, called Serre twisting, will come up
throughout our exposition. If @xmath is a cocycle with values in a group
@xmath and @xmath acts on another group @xmath , then we denote by
@xmath the new @xmath -set on which @xmath acts via @xmath . Usually it
will either be the case that @xmath acting on itself on the left or we
will have an extension of @xmath by @xmath and @xmath will act by
conjugation.

Finally, for our purposes a short exact sequence of topological @xmath
-groups is a sequence of topological groups with continuous @xmath
-action

  -- -------- --
     @xmath   
  -- -------- --

which is exact as a sequence of groups and such that each of the
morphisms in the exact sequence is continuous. Note that in many places
in the literature one requires the second map to be a topological
quotient, but we do not need that here.

###### Proposition 3.0.3.

In the setup of the last definition, let @xmath be a subgroup of @xmath
. Consider the following conditions on @xmath , of increasing
stringency:

  0  

    @xmath is a @xmath -stable subgroup of @xmath such that @xmath has
    some given topology such that the map @xmath is continuous, and
    there is a continuous section of the map @xmath .

  1  

    @xmath is normal and @xmath -stable in @xmath , yielding a short
    exact sequence of topological @xmath -groups

      -- -------- --
         @xmath   
      -- -------- --

    and there is a continuous set-theoretic section of the map from
    @xmath to @xmath .

  2  

    @xmath is abelian, normal, and @xmath -stable in @xmath , and the
    aforementioned splitting exists.

  3  

    @xmath is central and @xmath -stable in @xmath and the
    aforementioned splitting exists.

Then we have the following non-abelian analogues of short exact
sequences for cohomology groupoids:

  0  

     Under condition , there is an exact sequence

      -- -------- --
         @xmath   
      -- -------- --

    of pointed groupoids, which is an exact sequence of groups at the
    first two terms. Furthermore, the following “twisted exactness
    property” holds: Let @xmath , and @xmath its image. Then the
    groupoid-theoretic fiber above @xmath in the above exact sequence is
    given by the groupoid

      -- -------- --
         @xmath   
      -- -------- --

    (In particular, it is independent of which @xmath in the fiber is
    chosen.)

    This twisted exactness property does not require the existence of a
    continuous splitting of the quotient map.

  1  

     Under condition , there is an exact sequence

      -- -------- --
         @xmath   
      -- -------- --

    of pointed groupoids, which is an exact sequence of groups at the
    first 3 terms. Furthermore, the following “twisted exactness
    property” holds, in addition to the property mentioned in : Let
    @xmath , and denote by @xmath the image of @xmath in @xmath . Then
    the groupoid-theoretic fiber above @xmath in the exact sequence is
    given by @xmath . Here the twist @xmath is by conjugation.

  2  

     Under condition , the exact sequence given above,

      -- -------- --
         @xmath   
      -- -------- --

    satisfies a further exactness property. For a class @xmath , there
    is an element @xmath such that @xmath is in the image of the map
    from @xmath if and only if @xmath is cohomologous to the trivial
    cocycle. (By @xmath we mean that @xmath acts on @xmath by
    conjugation since @xmath is abelian, and as described before the
    @xmath -action on @xmath is @xmath .) Furthermore, @xmath is defined
    only up to a choice of cocycle representative for @xmath , but its
    triviality does not depend on this choice.

  3  

     Under condition , there is an exact sequence

      -- -------- --
         @xmath   
         @xmath   
      -- -------- --

    of groupoids which furthermore satisfies all of the previous twisted
    exactness properties.

###### Remark 3.

The connecting homomorphism @xmath is given by continuously lifting an
element @xmath to @xmath , and sending it to the cocycle @xmath The
cocycle @xmath is defined by lifting a cocycle @xmath to a continuous
function @xmath . One sends this function to the continuous 2-cocycle
@xmath ; in general, this is an element of @xmath , but when @xmath is
central it is easy to see that @xmath is canonically isomorphic to
@xmath , so we have an honest connecting homomorphism.

The existence of @xmath can be made more theoretically satisfying. In
fact, suppose that we are in case , where @xmath is just normal. Then if
one considers the short exact sequence @xmath as an exact sequence of
crossed modules, there is always an honest long exact cohomology
sequence of non-abelian cohomology crossed modules up to @xmath ! The
theory of crossed modules also makes Serre twisting much more natural.
However, defining non-abelian @xmath would take us too far afield of our
exposition here. For a complete reference, see [ 54 ] .

###### Remark 4.

There is no modification needed to the proofs in [ 84 ] besides the
obvious fact that all maps there are indeed maps of groupoids; we claim
no original thought in this regard but this observation is essential to
our later work. We do not review the proofs here, and it would be hard
to find better proofs than in Serre’s exposition.

If we imagine the set @xmath as a geometric space, we can think of the
groups @xmath as a family of groups that varies continuously over it. In
later chapters we will do much more than imagine such a space. The
following proposition is at least some cheap version of this fantasy: it
says that @xmath acts like a section of that imagined bundle.

First, a definition that we need to state the proposition.

###### Definition 3.0.4.

A topological group @xmath acts continuously on a topological space
@xmath if the map @xmath is continuous. A topological group @xmath acts
continuously on a functor @xmath if its action on @xmath is continuous
for each @xmath .

###### Example 3.0.5.

Let @xmath be an algebra over a complete Hausdorff topological field of
characteristic zero. We give @xmath the inductive limit topology, the
finest topology for which the inclusion of finite-dimensional subspaces
is continuous. (Finite-dimensional subspaces are given the product
topology from the base field.)

If @xmath is an affine @xmath -scheme of finite type, then @xmath has
the topology induced by choosing some closed embedding @xmath . Then
@xmath , and we give @xmath the subset topology using the product
topology on the right. This topology is independent of the embedding,
and maps of affine schemes induce continuous maps on @xmath -points [ 62
, Lemmas 1-3] . We will only use this topologization of points for
affine schemes; if one wants to glue this definition for general schemes
or related nice properties such as open embeddings of schemes inducing
open embeddings of topological spaces, it becomes necessary to assume
that the inversion map on the units of @xmath is continuous (cf. the
exposition in [ 21 , Section 4] .)

Thus, if @xmath is an algebraic group over @xmath then the functors

  -- -------- --
     @xmath   
  -- -------- --

and

  -- -------- --
     @xmath   
  -- -------- --

for @xmath running over affinoid @xmath -algebras land in the category
of topological spaces, again using closed embeddings into affine space
and the topologies on both @xmath and @xmath It therefore makes sense to
discuss the continuity of an action of a profinite group @xmath on the
two functors above.

For us, the important example of such a continuous action arises as
follows [ 62 , Lemma 5] : Suppose that the coordinate ring of @xmath
comes with a continuous action @xmath of @xmath , then the action of
@xmath on @xmath given by

  -- -------- --
     @xmath   
  -- -------- --

is continuous in the above sense, and the same is true for @xmath .

We will need long exact sequences in these contexts, so we must provide
functorial and continuous splittings for short exact sequences.

###### Proposition 3.0.6.

Let

  -- -------- --
     @xmath   
  -- -------- --

be a short exact sequence of linear algebraic groups over a field @xmath
in which @xmath is unipotent. There exists a scheme-theoretic section
@xmath of @xmath .

###### Proof.

It is an exercise in group theory to show that @xmath is a @xmath
-torsor over @xmath for the étale topology. Then the proof follows
Mostow’s Theorem in the non-algebraically closed case [ 26 , Prop.
5.4.1, until “We will modify…”] , as follows.

By pushing out to the lower central series, we may assume @xmath is
abelian; then @xmath is a vector bundle. We would like to show that this
torsor is trivial; it forms a class in sheaf cohomology on the étale
site: @xmath . But this cohomology vanishes because @xmath is affine. ∎

We need one more result establishing functoriality for the connecting
homomorphism.

###### Proposition 3.0.7.

Let @xmath and @xmath be topological-group functors from a category
@xmath to the category of topological groups, such that @xmath acts
continuously on them. Suppose that for all @xmath , @xmath and @xmath
satisfy condition above, i.e. that @xmath is an abelian, normal, and
@xmath -stable subgroup of @xmath with quotient functor @xmath . Then
the ad-hoc connecting homomorphism @xmath is functorial in the following
sense.

Let @xmath be a cocycle, @xmath a morphism in @xmath . On one hand,
@xmath is an element of @xmath ; post-composing with @xmath produces an
element which we will denote @xmath . On the other hand, @xmath defines
a cocycle @xmath by post-composing with @xmath , and it has an
associated cocycle @xmath . The claim of functoriality means that

  -- -------- --
     @xmath   
  -- -------- --

###### Proof.

One has

  -- -------- --
     @xmath   
  -- -------- --

On the other hand,

  -- -------- --
     @xmath   
  -- -------- --

The proposition thus follows from the functoriality of the group
operation on @xmath and the functoriality of the action of @xmath on
@xmath . ∎

If @xmath is a functor in groups on a Grothendieck site then we can use
the machinery of non-abelian cohomology sets to develop a stacky version
of non-abelian cohomology for @xmath .

###### Definition 3.0.8.

@xmath of a non-abelian representation (stacky) Let @xmath be a functor
in topological groups on a Grothendieck site @xmath , @xmath a
topological group acting continuously and functorially on @xmath , and
@xmath . We define the stack

  -- -------- --
     @xmath   
  -- -------- --

to be the stackification of the pseudofunctor

  -- -------- --
     @xmath   
  -- -------- --

In other words, @xmath is the stack quotient

  -- -------- --
     @xmath   
  -- -------- --

We define @xmath of a general functor and @xmath for an abelian group
functor similarly, using sheafification.

###### Example 3.0.9.

It is not hard to see that if @xmath is the Zariski site of schemes and
@xmath is a group scheme with an action of some group @xmath , the
functor @xmath agrees with the usual definition of @xmath : @xmath is
the set of all @xmath such that @xmath for all @xmath , @xmath .

### 3.1 Interpreting cohomology stacks: torsors vs. cohomology classes

Armed with this definition, we proceed to the equivalence which is the
core of nonabelian group cohomology; the dictionary in the unipotent
case says that there is a bijection between torsors and elements of a
certain @xmath . In this section we extend this dictionary to the
non-unipotent case.

Let @xmath be a topological-group-valued sheaf on a site @xmath , with a
continuous (functorial) action of a profinite group @xmath . An @xmath
-torsor with @xmath -action is a sheaf @xmath with a continuous action
by @xmath and an action @xmath such that the torsorial map @xmath is an
isomorphism, and such that @xmath is @xmath -equivariant with respect to
the diagonal action on the left hand side.

We denote by @xmath the category of @xmath -torsors with compatible
@xmath -action, with isomorphisms as morphisms. For any @xmath denote by
@xmath the object @xmath . For varying @xmath the groupoids @xmath form
a stack on @xmath – this is a purely sheaf-theoretic argument [ 86 , Tag
036Z ] .

Note that such torsors generally may not be representable in the
category @xmath . However, since we will always have descent for the
topologies we consider, such torsors will indeed be representable.

###### Definition 3.1.1.

Let @xmath be an algebraic group over a @xmath -adic field @xmath on
which @xmath acts continuously and @xmath -linearly for the @xmath -adic
topology, and @xmath a rigid-analytic space over @xmath . By an @xmath
-torsor @xmath over @xmath we mean an @xmath -torsor over @xmath in the
Tate topology: For every point @xmath , there exists an admissible
neighborhood @xmath containing @xmath and a @xmath and @xmath
-equivariant isomorphism

  -- -------- --
     @xmath   
  -- -------- --

Such a torsor is represented by a rigid-analytic space over @xmath ,
since rigid-analytic spaces satisfy descent for admissible coverings by
definition, and we see that the @xmath -torsors form a stack in
groupoids over the category of rigid-analytic spaces.

Let us finally state the desired equivalence. We return to the abstract
situation where @xmath is a functor in topological groups on @xmath ,
and assume that @xmath is a stack on @xmath . Suppose, furthermore, that
every @xmath -torsor-with- @xmath -action acquires a @xmath -point for
some @xmath which covers @xmath in @xmath . Consider the association of
pseudofunctors

  -- -------- --
     @xmath   
  -- -------- --

given by sending a cocycle @xmath to the @xmath -torsor @xmath , i.e.
the Serre twist of @xmath by @xmath . The universal property of
stackification gives a map

  -- -------- --
     @xmath   
  -- -------- --

where now the source means the stackified cohomology.

###### Proposition 3.1.2.

The map @xmath is an isomorphism of stacks.

###### Proof.

We check the defining properties of the stackification as given in [ 86
, Section 02ZM ] (we have placed it in C.1.10 for ease of reference).

  (1)  

    By assumption, for any @xmath there is an object @xmath which covers
    @xmath in @xmath and a cocycle @xmath such that @xmath . Indeed, we
    may by our assumption let @xmath be a @xmath -covering of @xmath
    such that @xmath has a point @xmath and work as follows.

    The point @xmath defines a cocycle in the standard way:

      -- -------- --
         @xmath   
      -- -------- --

    i.e. the unique element @xmath such that @xmath , and standard
    argument shows that @xmath and thus @xmath .

  (2)  

    We must show that, for any two cocycles @xmath in @xmath , the map
    of presheaves on @xmath

      -- -------- --
         @xmath   
      -- -------- --

    identifies the latter as the sheaffification of the former. But this
    is obvious because the two are canonically isomorphic on all @xmath
    -points: an element @xmath exhibiting @xmath and @xmath as
    cohomologous is sent to the isomorphism “translation by @xmath ” on
    the right hand side. This association is clearly injective, and in
    fact any isomorphism between @xmath and @xmath is given by
    translation by an element @xmath .

∎

Recall that by the universal property of rigid analytification (cf.
D.3.1 ) if @xmath is an affine algebraic group over @xmath and @xmath is
an affinoid algebra over @xmath , we have a bijection @xmath

###### Example 3.1.3.

We apply Proposition 3.1.2 when @xmath is the category of rigid-analytic
spaces over @xmath , @xmath is the Tate topology on @xmath , and @xmath
is an algebraic group over @xmath . Then we see that the stackification
of the functor which sends an affinoid @xmath -algebra @xmath to @xmath
is precisely the stack of @xmath -torsors defined in Definition 3.1.1 .

###### Remark 5.

On the étale side, we are not generally concerned with the question of
whether a @xmath -torsor with trivial @xmath action has a point defined
over the base field, because all path torsors for the étale fundamental
group will have a point over the base field. An extremely important
point is that this point might have a highly non-trivial Galois orbit.

Here is a sketch of the fact that all path torsors have (likely not
Galois-invariant!) rational points [ 87 , Proposition 5.5.1] . The
universal cover of @xmath has a model defined over the base field. The
fiber at a point @xmath is just the profinite limit of the fibers of all
covers in the pro-cover. The inverse limit of nonempty finite sets is
nonempty, and we conclude that there is a point in the fiber of the
universal cover. Mapping this fiber to the Tannakian fundamental group
gives the desired path in the path torsor.

A brief warning: There are, then, two senses in which Galois cohomology
could potentially enter into the non-unipotent picture. On one hand, one
has a Galois action on the entire pro-scheme @xmath . On the other hand,
one has a Galois action on the points @xmath . The first is the one
involved in the Chabauty-Kim diagram, and the second would be involved
in classical questions about twists of algebraic groups. It is often
confusing to newcomers that our Galois cohomology only detects the
former.

This is related to the fact that we have to use Kneser’s theorem to
assume our torsors on the de Rham side have trivializations, and it
comes from the fact that our stacks will have effective descent for the
Tate topology only. Such a move might be avoidable, but in order to
stackify with respect to the étale topology in the rigid setting, we
would have to know much more about effective descent for torsors in the
rigid étale topology. Unfortunately, fpqc and étale descent of
quasi-coherent sheaves is very difficult in the rigid setting [ 24 ] ,
so we have purposefully avoided these topologies.

We record for use the following fact that follows directly from the
cohomology long exact sequence above. Let @xmath be a Grothendieck site.

###### Proposition 3.1.4.

Let @xmath and @xmath a topological group; suppose that @xmath and
@xmath are sheaves of topological groups on the category @xmath , @xmath
is a subsheaf of @xmath , and that @xmath acts continuously on @xmath
while preserving @xmath . Now let @xmath be the morphism of stacks
coming from the inclusion of @xmath into @xmath . Pick a cocycle @xmath
, and let @xmath be its image in the stackified cohomology of @xmath .
Then the stack-theoretic fiber above @xmath in the stack @xmath is
@xmath -locally the quotient stack

  -- -------- --
     @xmath   
  -- -------- --

If @xmath is normal in @xmath with quotient @xmath and @xmath with image
@xmath , then the fiber of @xmath above the class @xmath is given by the
stack quotient @xmath .

###### Proof.

We just prove the second statement, and the first is identical. The
stack-theoretic fiber @xmath above @xmath is given by the pullback

  -- -- --
        
  -- -- --

Since sheafification commutes with pullback, we may compute this
pullback on the level of cohomology pseudofunctors and then stackify.
But Serre’s long exact sequence shows that this is isomorphic to the
unstackified @xmath , which finishes the proof.

∎

We will actually need a slightly upgraded version of this proposition,
in which we twist by a torsor.

###### Definition 3.1.5.

Let @xmath , for an object @xmath . Suppose, furthermore, that @xmath
acts on the left on another group @xmath over @xmath , compatible with
the @xmath -action and the group structure on @xmath . Then the twist of
@xmath by @xmath is the group

  -- -------- --
     @xmath   
  -- -------- --

As a group, this twist is isomorphic to @xmath , but it has the twisted
@xmath -action @xmath One locally sees the isomorphism with @xmath
because locally on @xmath , @xmath has a point @xmath , and one has the
bijection @xmath . The key point is:

###### Proposition 3.1.6.

If @xmath has a point @xmath , let @xmath denote the associated cocycle.
Then we have an isomorphism in @xmath :

  -- -------- --
     @xmath   
  -- -------- --

given by @xmath .

###### Proof.

This follows from the equalities

  -- -------- --
     @xmath   
  -- -------- --

∎

Now the following statement is obtained by locally following through the
bijection between twisting by torsors and cocycles. Suppose, as before,
that any @xmath -torsor has a point locally on @xmath for whichever
topology we are considering.

###### Corollary 3.1.7.

The statements of Proposition 3.1.4 hold true when @xmath (resp. @xmath
) is replaced with any torsor in the stackified @xmath (resp. @xmath ),
and any cocycle twist is replaced by a torsor twist.

### 3.2 A review of classical Selmer conditions

From the “box” perspective on arithmetic geometry, Galois cohomology is
a good first step: it provides a container for the rational points, and
it often has extra internal structure (it may be a group or a scheme) or
external structure (it might fit into various exact sequences.) However,
experience shows that not all cocycles can arise as cohomology classes
in arithmetic situations. The key observation is that cocycles coming
from global points are constrained when we look at them as local points.

The original Selmer condition comes from the theory of abelian
varieties: Let @xmath be an abelian variety over a number field @xmath .
We will denote its @xmath -adic Tate module by @xmath , and @xmath . If
@xmath denotes multiplication by @xmath on @xmath , the exact sequence

  -- -------- --
     @xmath   
  -- -------- --

yields the long exact sequence

  -- -------- --
     @xmath   
  -- -------- --

From this sequence, one learns the short exact sequence

  -- -------- --
     @xmath   
  -- -------- --

If @xmath is finite then we have proved the finiteness of @xmath , also
known as the Weak Mordell Weil theorem. The following result dashes our
hopes.

###### Proposition 3.2.1.

Let @xmath be a finite continuous Galois module for @xmath , the Galois
group of a number field @xmath . Then @xmath is infinite. In particular,
when @xmath is a nonzero abelian variety over @xmath , @xmath is
infinite.

###### Proof.

We reproduce here a proof from Mikhail Borovoi, posted on MathOverflow [
35 ] . We make a number of reductions. Let @xmath be a finite extension
of @xmath with Galois group @xmath for which the action of @xmath on
@xmath is trivial. The exact sequence

  -- -------- --
     @xmath   
  -- -------- --

gives a long exact sequence

  -- -------- --
     @xmath   
  -- -------- --

Thus the kernel of the map @xmath is finite, so we may assume @xmath ,
which is @xmath for some @xmath . One now uses inflation restriction
with the extensions @xmath and @xmath ; since @xmath and @xmath are
finite ( @xmath is a finite group), it suffices to show the result when
the Galois action on @xmath is trivial.

Let @xmath be a collection of primes @xmath which are congruent to
@xmath and split completely in @xmath . (Note that by the Chinese
remainder theorem, @xmath as representations.) Now @xmath , the maximal
extension unramified outside of @xmath , is a quotient of @xmath , so it
suffices to show that @xmath is unbounded as @xmath varies. If we let
@xmath denote the ray class group of @xmath of conductor @xmath , then
class field theory furnishes us with an exact sequence

  -- -------- --
     @xmath   
  -- -------- --

(We are again using the congruence condition on @xmath here.) Now both
the unit group and the class group are finitely generated, independent
of @xmath . Thus, if we tensor the above sequence by @xmath , we see
using right exactness that @xmath has size @xmath , where @xmath does
not depend on @xmath .

But then @xmath is @xmath -dual to @xmath by the main property of the
ray class field. We now pick @xmath as large as we want by Chebotarev,
and we have bounded @xmath from below, and we are done. ∎

Undeterred, we look for a subgroup of @xmath that is finite. There are
local counterparts of our short exact sequences every completion of
@xmath , which lead to a commutative diagram with short exact top and
bottom rows

  -- -- --
        
  -- -- --

(Here @xmath is defined as the composition of the middle vertical
restriction map and the left lower horizontal arrow.)

###### Definition 3.2.2.

The @xmath -Selmer group of @xmath for @xmath a number field is @xmath .
As @xmath varies, the groups @xmath form a directed system, and we set
@xmath , with a similar definition for @xmath along powers of @xmath .
Note that @xmath . If @xmath is a completion at a place of @xmath , then
we define the local Selmer group by @xmath . By definition, then, the
global Selmer group consists of all global cohomology classes whose
localization lands in the local Selmer group.

In words, @xmath is the set of all global cohomology classes whose
restrictions come from local points. By the commutativity of the
diagram, @xmath lands in @xmath . Furthermore, if we define

  -- -------- --
     @xmath   
  -- -------- --

then there is an exact sequence

  -- -------- --
     @xmath   
  -- -------- --

Taking the inverse limit of the @xmath -Selmer groups and tensoring with
@xmath we see that

  -- -------- --
     @xmath   
  -- -------- --

so long as the @xmath -part of @xmath does not contain a copy of @xmath
. This is of course implied by the famous conjecture that @xmath is in
fact finite.

The proof of concept for @xmath is the following proposition:

###### Proposition 3.2.3.

@xmath is finite.

###### Proof Sketch.

There are two main steps to the proof. First, one shows that the classes
in @xmath are unramified outside of the primes dividing @xmath and the
primes of bad reduction for @xmath ; call the set of all such primes
@xmath . Then, one shows that the set of cohomology classes unramified
outside of a finite set of primes is finite. For this, one reduces to
trivial action using inflation-restriction. Using the first step, one
can then replace the cohomology of @xmath with the cohomology of @xmath
, where @xmath is the maximal abelian extension of @xmath with exponent
@xmath that is unramified outside of @xmath . The extension @xmath is in
fact finite, and it is here that one uses the classic and deep result on
the finiteness of the class group. The set of homomorphisms between two
finite groups is finite, and the proof concludes. ∎

###### Remark 6.

As one can see from the above sketch, one major advantage of the
cohomological proofs of diophantine finiteness is their clarity: One
often uses the same exact sequences again and again to reduce to a
question in algebraic number theory such as the calculation of the class
groups of number fields or, in more advanced applications, control
theorems in Iwasawa theory and @xmath -theory.

### 3.3 @xmath-adic Hodge Theory and Selmer conditions

The genius of Bloch and Kato was to define a Selmer subgroup of the
Galois cohomology of a representation that does not come from an abelian
variety. It is indeed their construction from @xmath -adic Hodge theory
that we will apply to non-abelian Galois representations. Crucially, we
need the formalism of crystalline representations in both the absolute
case they considered [ 13 ] and in the case of families of
representations [ 8 ] We will take here an axiomatic view of @xmath
-adic Hodge theory, and specifically its period rings; in a whirlwind
review such as this, digressions into cotangent complexes and
perfectifications can be left to wonderful references like [ 16 ] .

For this section we will let @xmath be a @xmath -adic field, @xmath the
largest unramified subfield of @xmath , and @xmath the valuation ring of
@xmath .

#### 3.3.1 Crystallinity over a point and in a family

###### Defining Property 3.3.1.

The period ring @xmath is a filtered flat @xmath -algebra with a
continuous @xmath -action. Here are some essential facts:

  1  

     The associated graded of @xmath is @xmath , where @xmath denotes
    the i-th Tate twist of the completion of the algebraic closure of
    @xmath .

  2  

     There is a @xmath -semilinear Frobenius map @xmath . It is
    injective, and the Frobenius-fixed part sits in a short exact
    sequence that relates it to the de Rham period ring [ 13 ,
    Proposition 1.17] .

  3  

    @xmath

  4  

    @xmath is @xmath -regular, meaning, first, that

      -- -------- --
         @xmath   
      -- -------- --

    where @xmath is the field of fractions of a domain and second, that
    if the @xmath -line generated by an element @xmath is fixed by
    @xmath then @xmath is a unit in @xmath .

The last property seems especially arbitrary, but it actually drives
much of the theory. In fact, if @xmath is a @xmath representation over
@xmath then we can define a functor

  -- -------- --
     @xmath   
  -- -------- --

to the category of vector spaces over @xmath ; the regularity of @xmath
then has a number of beautiful consequences. The first is the inequality

  -- -------- --
     @xmath   
  -- -------- --

We then say that @xmath is @xmath -admissible – or crystalline, more
succinctly – if equality holds above. One proves that an equivalent
condition for crystallinity is that the natural map

  -- -------- --
     @xmath   
  -- -------- --

is an isomorphism. We will also use, without further comment, the period
ring @xmath , which is a @xmath algebra with the property that @xmath
when @xmath is crystalline.

In the case of representations over a field (i.e. the non-relative
case), here is a definition of crystalline representations that suits
the infinite-dimensional algebras with which we will be working.

###### Definition 3.3.2.

Let @xmath be a possibly infinite-dimensional linear representation of
@xmath . We say that @xmath is crystalline if @xmath is the direct limit
of finite-dimensional subrepresentations which are crystalline in the
above sense.

One would like a definition of infinite-dimensional crystalline
representations that mimics the tensor product of the finite-dimensional
definition. The following theorem of Olsson gives this intrinsic
algebraic characterization.

###### Proposition 3.3.3.

( [ 75 ] , Remark D.10) Let @xmath be a possibly infinite dimensional
representation of @xmath . Then @xmath is the union of finite
dimensional crystalline subrepresentations (i.e. crystalline in the
above sense) if and only if the natural map

  -- -------- --
     @xmath   
  -- -------- --

is an isomorphism.

Now we turn back to representations of finite rank, but now in a family.
These families will help us compare the work of Wang-Erickson on
crystalline representations to our Selmer stack.

###### Definition 3.3.4.

Let @xmath be an affinoid @xmath -algebra. A family of representations
over @xmath of a profinite group @xmath is a locally free @xmath -module
@xmath with an @xmath -linear and continuous (for the @xmath -adic
topology on @xmath ) action @xmath .

The extension of this definition to non-affinoid rigid bases is
immediate. Pottharst [ 78 , Theorem, p. 1] brings the following theorem
about such families.

###### Theorem 3.3.5.

Assume @xmath has finite cohomology on all discrete @xmath -modules of
finite, @xmath -power order, vanishing in degrees greater than @xmath .
Let @xmath be a family of continuous representations of @xmath over a
rigid-analytic space @xmath . Then the continuous cochains of @xmath
with values in the sections @xmath , where @xmath runs over affinoid
subdomains, form a perfect complex of coherent @xmath -modules,
vanishing in degrees greater than @xmath .

Denote by @xmath the complex in Pottharst’s theorem. By taking
cohomology of @xmath , we have that the cohomology of @xmath with values
in @xmath forms a coherent @xmath -module as @xmath varies.

We can emulate the definition of admissibility for families, which we
state now for any @xmath -regular period ring @xmath .

###### Definition 3.3.6.

( [ 8 , Section 2.3] ) Let @xmath be a family of representations of
@xmath over @xmath . Set @xmath .

We say that @xmath is @xmath -admissible if the @xmath -module @xmath is
projective of finite type and the map

  -- -------- --
     @xmath   
  -- -------- --

is an isomorphism.

An ind-admissible family of representations is defined in the obvious
way, and one can generally set @xmath for an ind-representation @xmath
with choice of presentation @xmath . Bellovin [ 7 , Corollary 5.1.16]
shows that families of admissible representations are closed under
subobjects, tensor products, and duals, and all three commute with
@xmath .

Setting @xmath , we get a notion of crystallinity for a family. These
families form a stack in the usual way, which we denote @xmath . One
very important property of families of Galois representations is that
they are crystalline if and only if they are crystalline at all closed
points. Here is a precise statement.

###### Theorem 3.3.7.

( [ 8 , Corollaire 6.3.3] )

Suppose @xmath is a reduced affinoid algebra. Let @xmath be a family of
rank @xmath @xmath -representations over @xmath , @xmath and @xmath an
interval in @xmath such that for all @xmath , @xmath is crystalline with
Hodge-Tate weights in @xmath . Then @xmath is a locally free @xmath
-module of rank @xmath , and @xmath . In particular, @xmath is
crystalline if and only if @xmath is crystalline for all @xmath .

Bellovin [ 7 , Theorem 1.1.3] extended this theorem to the case where
@xmath need not be reduced, and crystallinity can be checked on finite
ring extensions of the base field.

###### Remark 7.

If @xmath is any family of representations, @xmath has a natural
filtration by the locally free @xmath -modules induced by the inclusion
@xmath and the canonical filtration on @xmath . If @xmath is de Rham,
then this filtration makes the isomorphism

  -- -------- --
     @xmath   
  -- -------- --

an isomorphism of filtered @xmath -modules. (The filtrations of course
being by locally free submodules.)

If @xmath is a map of de Rham representations then the morphism @xmath
is strict for the filtrations. This is because we have a diagram

  -- -- --
        
  -- -- --

where the vertical isomorphisms preserve filtrations; the top map is
obviously strict, so the bottom is too. This induces a strict map @xmath
because the subspace filtration is exactly the filtration we have just
put on @xmath .

Finally, we record the following definition.

###### Definition 3.3.8.

[ 65 , Section 2.6] Let @xmath and @xmath be @xmath -adic fields, and
@xmath a finite-dimensional @xmath -vector space equipped with a
filtration @xmath on @xmath Consider the collection of vector spaces

  -- -------- --
     @xmath   
  -- -------- --

Now let @xmath be a finite @xmath -algebra, and suppose @xmath is a
@xmath -dimensional @xmath -representation over @xmath .

Then we say that @xmath is of @xmath -adic Hodge type @xmath if for all
@xmath we have an isomorphism of @xmath -modules

  -- -------- --
     @xmath   
  -- -------- --

In particular, all representations of a given @xmath -adic Hodge type
have uniformly bounded Hodge–Tate weights. For us, the important example
of Hodge types will come from the family of Galois representations
coming from the Gauss–Manin connection. In this case, all stalks have
the same @xmath -adic Hodge type since embedding @xmath into @xmath
allows us to use the complex statement: the Gauss–Manin connection is a
variation of Hodge structure, and all stalks of a variation of Hodge
structures have the same Hodge type.

One defines the concept of @xmath -adic Hodge type for a family of
representations using closed points. Packaging all of these conditions
together, we have:

###### Definition 3.3.9.

We denote @xmath the stack of all crystalline families of @xmath
-representations of @xmath -adic Hodge type @xmath .

#### 3.3.2 Stacky Selmer conditions

We can now apply this definition to our discussion of torsors and
cohomology classes. The reader who is not familiar with formal or rigid
geometry should refer to Chapter D .

###### Definition 3.3.10.

Let @xmath be a @xmath -adic field and @xmath a group scheme over @xmath
on which @xmath acts continuously for the @xmath -adic topology.
Consider the pseudofunctor consisting of 2-kernels

  -- -------- --
     @xmath   
  -- -------- --

Here @xmath is a test object in the category of affinoid @xmath
-algebras. We define @xmath to be the stackification of this
pseudofunctor.

When @xmath and @xmath is a vector space, we define

  -- -------- --
     @xmath   
  -- -------- --

By this we mean the fibered product as stacks of the map inside of the
kernel with the @xmath -point of @xmath given by the trivial torsor.
(Here @xmath is the maximal unramified extension of @xmath .)

Note that the Galois action on @xmath incorporates the Galois action on
@xmath and the Galois action on @xmath ; it is defined as in Example
3.0.5 .

We will only use the latter case when @xmath is a vector space. We can
patch these local conditions together for global representations.

###### Definition 3.3.11.

Let @xmath be a global field, @xmath a rational prime, @xmath a set of
primes of @xmath including all primes lying over @xmath . Then for
@xmath an algebraic group over @xmath on which @xmath acts continuously,
we define the global Selmer stack

  -- -------- --
     @xmath   
  -- -------- --

(The category of stacks has fibered products, and so we see that these
objects are indeed stacks.)

###### Remark 8.

One has the following (rather finnicky) interpretation of these
rigid-analytic Selmer stacks, which follows from unwinding the
stackification. Let @xmath be an @xmath -torsor, where @xmath is a
rigid-analytic space. The question of whether @xmath lies in the Selmer
part is local for the Tate topology, so we may assume that @xmath and
@xmath is nonempty. Thus @xmath is determined by a cocycle in @xmath .
But since @xmath , @xmath is determined by an algebraic @xmath -torsor
with continuous @xmath -action @xmath over @xmath . Now @xmath is in the
Selmer part if and only if we have the usual Galois-equivariant
isomorphism

  -- -------- --
     @xmath   
  -- -------- --

###### Remark 9.

One might also want to impose conditions at primes away from @xmath ,
for example the condition that they are in the image of a map

  -- -------- --
     @xmath   
  -- -------- --

We do not deal with such conditions in any generality here, except for a
weight condition when proving the algebraicity of the Selmer stack.

###### Remark 10.

One would generally like to use the étale topology for this
stackification, in which case no issues of trivializing the Galois
cohomology of @xmath or @xmath would arise. Abstractly, this definition
of cohomology and Selmer stacks would be just fine (although it would
sacrifice the representability of torsors, since étale descent for rigid
torsors seems hard.) However, the arguments of Theorem 4.0.1 do require
one to glue objects in the topology in which one stackified, so the
representability argument would become more difficult.

#### 3.3.3 Agreement with the abelian case

For the benefit of the reader, we briefly explain why the Bloch–Kato and
classical Selmer groups agree in the case of an abelian variety @xmath
over a number field @xmath . We may reduce to the local case, because
both Selmer groups are defined by local conditions: pick @xmath a
rational prime such that @xmath has good reduction at all places
dividing @xmath . Let @xmath be the @xmath -adic Tate module of @xmath ,
and @xmath (or @xmath when there is no risk of confusion.) We claim that

  -- -------- --
     @xmath   
  -- -------- --

both groups lying inside @xmath , for any place @xmath of @xmath .

The easier case is when @xmath . By definition @xmath . We will show
that this group is zero. By inflation restriction, the kernel of this
map is @xmath . When @xmath has good reduction, this group is equal to
the Galois cohomology of the cohomology of the special fiber and the
Weil conjectures say that this representation has negative weight, and
thus @xmath ; by a result of Serre vanishing of zeroth cohomology
implies vanishing of first cohomology. Thus @xmath then as well. In the
case of bad reduction, the fact that the inertia fixed part corresponds
to the part of the special fiber that is an abelian variety [ 42 ,
Section 2] implies again by the Weil conjectures that @xmath using
weights exactly as above.

We now show that @xmath . This group is defined as the vector space
spanned by images of rational points in the Galois cohomology. But a
classical theorem of Mattuck [ 68 ] says that @xmath contains a finite
index subgroup that is isomorphic to the valuation ring of @xmath . In
particular, @xmath has a finite index subgroup which is a pro- @xmath
group. But then tensoring it with @xmath kills this pro- @xmath part and
any torsion. We thus have that the image of the local points under the
Kummer map is trivial, and we are done when @xmath .

When @xmath things are much more difficult – here we follow [ 13 ,
Example 3.11] . The key is a commutative square

  -- -- --
        
  -- -- --

where @xmath denotes the tangent space of @xmath . The maps in the above
square are as follows. The map @xmath is an isomorphism that arises from
Faltings’ de Rham comparison theorem. Namely,

  -- -------- --
     @xmath   
  -- -------- --

and removing the 0th filtered piece of the Hodge filtration leaves only
@xmath – this is precisely the tangent space. The top horizontal arrow
is also an isomorphism, since @xmath -adic exponential and logarithm are
both local diffeomorphisms (but a linear map that is a local
diffeomorphism is an isomorphism.) Finally, one shows that the
Bloch-Kato exponential is an isomorphism, with explicit inverse given by
Fontaine’s functor @xmath . Since those three maps are isomorphisms, we
conclude that the Kummer map @xmath is an isomorphism too.

We would be amiss if we did not mention that this whole crystalline
story can be done integrally, i.e. by looking at each representation
@xmath individually. For this one can use the theory of
Fontaine–Laffaille [ 36 ] when the ramification of @xmath is not too
large.

#### 3.3.4 Rational points land in Block–Kato stacks

In the case of abelian varieties, rational points landed in the Selmer
group because of a crystalline comparison theorem. For general
varieties, the situation is much more complicated. Using our definition,
we find that a torsor @xmath is crystalline (i.e. lives in @xmath )
exactly when there is an ordinary @xmath -torsor @xmath and a
Galois-equivariant isomorphism

  -- -------- --
     @xmath   
  -- -------- --

Just like in the case of abelian varieties, the non-abelian statement
that the crystalline path torsor @xmath lies in @xmath uses the full
force of @xmath -adic Hodge theory. In fact, we’ll need the crystalline
path torsor comparison theorem of Olsson.

###### Theorem 3.3.12.

[ 75 , Theorem 1.11] Let @xmath be a variety over @xmath which is a
complement of a normal crossings divisor in a smooth, proper scheme. Fix
@xmath and @xmath on @xmath and @xmath which are associated in the sense
of @xmath -adic Hodge theory. Suppose that the Tannakian monodromies of
both @xmath and @xmath are reductive and locally nilpotent. Then for all
@xmath , we have a Galois-equivariant isomorphism of path torsors

  -- -------- --
     @xmath   
  -- -------- --

Equivalently, @xmath is an (ind-)crystalline Galois representation and
@xmath .

Here is our statement, then.

###### Proposition 3.3.13.

Let @xmath be a smooth complement of a normal crossings divisor relative
to @xmath . Take @xmath a prime outside of @xmath and @xmath . Let
@xmath be a @xmath -local system on @xmath that is crystalline on @xmath
for all places @xmath of @xmath and has locally unipotent monodromy. Let
@xmath denote the relative étale fundamental group of @xmath with
respect to @xmath . Let @xmath be the associated isocrystal, and @xmath
, @xmath its relative completion and monodromy.

Suppose that @xmath is semisimple and simply connected. Then the pushout
to @xmath of the restriction of the path torsor @xmath to @xmath lands
inside @xmath for @xmath . Furthermore, @xmath acts on the relative
étale @xmath -fundamental group of @xmath through the quotient @xmath .
In particular, the pushouts to @xmath of the global path torsors @xmath
sit in the Selmer stack @xmath .

###### Remark 11.

By the statement @xmath lands in @xmath , we of course mean that the
rigid analytification of @xmath lands in @xmath , which classifies
rigid-analytic torsors. Since, as we note below, @xmath is completely
determined by @xmath , there is minimal risk of confusion.

Note also that @xmath is semisimple and simply connected if and only if
@xmath is, by [ 75 , Lemma 4.16, Section 4.12] .

###### Proof.

We establish that @xmath acts through its quotient @xmath ; i.e. we need
to show that the action of @xmath on @xmath is in fact unramified when
@xmath . We use the Adams spectral sequence and the corresponding
structure theorem for @xmath , as follows.

The Galois action on @xmath is given by conjugation by the Galois action
on the fiber @xmath , while the Galois action on the unipotent part is
given by the Galois action on

  -- -------- --
     @xmath   
  -- -------- --

(here @xmath is some smooth compactification of @xmath over @xmath .)

Now the unramifiedness of the Galois action on @xmath follows by
definition, since @xmath is defined over the whole of @xmath ; thus the
Galois action of @xmath on it factors through @xmath i.e. it is
unramified.

The corresponding statement for the unipotent part is a consequence of
the smooth and proper base change theorems, in fact a standard
consequence if @xmath is proper. In the non-proper case there is a
“Deligne Hodge II-style” spectral sequence involving the components of
@xmath that abuts to the cohomology group

  -- -------- --
     @xmath   
  -- -------- --

Furthermore, standard Tannakian theory tells us that the sheaf @xmath is
in @xmath . In particular, it is defined over the whole of @xmath .

The @xmath terms in this spectral sequence involve the cohomology of
smooth and proper schemes over @xmath , and a well-known argument with
smooth and proper base-change implies that the Galois action on each of
these cohomology groups is unramified. From this we see that the Galois
action on @xmath is unramified. A completely similar argument gives
unramifiedness for @xmath , since @xmath is already proper.

Now on to the Selmer part. Since there is no risk of confusion, we also
write @xmath for the pushout of the path torsor to the quotient @xmath .
Recall that the torsors @xmath are trivial when we forget the Galois
action, by 5 . By Remark 8 , then, it suffices to give a
Galois-equivariant isomorphism

  -- -------- --
     @xmath   
  -- -------- --

Olsson’s comparison theorem gives a Galois-equivariant isomorphism

  -- -------- --
     @xmath   
  -- -------- --

We will see that it suffices to provide an isomorphism

  -- -------- --
     @xmath   
  -- -------- --

i.e. a point of @xmath .

By Kneser’s theorem [ 84 , Section 3.1] the Galois cohomology of @xmath
is trivial; because the Galois cohomology of unipotent groups is
trivial, every torsor for @xmath has a point. We conclude that @xmath is
nonempty. We use that point in the second isomorphism of the following
string; every isomorphism that says @xmath is induced by Olsson’s
comparison theorem.

  -- -------- --
     @xmath   
     @xmath   
     @xmath   
  -- -------- --

This isomorphism finishes the proof of the statement for the local
Selmer group, since we see that @xmath is in the Selmer stack. Now the
global statement follows by its definition as fibered product.

∎

###### Remark 12.

In the first part of this proof we are tempted to use the fact that
@xmath is non-empty, i.e. that étale paths always exist [ 87 ,
Proposition 5.5.1] . This path would induce a second path

  -- -------- --
     @xmath   
  -- -------- --

by the comparison isomorphism, thus exhibiting an isomorphism

  -- -------- --
     @xmath   
  -- -------- --

Unfortunately this isomorphism is not Galois-equivariant, since @xmath
likely has a nontrivial Galois action and equivariance of the previous
isomorphism is equivalent to @xmath being fixed by the Galois action.

## Chapter 4 Representability of Cohomology Stacks

The étale realization of the relative completion has furnished us with
an extension of @xmath -groups, defined over @xmath :

  -- -------- --
     @xmath   
  -- -------- --

where @xmath is pro-unipotent, @xmath is reductive, and @xmath is
profinite. The first natural question in the nonabelian arithmetic
philosophy is: What is the structure of @xmath ? In Theorem 4.0.1 we
answer this question from an abstract point of view, assuming only mild
conditions on the objects present. The strategy hinges on the fact that
the stack @xmath fits into a number of nice exact sequences whose terms
are either treated by the work of Pottharst (via the space @xmath ) or
need to be manipulated to look like representation spaces of @xmath
(these pieces come from @xmath .)

See D.4 for the notion of pro-strat-representability.

###### Theorem 4.0.1.

Let

  -- -------- --
     @xmath   
  -- -------- --

be an extension of a reductive group over @xmath by a pro-unipotent
group over @xmath , and suppose that a profinite group @xmath acts
continuously for the @xmath -adic topology on the entire short exact
sequence.

Suppose that a substack @xmath is strat-representable by rigid-analytic
stacks of finite type. Denote by @xmath the fibered product

  -- -------- --
     @xmath   
  -- -------- --

Then the tower of cohomology functors @xmath is pro-strat-representable
in the category of rigid-analytic stacks over @xmath .

###### Remark 13.

The stacks @xmath and @xmath will be a certain substack corresponding to
Galois representations with a fixed Hodge type, Galois type, residual
pseudorepresentation, and weights.

We proceed by induction. By assumption, @xmath is representable in the
category of rigid analytic stacks over @xmath . Suppose that the tower

  -- -------- --
     @xmath   
  -- -------- --

is strat-representable. By definition of strat-representability there
exist finitely many rigid-analytic substacks @xmath such that

  -- -------- --
     @xmath   
  -- -------- --

in the category of stacks in groupoids over @xmath .

Consider the morphism of stacks in groupoids over the site @xmath given
by

  -- -------- --
     @xmath   
  -- -------- --

and its restrictions to

  -- -------- --
     @xmath   
  -- -------- --

###### Lemma 4.0.2.

The image of @xmath is a locally closed rigid-analytic substack of
@xmath .

###### Proof.

For any @xmath -point @xmath , we have that @xmath (the twist is by
conjugation) is a family of Galois representations over @xmath . By
Theorem 3.3.5 , the @xmath -module @xmath is coherent. Choose lifts
@xmath of @xmath to @xmath locally for the Tate topology. Now @xmath is
a section of a coherent sheaf on a rigid affinoid, so we may take its
zero locus. This zero locus does not depend on the choice of the lifts
@xmath , by Serre’s work.

Finally, by functoriality of @xmath , these zero loci glue to a locally
closed substack of @xmath . ∎

We can now demonstrate Theorem 4.0.1 .

###### Proof.

Since @xmath is locally closed, we may replace @xmath with @xmath and it
does not affect strat-representability. Thus we assume that none of the
fibers of @xmath are empty.

We will be done if we can give a stratification @xmath of @xmath such
that

  -- -------- --
     @xmath   
  -- -------- --

is representable by a rigid stack. Now, for @xmath an affinoid @xmath
-algebra, the fiber above any @xmath -torsor @xmath is locally in the
Tate topology given by the stack in groupoids @xmath from Proposition
3.1.4 . Here @xmath is a local lift of @xmath .

Note that @xmath is a family of abelian representations of @xmath over
@xmath . Now the work of Pottharst (Theorem 3.3.5 ) implies that @xmath
is a coherent sheaf over @xmath . By gluing in the Tate topology, the
association

  -- -------- --
     @xmath   
  -- -------- --

is a coherent sheaf on @xmath . We denote it by @xmath to remind us of
the twist that is present.

Let @xmath be a flattening stratification of @xmath , i.e. a
stratification such that the restriction of the sheaf to each stratum is
locally free. (The existence of such a stratification can be argued
using formal models and [ 15 , Corollary 3.7] ). By the finite-type
assumption on the base, this stratification can be taken to be finite.
Now @xmath , being locally free, is thus relatively representable over
@xmath ( D.4.5 .)

Now we deal with the whole quotient. For any @xmath as above, the
functor @xmath is representable by a scheme. Indeed, for any @xmath ,
the fixed points of @xmath form a closed subscheme of @xmath because
@xmath acts by algebraic automorphisms; the entire @xmath is then the
intersection of all of these closed subschemes, which is again a closed
subscheme. This description as the intersection of fixed points (which
are pullbacks) makes it clear that @xmath commutes with arbitrary
pullback along morphisms @xmath , and in particular it commutes with
restriction to admissible affinoid subsets. Therefore, gluing (the
analytifications of) these together in the Tate topology gives us a
rigid group @xmath over @xmath . Now Noetherianness (see, for example, [
81 , Theorem 8.3] ) implies that there is a finite stratification @xmath
of @xmath such that @xmath is flat for all @xmath .

Finally, let @xmath be a common refinement of @xmath and @xmath , and
@xmath . We see that for each @xmath , the stack

  -- -------- --
     @xmath   
  -- -------- --

is a quotient of a rigid analytic space by a flat rigid group. Each such
quotient is representable in the category of rigid-analytic stacks by
D.3.7 , and so the total space

  -- -------- --
     @xmath   
  -- -------- --

is representable by Proposition C.1.17 .

∎

Let us see what it would take to prove the Selmer stack analogue of
Theorem 4.0.1 . Write @xmath for @xmath .

By definition of the Selmer part, we have a morphism of stacks on the
rigid étale site,

  -- -------- --
     @xmath   
  -- -------- --

By assumption the latter stack is strat-representable.

We proceed to fix some @xmath and analyze the diagram of pseudofunctors

  -- -- --
        
  -- -- --

Consider a torsor @xmath . What is the fiber @xmath above @xmath inside
of @xmath ? By using the long exact sequences in cohomology above and
Proposition 3.1.4 this fiber is @xmath in the following diagram.

  -- -- --
        
  -- -- --

where @xmath is an element of the fiber, which locally exists if the
fiber is nonempty.

Applying the exact sequence again, the image of @xmath is isomorphic to

  -- -------- --
     @xmath   
  -- -------- --

which we will see in the next section is representable if @xmath is
crystalline. Now denote by @xmath the image of @xmath in @xmath . We see
that @xmath is a bundle with fiber @xmath over the “intersection”

  -- -------- --
     @xmath   
  -- -------- --

As we see, the representability of @xmath is nearly the question of
whether @xmath forms a coherent sheaf for analytic families of Galois
representations; but we have the intervening intersection, which we
would need to prove representable by a stack.

###### Remark 14.

The reader should note here that the pro-strat-representability of
@xmath when @xmath for @xmath a local field is thus closely related to
the question of whether Bloch–Kato Selmer groups of analytic families of
representations form coherent sheaves. Such a result is not known in the
crystalline case, although the de Rham and Hodge–Tate cases were proven
by Shah [ 85 ] . Pottharst also proves a coherence result for cohomology
of families of @xmath -modules. It might be interesting to impose
ordinarity conditions on the reductive level of the relative completion
and to try to use Pottharst’s result in this case.

## Chapter 5 Cohomology Stacks of Groups with Conjugation Action

### 5.1 Representability of stacks without Selmer conditions

We would now like to prove that suitable substacks of @xmath and @xmath
are strat-representable as rigid-analytic stacks. The easiest situation
is when @xmath is abelian, i.e. @xmath ; then the cohomology set is
representable by a vector space. In any other case, things are more
complicated. Our study is guided by the following theorem of Chenevier.
Let @xmath be the functor which associates to a rigid-analytic space
@xmath the set of locally free @xmath -modules of rank @xmath which are
acted on @xmath -linearly, continuously, and semisimply by @xmath , up
to isomorphism in the usual sense of families of representations.

We remind the reader that a profinite group @xmath satisfies Mazur’s
@xmath condition for a prime @xmath if for every open subgroup @xmath of
finite index in @xmath , @xmath is finite. There are two important
examples of fields which satisfy this finiteness condition: The first is
the absolute Galois group of a @xmath -adic field. The second example is
given by the groups @xmath – here @xmath is any set of primes of a
number field @xmath and @xmath denotes, as usual, the Galois group of
the maximal extension ramified only above @xmath .

###### Theorem 5.1.1.

[ 20 , Theorems A-G] Suppose that @xmath is a profinite group that
satisfies Mazur’s @xmath -condition. Then the functor on rigid analytic
spaces over @xmath given by

  -- -------- --
     @xmath   
  -- -------- --

is representable by a rigid analytic space. Furthermore, that rigid
analytic space is a disjoint union of rigid spaces indexed by the
isomorphism class of the residual representation.

For our purposes, the best way to think of @xmath is as @xmath when the
action of @xmath is trivial. We will end up using closely related
results, but non-semisimple representations abound in the contexts we
care about – for example, even assuming Faltings’ Theorem on
semisimplicity of global Galois representations attached to abelian
varieties, the local restrictions of these global representations will
no longer be semisimple in general. For this purpose we will require a
strengthening of Chenevier’s result by Wang-Erickson. In order to
introduce his result we will need to introduce the concept of a
pseudorepresentation, which plays a key role in the work of both
Chenevier and Wang-Erickson.

###### Definition 5.1.2.

Let @xmath be an @xmath -algebra. A @xmath -dimensional
pseudorepresentation @xmath of @xmath over @xmath is a homogeneous
multiplicative polynomial law

  -- -------- --
     @xmath   
  -- -------- --

i.e. for each @xmath -algebra @xmath a function

  -- -------- --
     @xmath   
  -- -------- --

satisfying

  1  

    @xmath sends 1 to 1, and is multiplicative with respect to the
    multiplication on @xmath .

  2  

    @xmath is homogeneous of degree @xmath for the @xmath -module
    structure on @xmath .

  3  

    @xmath is functorial in @xmath .

###### Remark 15.

We follow Wang-Erickson’s terminology; Chenevier calls these objects
determinants.

If @xmath is a representation then @xmath is a pseudorepresentation of
@xmath over @xmath . If @xmath is algebraically closed, there is a
precise sense in which the pseudorepresentation of a representation
determines the semisimplification of the representation [ 20 , Theorem
A] .

Let @xmath be a residual pseodorepresentation of @xmath , i.e. a
pseudorepresentation of @xmath over @xmath . Chenevier proves that
formal deformations of that pseudorepresentation are parameterized by a
universal deformation ring @xmath [ 20 , Proposition E] . The more
general statement, proved by Wang-Erickson [ 92 , Theorem A] , is as
follows.

In the following statement, we let @xmath denote any quotient of a ring
of the form @xmath , where @xmath and @xmath are arbitrary and finite.

###### Theorem 5.1.3.

Denote by @xmath the groupoid which attaches to any @xmath as above the
category of locally free @xmath -modules @xmath equipped with a
continuous linear action @xmath having residual pseudorepresentation
@xmath . If @xmath satisfies Mazur’s finiteness condition @xmath , then
@xmath is Noetherian and

  -- -------- --
     @xmath   
  -- -------- --

is a formally finite type @xmath -formal algebraic stack.

###### Remark 16.

In particular, the rigid generic fiber of @xmath is thus a rigid stack
over @xmath by our earlier discussions; see also [ 91 ] for further work
on analytification.

In fact, @xmath . This follows by applying Proposition D.3.6 with @xmath
with trivial @xmath -action.

###### Remark 17.

We have used the notation @xmath here to denote the formal version of
the representation stack, which differs from Wang–Erickson’s notation.
We do this so that we can call its generic fiber, which we use much
more, @xmath .

Now denote by @xmath the full groupoid of representations without any
residual condition. Since the moduli space of all pseudorepresentations
is a disjoint union of spaces labeled by residual type, Wang-Erickson’s
result implies that @xmath is similarly a disjoint union of formal
stacks labeled by residual pseudorepresentation.

We are now ready to prove the main result of this section.

###### Definition 5.1.4.

We say that a topological group @xmath has a liftable conjugation action
on a linear algebraic group @xmath if @xmath acts continuously on @xmath
and there is a faithful representation @xmath and a homomorphism @xmath
such that the action is given by conjugation by @xmath . (Note that we
use the convention @xmath for conjugation.)

###### Theorem 5.1.5.

Suppose that @xmath has a liftable conjugation action on a linear rigid
analytic group @xmath , where @xmath is a @xmath -adic field and @xmath
satisfies Mazur’s @xmath finiteness condition. Then the cohomology
functor @xmath is representable by a rigid analytic stack.

###### Remark 18.

In the case that we are interested in – namely when @xmath is the
geometric monodromy of a local system and Galois acts by inner
automorphisms, the map to inner automorphisms lifts from a projective
representation to a linear representation by a choice of basepoint.
Indeed, the Galois action on the arithmetic fundamental group arises
from conjugating an automorphism of the fiber of a local system by the
Galois action on the fiber. Since the Galois action on the fiber of any
local system is an honest representation, the Galois action on the
geometric monodromy group is indeed a liftable conjugation action.

If @xmath is @xmath then any conjugation action has a lifting @xmath for
some @xmath , by a deep theorem of Patrikis ( [ 76 ] ). However, we
needn’t use his theorem: as we have mentioned, in our situation @xmath
will already come with a lift.

###### Proof.

Consider the embedding of @xmath in @xmath that defines the conjugation
action of @xmath . Denote the map defining the conjugation action by
@xmath . The simple but key construction is as follows: the assignment

  -- -------- --
     @xmath   
  -- -------- --

induces a bijection

  -- -------- --
     @xmath   
  -- -------- --

Here @xmath refers to @xmath equipped with the conjugation action given
by @xmath . One can think of this map as untwisting the action @xmath .

What of the quotient stack @xmath itself, then? The action of @xmath on
@xmath in the case of inner action is just the change of basis on the
@xmath side of the bijection, so cohomologous cocycles give equivalent
representations and vice-versa. We now conclude by appealing to
Wang-Erickson’s theorem above: the moduli of representations @xmath is
representable by a disjoint union of rigid stacks. Thus so is the
cohomology functor @xmath .

Now we transfer this knowledge to @xmath using the long exact sequence
in Galois cohomology for non-normal subgroups. We denote by @xmath the
group @xmath with conjugation action by @xmath , and consider the map

  -- -------- --
     @xmath   
  -- -------- --

Let @xmath be an affinoid algebra. By twisting, if @xmath then the fiber
of @xmath above @xmath is locally given by

  -- -------- --
     @xmath   
  -- -------- --

where @xmath is a local lift. Now @xmath depends only on @xmath and not
@xmath ; in other words, there is a family over @xmath which we can
denote @xmath that assigns to any morphism @xmath the pullback @xmath .

This pullback is representable by a scheme over @xmath , since the fixed
points are the intersection of fixed points over all @xmath , each of
which is a closed subscheme of @xmath . Thus @xmath is representable
rigid varieties over the whole of @xmath . Let @xmath be a flattening
stratification for the family

  -- -------- --
     @xmath   
  -- -------- --

To show strat-representability, we show representability of the stack
@xmath . Let @xmath be a point of this stack, and again @xmath its image
in @xmath . We claim that stack @xmath is representable. Indeed, the
quotient @xmath is representable by a scheme over the affinoid @xmath .
By the same argument on fixed points, @xmath is representable by a
closed subscheme of @xmath .

Since the quotient

  -- -------- --
     @xmath   
  -- -------- --

is a quotient of a scheme over @xmath by a flat group scheme, its
analytification is representable by a rigid stack over @xmath (Lemma
D.3.7 .)

In particular, the map

  -- -------- --
     @xmath   
  -- -------- --

satisfies the conditions of Proposition C.1.17 , and we conclude that
@xmath is strat-representable by a rigid-analytic stack.

∎

###### Remark 19.

Let us remark on another direction we could have taken above.
Conjugation by @xmath preserves @xmath by hypothesis, and so @xmath
takes values in the normalizer @xmath . We can then play the same game
as above, and make the following sketchy heuristic. When analyzing the
map on first cohomology groupoids we encounter the fiber @xmath ; if we
were working with schemes over an algebraically closed field, then we
would have the classic statement that @xmath is finite. Intuitively,
@xmath differs from @xmath by at most @xmath plus a finite defect.

###### Example 5.1.6.

Finally, let us take a moment to understand what this “unwinding” is
doing in the geometric situation of étale path torsors. So we now let
@xmath be the geometric monodromy of our local system @xmath on the
scheme @xmath . If @xmath then we have the right torsor @xmath for
@xmath on which @xmath acts by conjugation by the Galois representations
on the fibers above @xmath and @xmath , denoted @xmath and @xmath . We
get a cocycle by choosing a path @xmath (this can always be done 5 ), as
follows. Since @xmath is a quotient of @xmath , we have a map @xmath .
Using this homomorphism to act on the target, one defines a cocycle
@xmath that for any element @xmath produces the element

  -- -------- --
     @xmath   
  -- -------- --

One easily checks that @xmath is indeed a cocycle with the conjugation
action:

  -- -------- -- -------
     @xmath      (5.1)
     @xmath      (5.2)
     @xmath      (5.3)
  -- -------- -- -------

Thus

  -- -------- --
     @xmath   
  -- -------- --

i.e. it records the representation @xmath up to a change of basis.

### 5.2 Selmer stacks of groups with conjugation action

In this subsection we show that the “reductive level” of the Bloch-Kato
cohomology stack defined in Definition 3.3.10 is strat-representable by
a rigid stack. To this end we will use a second theorem of Wang-Erickson
(inspired by similar theorems of Kisin) that treats the functor
parameterizing crystalline representations.

Our first result is that the “untwisting” procedure from this section
preserves the property of being crystalline.

###### Proposition 5.2.1.

Let @xmath be a crystalline representation, and @xmath the group with
conjugation action given by @xmath . Then the isomorphism of stacks

  -- -------- --
     @xmath   
  -- -------- --

given by untwisting, restricts to an isomorphism

  -- -------- --
     @xmath   
  -- -------- --

###### Proof.

We work locally. Suppose that a cohomology class @xmath is crystalline,
where @xmath . Then there exists @xmath such that

  -- -------- --
     @xmath   
  -- -------- --

(Recall that the definition of the Galois action on @xmath includes the
Galois action on @xmath .) The untwisting sends this cocycle to

  -- -------- --
     @xmath   
  -- -------- --

so that @xmath has a @xmath -linear and Galois-equivariant change of
basis that makes it isomorphic to @xmath . Denote the underlying family
of representations of @xmath by @xmath , and that of @xmath by @xmath .
Restating the above, we have a Galois-equivariant isomorphism

  -- -------- --
     @xmath   
  -- -------- --

so that their rings of @xmath -invariants are equal. But @xmath , so we
conclude from the crystallinity of @xmath that @xmath is crystalline. ∎

Thus knowing about the Bloch-Kato sets discussed above is almost
equivalent to knowing about representation stacks. Now to show that the
stack of crystalline representations is representable by a formal stack
we use a theory of Wang-Erickson’s that cuts out a crystalline locus.

We must first define the concept of a Galois type, which is more
complicated than what we will need: see [ 65 , Section 2.7] for a
complete description. In short, to a potentially semi-stable
representation @xmath one associates a representation @xmath , where
@xmath is a finite étale @xmath -algebra, @xmath is a free @xmath
-algebra, and @xmath is the inertia subgroup of @xmath . Now if

  -- -------- --
     @xmath   
  -- -------- --

is any representation with open kernel, we say that @xmath is of Galois
type @xmath if for all @xmath we have

  -- -------- --
     @xmath   
  -- -------- --

Galois type measures how potentially semistable or potentially
crystalline a representation is. Since any representation that we will
care about will be crystalline over the base field (and not simply
potentially so), the reader is welcome to mentally set @xmath and drop
it from our notation.

Here is the theorem that we will need.

###### Theorem 5.2.2.

[ 92 , Theorem B] Let @xmath and @xmath be fixed Galois and Hodge types.
There exists a closed formal substack @xmath such that for any finite
@xmath -algebra @xmath and point @xmath , @xmath factors through @xmath
if and only if the corresponding representation @xmath of @xmath is
potentially semi-stable of Galois and Hodge type @xmath Moreover,

  (1)  

    @xmath is reduced, locally complete intersection, equi-dimensional,
    and generically formally smooth over @xmath . If we replace
    “semi-stable” with “crystalline,” it is everywhere formally smooth
    over @xmath .

  (2)  

     If @xmath is multiplicity-free, then @xmath is algebraizable, i.e.
    @xmath is the completion of a closed substack @xmath of @xmath . The
    geometric properties of (1) also apply to @xmath , except
    equi-dimensionality, which applies to its framed version @xmath

###### Remark 20.

Let @xmath denote the substack referred to in (1) above. In other words,
it is the substack of representations which are crystalline of a fixed
Hodge type at all residue fields. Its rigid generic fiber is the stack
of crystalline representations of a fixed Hodge type of 3.3.6 :

This follows because the stack of representations which are crystalline
and of a fixed Hodge type (in the sense of Wang–Erickson) at all closed
points is reduced, by the above; the theorem of Berger–Colmez ( 3.3.7 )
says that over reduced affinoid algebras, a family is crystalline at
every point if and only if it is crystalline as a family.

Let us now return to local cohomology stacks, where transferring
representability from (some substacks of) @xmath to @xmath will look
very similar to the last section. Taking the preimage of @xmath under
the equivalence

  -- -------- --
     @xmath   
  -- -------- --

we obtain stacks which we denote @xmath Let @xmath denote the 2-fibered
product of the two maps

  -- -------- --
     @xmath   
  -- -------- --

and

  -- -------- --
     @xmath   
  -- -------- --

We will need one more piece of @xmath -adic Hodge theory, which Kim
proves over a field [ 62 , discussion before Proposition 2] . Let @xmath
be a @xmath -adic field, and @xmath its maximal unramified subfield.

###### Lemma 5.2.3.

Let @xmath be an affinoid @xmath -algebra and @xmath an algebraic group
over @xmath on which @xmath acts continuously such that @xmath is an
ind-crystalline family of Galois representations over @xmath . Then for
any affinoid @xmath -algebra @xmath ,

  -- -------- --
     @xmath   
  -- -------- --

###### Proof.

By definition of the Galois action on @xmath , we have

  -- -------- --
     @xmath   
     @xmath   
     @xmath   
     @xmath   
     @xmath   
     @xmath   
     @xmath   
  -- -------- --

Here @xmath denotes algebra homomorphisms, the @xmath subscript denotes
@xmath -equivariance, and @xmath subscript denotes linearity in that
ring. ∎

Now by the monoidal property of @xmath and functoriality, @xmath is a
group scheme over @xmath . We conclude that the functor @xmath on @xmath
-algebras is representable by a scheme over @xmath .

Finally we can prove:

###### Proposition 5.2.4.

The restricted Selmer stack @xmath is strat-representable in the
category of rigid stacks.

###### Proof.

Let us reason as in the arguments of Theorem 4.0.1 .

The fibers of the map

  -- -------- --
     @xmath   
  -- -------- --

are the same as the fibers of

  -- -------- --
     @xmath   
  -- -------- --

We take the long exact sequence of a non-normal subgroup:

  -- -- --
        
  -- -- --

which maps to

  -- -- --
        
  -- -- --

For @xmath an affinoid algebra, let @xmath . Locally on @xmath , take a
lift @xmath . Then the exact sequences tell us that fiber above @xmath
is locally @xmath , where @xmath and @xmath are

  -- -- --
        
  -- -- --

Again by the short exact sequence,

  -- -------- --
     @xmath   
  -- -------- --

Let us show that this stack is representable.

Since @xmath is crystalline ( @xmath ), so is @xmath ; this is because
the latter ring is the colimit @xmath , where @xmath has the tensor
product action of @xmath and @xmath runs over all irreducible
representations of @xmath .

By the lemma immediately preceding this proposition, we see that @xmath
is representable by the scheme @xmath . Now @xmath is a quotient of
@xmath as a Galois representation. Closure of (ind-)crystallinity under
quotients (over affinoid algebras) shows that @xmath is also
representable by a scheme over @xmath .

We may analyze the lower right pseudofunctor similarly. The homogeneous
space @xmath is affine because @xmath is reductive ( [ 2 , Theorem
12.15] ). Since the morphism

  -- -------- --
     @xmath   
  -- -------- --

surjective, we have an injection of coordinate rings @xmath . The
codomain is crystalline, and so closure of crystalline representations
under subobjects over reduced affinoid algebras shows that @xmath is
crystalline, and thus @xmath is also representable by @xmath . Since the
whole span consists of rigid stacks, we see that the fibered product

  -- -- --
        
  -- -- --

exists as a rigid stack, which is what we wanted.

The arguments of Theorem 4.0.1 go through unchanged for the piece of the
span

  -- -------- --
     @xmath   
  -- -------- --

Namely, there is a stratification of @xmath over which @xmath is flat
and of finite presentation, and similarly for @xmath . Taking the fiber
product of the span above, we see that @xmath is indeed
strat-representable. ∎

The definition of the global Selmer stack as a fibered product makes it
clear that the global substacks mapping to the local Selmer stacks of
fixed Galois and Hodge types are strat-representable if the local ones
are.

## Chapter 6 de Rham and Crystalline Realizations; @xmath-adic Period
Mappings

### 6.1 Hodge theory

We will now discuss Hain’s mixed Hodge structure on the relative
completion of the fundamental group of a complex algebraic variety with
respect to a polarized variation of Hodge structures. For the remainder
of this section we will follow Hain’s notation. To that end, let @xmath
be a smooth complex algebraic variety with basepoint @xmath . Let @xmath
be a polarized variation of Hodge structure on @xmath , with @xmath the
fiber of @xmath above @xmath , and write @xmath for the Zariski closure
of the monodromy of @xmath . The monodromy is a subgroup of the
symplectic or orthogonal group on @xmath arising from the polarization
on @xmath . We write @xmath for the necessarily Zariski-dense monodromy
representation. Finally, denote the relative completion of the Betti
fundamental group @xmath with respect to @xmath by @xmath .

There is a right flat principal @xmath bundle @xmath over @xmath which
is associated in the usual way to the action of right multiplication of
@xmath on @xmath via @xmath . More precisely, if @xmath is the universal
cover of @xmath then @xmath , where @xmath sends @xmath to @xmath . We
will also need the fiber bundle associated to this principal bundle
through the right action of @xmath on @xmath : @xmath . This bundle is
then defined by the similar formula

  -- -------- --
     @xmath   
  -- -------- --

It has fibers which are non-canonically isomorphic to @xmath . In fact,
the first key fact is that one has a canonical Hodge structure of weight
zero on the algebra @xmath , which induces a Hodge structure of weight
zero on the variation @xmath . We explain the proof.

###### Proposition 6.1.1.

[ 50 , Corollary 13.7] Suppose that @xmath is the whole of the group
@xmath , i.e. the entire symplectic or orthogonal group. Then there is a
pure Hodge structure of weight zero on @xmath , and it induces a Hodge
structure of weight zero on the variation @xmath .

###### Proof.

The Hodge structure on @xmath falls out from a structure theorem for
@xmath as follows. Let @xmath be a set of representatives for the
isomorphism classes of all irreducible representations of @xmath . The
structure theorem then says that

  -- -------- --
     @xmath   
  -- -------- --

as an @xmath bimodule. One proves that each irreducible representation
comes from a variation of Hodge structure on @xmath , and thus carries a
Hodge structure. (Indeed, a construction due to Weyl that is used to
construct all irreducible representations of @xmath from the fundamental
representation actually preserves the property of coming from a local
system – see Hain’s proposition for more details.) Now tensoring each
representation and its dual gives a Hodge structure of weight zero on
their tensor product, and their sum thus has a Hodge structure.

Now

  -- -------- --
     @xmath   
  -- -------- --

From this decomposition we obtain the Hodge structure on the variation
@xmath , since each irreducible representation comes from a variation of
Hodge structure @xmath . ∎

Before we place a mixed Hodge structure on the coordinate ring of the
entire relative completion, we show how the previous argument
generalizes to “neat” @xmath , which we define before stating the
theorem.

###### Definition 6.1.2.

Let @xmath be a variation of Hodge structure over @xmath , a complement
of a normal crossings divisor in a compact Kahler manifold. We say that
@xmath is neat if it has semi-simple monodromy and if the Hodge
structure on the coordinate ring of @xmath induces one on @xmath .

We can answer a question raised by Hain [ 50 , top of p.85] .

###### Proposition 6.1.3.

In fact, any polarizable variation of Hodge structure is neat.

###### Proof.

Because of the description of the coordinate ring of @xmath in terms of
irreducible representations of @xmath , it suffices to show that any
representation of @xmath has an induced Hodge structure. Now, indeed,
any such representation is a subquotient of a tensor power of V and its
dual. Furthermore, since @xmath is reductive, it suffices to consider
only subbundles of these tensor powers. But Deligne’s semisimplicity
theorem [ 29 , Corollaire 4.2.9] says that every subbundle of a
polarizable VHS has an induced VHS. ∎

Note that our notations differ slightly from those of Hain here: for him
@xmath always means the symplectic/orthogonal group above, while @xmath
for us is the (potentially smaller) algebraic monodromy group. We may
now proceed to the main theorem.

###### Theorem 6.1.4.

[ 50 , Thm. 13.1] With the notation of the previous definition, assume
that @xmath is neat. Then the coordinate ring @xmath has a canonical
real mixed Hodge structure with weights @xmath for which the product,
coproduct, antipode and the natural inclusion

  -- -------- --
     @xmath   
  -- -------- --

are all morphisms of mixed Hodge structure. Moreover the canonical
homomorphism @xmath induces an isomorphism @xmath .

The proof of such theorems all follow the path set out by Chen [ 19 ] :
mixed Hodge structures arise from comparison theorems with bar complexes
of differentials. We will need this explicit description of @xmath .

###### Definition 6.1.5.

Call a local system @xmath on @xmath rational if it arises from a
rational representation of @xmath via the composition @xmath . (Here
rational representation is used the sense of algebraic groups.)

The equation @xmath tells us that the representation @xmath is the
direct limit of its finite-dimensional representations, and so we can
reasonably define differential forms with values in in @xmath using
forms with values in its finite-dimensional bundles.

###### Definition 6.1.6.

Let @xmath denote the smooth de Rham complex of @xmath forms on @xmath
with coefficients in a finite-dimensional flat vector bundle @xmath (we
wrote this @xmath above.) Then for @xmath , a possible
infinite-dimensional flat vector bundle, we define a new complex

  -- -------- --
     @xmath   
  -- -------- --

where @xmath runs over the set of rational sub-local systems of @xmath .

The reader should refer to [ 50 , Section 7] for a precise description
of the relations and differentials in the bar construction, since we do
not use it in depth here. Suffice it to say that if @xmath is a
differential graded algebra with non-negative grading and @xmath are
modules over @xmath , then the reduced bar construction

  -- -------- --
     @xmath   
  -- -------- --

is a differential graded algebra which is a quotient of

  -- -------- --
     @xmath   
  -- -------- --

The element

  -- -------- --
     @xmath   
  -- -------- --

is traditionally denoted @xmath , or in [ 50 ] by @xmath .

Now we are concerned with two augmentations:

  -- -------- --
     @xmath   
  -- -------- --

is defined locally by evaluating a differential form @xmath ( @xmath )
at the basepoint @xmath and the identity element of @xmath , while the
augmentation

  -- -------- --
     @xmath   
  -- -------- --

only evaluates the differential form at the basepoint. Using these
augmentations we see @xmath and @xmath as @xmath -algebras.

###### Definition 6.1.7.

We define

  -- -------- --
     @xmath   
  -- -------- --

and

  -- -------- --
     @xmath   
  -- -------- --

In fact, @xmath is pro-unipotent [ 50 , Prop 8.3] , which allows one to
compare it to the relative completion using the universal property of
the latter.

An essential ingredient to all that follows is that @xmath is a mixed
Hodge complex in the sense of Saito, and so the coordinate rings of
@xmath and @xmath inherit mixed Hodge structures [ 48 , 3.2.1] .

We are ready to give the comparison map

  -- -------- --
     @xmath   
  -- -------- --

It arises from the following relative iterated integral map.

###### Definition 6.1.8.

For @xmath and @xmath , we define

  -- -------- --
     @xmath   
  -- -------- --

by

  -- -------- --
     @xmath   
  -- -------- --

Here @xmath is the unique lift of @xmath which begins at the canonical
basepoint @xmath above @xmath . This integral induces the map

  -- -------- --
     @xmath   
  -- -------- --

(because the @xmath picks out homotopy invariant iterated integrals).

An entirely analogous statement holds for the entire path groupoid [ 50
, Section 12] .

The above iterated integral refers to Chen’s usual iterated integrals,
with the only difference being that one performs the iterated integral
on the bundle @xmath via the lifted path @xmath . Indeed, Hain shows
that pullback of forms from @xmath to @xmath is an injection (actually,
the pulled back forms take values in a foliation related to @xmath .)
Then, as in the unipotent case, one pulls back the differential @xmath
to @xmath via the path @xmath . There @xmath is a differential form with
values in @xmath , and it can be integrated in the usual sense to a real
number.

###### Remark 21.

One is tempted to think of these integrals as detecting the (Malcev
unipotent completion of the) fundamental group of the cover defined by
@xmath . The reductive information is captured, on the other hand, by
the @xmath term. However, this intuition is usually incorrect. For
example, the case of the moduli space of elliptic curves is exceedingly
interesting and has been studied by Hain, Brown, and others. In that
case @xmath is @xmath , so that the kernel is trivial and the associated
cover is the universal cover of @xmath . Despite the above intuition
indicating that the relative completion should be trivial, then, it
turns out that the relative completion detects modular forms! A
motivically-tailored reference for this story is [ 17 ] .

We also mention that these iterated integrals satisfy familiar-looking
shuffle and antipode relations, for which the reader may consult Hain’s
work.

Let @xmath denote the relative completion of @xmath with respect to
@xmath . The universal property of the relative completion (using [ 50 ,
Prop. 8.3] ) ensures that there is an induced map @xmath . The main
theorem, now, is the comparison theorem which says that relative
iterated integrals can detect the entire relative completion of the
fundamental group.

###### Theorem 6.1.9.

The map @xmath is an isomorphism of pro-algebraic groups which commutes
with the projections to @xmath .

Let us give a brief sketch of the proof. In addition to the map @xmath ,
one constructs a map @xmath . The idea is that the monodromy of any
vector bundle in @xmath is given by the iterated integrals above
including the monodromy of the universal bundle @xmath . In other words,
the map @xmath has a factorization

  -- -------- --
     @xmath   
  -- -------- --

Now a crucial algebraic step is that the two maps between @xmath and
@xmath end up being inverses if the induced map

  -- -------- --
     @xmath   
  -- -------- --

is an isomorphism. Last but not least, this isomorphism reduces to one
core geometric fact: for any irreducible @xmath -representation @xmath ,
the two groups

  -- -------- --
     @xmath   
  -- -------- --

and

  -- -------- --
     @xmath   
  -- -------- --

are both isomorphic to @xmath , where @xmath is the vector bundle
associated to @xmath . This fact follows from the same
Lyndon–Hochshild–Serre arguments from Section 3.1.

The proof affirms the philosophy: relative completions of fundamental
groups are ways of recording the cohomologies of certain vector bundles,
local systems, and isocrystals in an @xmath -equivariant way. Thus any
comparison isomorphism between them will ultimately be a comparison
between these cohomologies.

### 6.2 Frobenius weights

Having discussed the Hodge structure on the relatively unipotent de Rham
fundamental group, we pivot to its Frobenius structure. The work of
Olsson in [ 75 ] places such a Frobenius structure on the relative
completion. Let us review a few concepts from this crystalline theory;
recall that @xmath is a finite field, and fix an embedding @xmath .

###### Definition 6.2.1.

A @xmath -module @xmath over @xmath is a @xmath -vector space with an
additive map @xmath that is semi-linear with respect to the Frobenius
action on @xmath : @xmath . (We use the same notation for both
Frobenii.)

A @xmath equipped with the datum of a decreasing and exhaustive
filtration after extension to some totally ramified extension @xmath is
called a filtered @xmath -module over @xmath .

A @xmath -module is called an isocrystal if @xmath is a bijection, and a
filtered isocrystal is an isocrystal that is a filtered @xmath -module.

The preceding categories will be denoted @xmath , @xmath , @xmath , and
@xmath .

###### Definition 6.2.2.

Let @xmath , and suppose that @xmath is a power of the endomorphism of
@xmath that is linear. (It suffices to take @xmath .) Then we say that
@xmath has weights @xmath if every eigenvalue of @xmath has (after
embedding it into @xmath ) complex norm @xmath for @xmath . We say that
a pro-isocrystal has negative weights if its finite-dimensional
quotients do.

In fact, starting with a smooth scheme @xmath over @xmath , one has an
entire category of @xmath -isocrystals over @xmath with values in @xmath
. We avoid a full discussion of isocrystals here; cf. [ 9 ] . Since
@xmath is finite, the category of @xmath -isocrystals is indeed a
neutral Tannakian category once we fix a basepoint @xmath . We denote
its fundamental group by @xmath . Any one of the previous variations on
this group are fair game now: for example, the unipotent crystalline
fundamental group and the relatively unipotent fundamental group with
respect to an @xmath -isocrystal on @xmath . Then, by the theory of
geometry in a Tannakian category, the associated affine ring @xmath is a
“ring in isocrystals;” since isocrystals come with a Frobenius
endomorphism, the affine ring and thus the various crystalline
fundamental groups inherit a Frobenius endomorphism.

Now suppose that @xmath has a smooth lift @xmath for @xmath . We fix a
vector bundle @xmath with integrable connection on @xmath , and denote
the associated @xmath -isocrystal on @xmath by @xmath . Finally, we
write @xmath for the Tannakian fundamental group of @xmath Then we have
the following comparison isomorphism, which is implicit in Olsson’s work
[ 75 , 4.13] and which we recall in Section 6.3 .

###### Proposition 6.2.3.

There is a canonical isomorphism

  -- -------- --
     @xmath   
  -- -------- --

which induces a Frobenius action on the relative de Rham fundamental
group.

Olsson and Pridham describe the action of Frobenius on @xmath by
relating this group to cohomology of isocrystals in @xmath . For
example, let @xmath be the unipotent radical of this relative
crystalline fundamental group and @xmath its Lie algebra, which is a
pro-Lie algebra in isocrystals. Then we have the following statement
about Frobenius weights ( [ 80 ] , which is [ 74 , Theorem 4.2] for the
mixed case.)

###### Proposition 6.2.4.

The Lie algebra @xmath has Frobenius weights at most -1.

###### Proof.

Let @xmath denote a smooth compactification.

The cohomology group @xmath has Frobenius weights @xmath (See, for
example, [ 1 ] .) There is a Frobenius-equivariant identification @xmath
by [ 80 , proof of Theorem 3.8] , and thus a natural surjection @xmath .
This surjection has a splitting that preserves generalized Frobenius
eigenspaces [ 74 , 4.7] .

By universality, the splitting @xmath extends in a Frobenius-equivariant
way to the free Lie algebra @xmath . In particular, from the negative
weight of @xmath we see that @xmath has only negative Frobenius weights.
∎

###### Remark 22.

The reader should be reminded of Hain’s statement that @xmath has
negative weights in the sense of mixed Hodge theory. The proof there
proceeds in essentially the same way, namely by comparing @xmath to the
cohomology of @xmath with values in the bundle @xmath .

#### 6.2.1 Why do Frobenius weights matter?

We begin in this subsection to generalize Besser’s notion of Tannakian
Coleman integration to the relatively unipotent case.

###### Remark 23.

The concrete consequence of our work in this subsection is that the de
Rham moduli space is much larger than it first appears, as we will see.
But first, a remark on why (Tannakian) Coleman integration is important.

From the perspective of the author, giving Frobenius-invariant analytic
continuations of the integrals appearing in the relative completion will
make the first inroads to globalizing the method of Lawrence and
Venkatesh. Because Gauss–Manin only converges in residue discs, Lawrence
and Venkatesh are forced to work residue disc by residue disc; their
method is thus sensitive to the number of residue discs. But if the
smallest prime of good reduction for @xmath is large (and they do their
analysis with a prime of good reduction), then the Weil conjectures say
that the number of residue tubes will also be large. If we hope to
eliminate dependence on the size of the smallest prime of good reduction
(or, more generally, if we would like to prove estimates of @xmath that
are uniform in some sense) then we require global functions which vanish
on rational points. See [ 56 ] for a great example of this philosophy.
Even if one would like to bound just the number of rational points on a
single residue disc, such bounds usually come from global constraints
such as Riemann-Roch [ 22 ] .

Let us recall Besser’s reformulation of Coleman integration with an eye
towards adapting it to the relative setting. Recall that @xmath denotes
the unipotent crystalline fundamental group; for @xmath and their
associated fiber functors @xmath in the category of unipotent
isocrystals on @xmath , the torsor @xmath is a scheme in isocrystals and
has a Frobenius-equivariant right action of @xmath .

###### Theorem 6.2.5.

[ 10 , Corollary 3.2]

Let @xmath be a smooth scheme, and @xmath . The unipotent crystalline
path torsor @xmath has a unique Frobenius-invariant trivialization

  -- -------- --
     @xmath   
  -- -------- --

We have the following theorem in our case.

###### Theorem 6.2.6.

Let @xmath be a smooth scheme, and @xmath the unipotent radical of the
relatively unipotent fundamental group with respect to an isocrystal
@xmath . Suppose, as always, that the Tannakian fundamental group of
@xmath is reductive. Then any @xmath -equivariant torsor @xmath for
@xmath has a unique Frobenius-invariant trivialization

  -- -------- --
     @xmath   
  -- -------- --

In particular, @xmath is trivial.

###### Proof.

Besser’s proof works verbatim for the negatively-weight unipotent group
@xmath ; it is entirely group-theoretical, given the knowledge of the
weights of Frobenius on @xmath .

Indeed, consider the Lang map, which is a map from @xmath to itself
defined on @xmath -points by

  -- -------- --
     @xmath   
  -- -------- --

It is an easy bit of algebra to show that if the Lang map is an
isomorphism then any torsor for @xmath has a unique Frobenius-invariant
trivialization, and this algebraic factoid holds for any @xmath
-equivariant torsor for any pro-algebraic group [ 10 , Corollary 3.2] .

The deep part is the bijectivity of the Lang map, but again this
bijectivity follows from the negativity of the weights of Frobenius on
@xmath [ 10 , proof of Theorem 3.1] .

∎

The problem with this formulation is that @xmath -torsors do not appear
in nature; rational points naturally give torsors for the whole of
@xmath . The most natural formulation of “relative Coleman integration
in the style of Besser” will be presented in Proposition 6.4.7 , once we
have developed a theory of admissible de Rham torsors.

### 6.3 From crystalline to dR to Hodge

One would like to use this sequence of theorems to put a Hodge
filtration and Frobenius structure on the de Rham fundamental group
unipotent relative to a given vector bundle. In the unipotent case,
these structures arise because of the isomorphisms relating @xmath ,
@xmath , and @xmath . In the relatively unipotent case, things get more
complicated.

Let us first discuss comparisons for the reductive quotient @xmath in
each realization. Once we have these comparisons we will show how the
comparison for @xmath follows. The story for @xmath has two fundamental
ingredients: the transition from crystalline to @xmath -adic de Rham and
then the comparison from there to complex de Rham.

Indeed, suppose that @xmath is a vector bundle with integrable
connection on @xmath and that @xmath is a polarized variation of Hodge
structures on @xmath such that

  -- -------- --
     @xmath   
  -- -------- --

Here we have fixed an embedding of @xmath into @xmath , and @xmath is
the pullback of @xmath to @xmath . This assumption will hold when the
vector bundles in question come from the Gauss–Manin connection of a
smooth and proper morphism, by flat base change. We can always
base-change a @xmath -vector bundle to a @xmath -vector bundle, which
furnishes a map

  -- -------- --
     @xmath   
  -- -------- --

and a similar map for @xmath .

The following result relates the @xmath -adic de Rham and complex de
Rham monodromy of our bundle.

###### Proposition 6.3.1.

[ 59 , Proposition 1.3.2] , (due to O. Gabber) We have an isomorphism

  -- -------- --
     @xmath   
  -- -------- --

An interested reader can see this result applied to independence-of-
@xmath in [ 27 , Theorem 4.2] .

We then come to the crystalline vs. @xmath -adic de Rham story for
@xmath .

###### Proposition 6.3.2.

[ 75 , Lemma 4.16, Section 4.12]

If @xmath and @xmath both have nilpotent local monodromy, then we have
an isomorphism @xmath .

#### 6.3.1 Moving to @xmath

Suppose we have an isomorphism on the reductive parts of crystalline and
complex realizations of the relative completion as above, for example in
the Gauss–Manin case. (Abstractly, we can just assume reductivity and
nilpotent local monodromy.) Then this isomorphism extends to @xmath and
the whole of @xmath as follows.

###### Proposition 6.3.3.

Preserve the notations of the last subsection. We have isomorphisms
@xmath and @xmath .

###### Proof.

Pridham’s Adams spectral sequence [ 80 , Proposition 1.12] implies that
@xmath depends only on @xmath and @xmath and spectral sequence and cup
product maps between these groups in each realization. Here @xmath is an
embedding into a proper scheme with normal crossing complement. But by
flat base change and the crystalline-de Rham comparison theorem with
coefficients [ 75 , 4.13.1] , we obtain isomorphisms

  -- -------- --
     @xmath   
  -- -------- --

  -- -------- --
     @xmath   
  -- -------- --

and similarly for @xmath .

Furthermore, these comparisons respect the Adams and Leray spectral
sequences. We conclude that @xmath and @xmath . Furthemore, since these
comparisons are equivariant for the @xmath -action on @xmath , they
extend to comparisons of @xmath and the complex and @xmath -adic @xmath
. ∎

### 6.4 de Rham torsor spaces

We take this section to generalize Kim’s study of the homogeneous space

  -- -------- --
     @xmath   
  -- -------- --

We also connect it with the usual theory of period maps and flag
varieties due to Griffiths [ 40 ] . The observations in this chapter
cement the ties between the Tannakian approach of Kim and the flag
variety-theoretic approach of Lawrence and Venkatesh, and provide a
basis for generalizing Tannakian Coleman integration, cf. Proposition
6.4.7 . Since all realizations will be de Rham for this section, we
often write @xmath for @xmath , etc.

###### Definition 6.4.1.

Let @xmath be a group in filtered @xmath -modules over @xmath , i.e.
whose coordinate ring is a filtered @xmath -module over @xmath and whose
comultiplication and counit morphisms are morphisms of filtered @xmath
-modules. Let @xmath be a scheme over @xmath , and give @xmath the
trivial filtration and Frobenius induced by the Frobenius action on
@xmath .

We call @xmath a torsor for @xmath if it is a torsor in the category of
schemes, and if @xmath is a scheme in filtered @xmath -modules over
@xmath and the coaction map is a map of filtered @xmath -modules.

#### 6.4.1 A new definition for admissible torsors

First, let us recall why we care about the homogeneous space @xmath .
For this, we have the following result of Kim in the unipotent case.
Recall that, when @xmath is a unipotent group in the category of
filtered @xmath -modules, Kim calls a @xmath -torsor @xmath admissible
if it has a Frobenius-invariant trivialization, and if @xmath has some
trivialization as a @xmath -torsor. (We do not require any compatibility
between the two trivializations, but isomorphisms between admissible
torsors do have to be compatible with Hodge filtrations and Frobenius
actions.) The following proposition [ 63 , Proposition 1] gives a
moduli-theoretic interpretation of the above homogeneous space. Recall
that the Lang map on a group functor with a self-map @xmath is the map
@xmath . If @xmath is an automorphism of the coordinate ring of @xmath ,
the Lang map on @xmath is the one induced by @xmath by pullback.

###### Proposition 6.4.2.

Let @xmath be a pro-unipotent group in the category of filtered @xmath
-modules over @xmath such that @xmath has a bijective Lang map. For any
@xmath , the points @xmath parameterize admissible @xmath -torsors.

One sends an admissible torsor with trivializations @xmath and @xmath to
the unique element of @xmath sending @xmath to @xmath via
right-multiplication. Changing the choice of @xmath shows that the
aforementioned assignment is well-defined up to right multiplication by
@xmath , and the map is constructed. One then proves surjectivity and
injectivity without too much difficulty (see the proof of the next
proposition.)

We generalize the above proposition to the context where the Lang map is
not necessarily bijective.

###### Definition 6.4.3.

Let @xmath be a scheme in @xmath with corresponding Frobenius
automorphism @xmath , the pullback of the Frobenius on @xmath . We
define the scheme @xmath by the fibered product

  -- -- --
        
  -- -- --

The definition is similar if @xmath is a scheme over an affinoid algebra
@xmath that is semi-linear with respect to the Frobenius action on
@xmath given by extending that of @xmath .

We are ready for our first of two generalizations of the concept of
admissibility. Recall (Definition 3.1.1 ) that a torsor @xmath for an
algebraic group @xmath over a rigid space @xmath is a @xmath -torsor
over @xmath for the Tate topology. If @xmath is furthermore a scheme in
filtered isocrystals, we require that locally on @xmath , the algebraic
restrictions @xmath are schemes in filtered isocrystals over @xmath
(which agree on overlaps) and that the coaction map is a morphism of
isocrystals (not necessarily preserving filtration) over @xmath .

###### Definition 6.4.4.

Let @xmath be a pro-algebraic group in filtered @xmath -modules over
@xmath (i.e. coordinate ring and all group structure maps live in @xmath
), and @xmath a rigid-analytic variety over @xmath . Then we call a
@xmath -torsor admissible if it has reductions of structure group to
both @xmath and @xmath . In other words, it is equipped with two
analytic subvarieties, one of which is a @xmath -torsor and one of which
is a @xmath -torsor in the above sense.

The point of this definition is:

###### Proposition 6.4.5.

Let @xmath be a variety with good reduction over a @xmath -adic field
@xmath that is the complement of a normal crossings divisor relative to
@xmath , and @xmath a @xmath -adic vector bundle with integrable
connection on @xmath . Let @xmath denote the associated isocrystal on
the special fiber, and suppose that there is a @xmath -local system on
@xmath which is associated to @xmath in the sense of [ 75 , 9.2.2] ;
suppose that all of these realizations have unipotent local monodromy [
75 , 4.14] .

If @xmath and @xmath are semisimple and simply connected, then for all
@xmath , the de Rham path torsor @xmath for @xmath is admissible.

###### Remark 24.

The condition that @xmath be semisimple and simply connected seems very
strong, but it is enough in geometric situations that @xmath be
semisimple and simply connected, since the two groups are isomorphic if
@xmath is connected ( 6.4.7 .) This can be checked by hand with
knowledge of the Frobenius action in applications. The group @xmath will
always be semisimple in geometric situations, due to “Deligne
semisimplicity” [ 29 ] in any of the categories in which we work.

There is always an associated @xmath -local system in the Gauss–Manin
case, and local monodromy will always be locally nilpotent there.

###### Proof.

Write @xmath and @xmath . First of all, we claim that the subscheme
@xmath is a @xmath -torsor. By compatibility of the action map with
Frobenius, @xmath certainly preserves @xmath . Furthermore, if @xmath is
a field over which @xmath has a point, then for any two points @xmath ,
there exists a unique element of @xmath taking @xmath to @xmath . By
uniqueness and Frobenius-compatibility, it is easy to see that this
element must lie in @xmath . By assumption, @xmath is simply connected
and semisimple, so that by Kneser’s theorem [ 84 , Section 3.1] @xmath
has a point.

Moving on to the Hodge filtration, consider the coaction map

  -- -------- --
     @xmath   
  -- -------- --

Note that this coaction is a morphism of filtered algebras. The key is
that this coaction is induced functorially from the étale realization in
the sense that if we denote the coaction of the étale fundamental groups
by @xmath , we have

  -- -------- --
     @xmath   
  -- -------- --

We now show that @xmath is an @xmath -torsor. The fact that the torsor
coaction is compatible with filtrations implies that the action map
restricts to

  -- -------- --
     @xmath   
  -- -------- --

Suppose that @xmath is a scheme such that @xmath has a @xmath -point, or
in other words a morphism

  -- -------- --
     @xmath   
  -- -------- --

Composing the coaction map with this morphism we get a map

  -- -------- --
     @xmath   
  -- -------- --

and an induced map

  -- -------- --
     @xmath   
  -- -------- --

which is an isomorphism by the torsor property. Our goal is to show that
the induced map

  -- -- --
        
  -- -- --

is an isomorphism, for which it will be sufficient to show that the map
@xmath is strictly compatible with the filtrations on each side.

By Olsson’s comparison, both @xmath and @xmath are colimits of modules
which are admissible in the usual sense of @xmath -adic Hodge theory.
But morphisms between admissible filtered @xmath -modules are strict [
16 , Theorem 8.2.11] , so by taking colimits the coaction map @xmath is
strict.

Furthermore, the Galois cohomology of @xmath vanishes by Kneser’s
theorem. Since @xmath is a parabolic subgroup of @xmath 6.4.21 , its
Galois cohomology injects into that of @xmath [ 84 , p. 129] . Thus
@xmath has trivial Galois cohomology; but @xmath is an extension of
@xmath by the unipotent @xmath , which itself has trivial Galois
cohomology over @xmath . We conclude that @xmath itself has trivial
Galois cohomology, and thus that @xmath has a point, and we are done.

∎

###### Proposition 6.4.6.

Let @xmath be a pro-algebraic group in @xmath . Then the pro-rigid
analytic stack over @xmath

  -- -------- --
     @xmath   
  -- -------- --

is the moduli space of admissible torsors for @xmath .

###### Remark 25.

This quotient is an algebraic stack because quotients of rigid stacks by
smooth rigid groups are again rigid stacks ( C.2.2 ); @xmath is smooth
because it is a group scheme over a field of characteristic zero (this
is “Cartier’s theorem” [ 41 , Exposé VII, Theorem 3.3 (ii)] ); thus its
analytification is smooth.

###### Remark 26.

We recall that this stack is defined as the stackification of the
pseudofunctor which sends a rigid space @xmath to the quotient groupoid

  -- -------- --
     @xmath   
  -- -------- --

Since this agrees with the algebraic stack

  -- -------- --
     @xmath   
  -- -------- --

on affinoid algebras, we will often abuse notation and write the latter
when it is clear.

###### Proof.

Locally in the Tate topology, the bijection works as follows, and the
result follows by stackification. Let @xmath be an admissible @xmath
-torsor.

Since we are looking locally, we may choose crystalline and Hodge
trivializations @xmath and @xmath of @xmath , and consider the element
@xmath . To check that this association is well-defined, consider a
different choice of trivializations, say @xmath and @xmath , of @xmath .
Now by the torsor property there exists a unique element @xmath such
that

  -- -------- --
     @xmath   
  -- -------- --

Applying Frobenius to both sides of this equation and using that the
crystalline trivializations are fixed, we see that

  -- -------- --
     @xmath   
  -- -------- --

Thus @xmath .

Reasoning with Kim, one also has

  -- -------- --
     @xmath   
  -- -------- --

for @xmath . Putting this information together, we have

  -- -------- --
     @xmath   
  -- -------- --

so that the association @xmath into @xmath is well-defined. Surjectivity
follows in the same way as in Kim’s proof, i.e. for an element @xmath
one lets @xmath be the @xmath -torsor whose underlying scheme is @xmath
, but which has Frobenius action @xmath . This action evidently fixes
@xmath (and the identity serves as a Hodge trivialization), so that
@xmath .

Now for injectivity. For two torsors @xmath we choose Frobenius and
Hodge trivializations @xmath and let @xmath . Suppose that @xmath in the
quotient, so that there exist @xmath such that

  -- -------- --
     @xmath   
  -- -------- --

Take a new Frobenius trivialization of @xmath via the formula @xmath .
(It is Frobenius-invariant because @xmath is fixed by Frobenius.)
Setting @xmath , we have the relation

  -- -------- --
     @xmath   
  -- -------- --

Then our choice of Frobenius trivializations gives an isomorphism
between @xmath and @xmath :

  -- -------- --
     @xmath   
  -- -------- --

  -- -------- --
     @xmath   
  -- -------- --

To show injectivity, we need to check that this isomorphism is
compatible with Hodge filtrations. Since @xmath , and similarly for
@xmath , the above isomorphism is given by

  -- -------- --
     @xmath   
  -- -------- --

in other words by

  -- -------- --
     @xmath   
  -- -------- --

Now indeed @xmath , so that the previous map is just the operation of
changing the Hodge trivialization. This operation preserves the Hodge
filtration on torsors, and thus implies injectivity.

∎

Fortunately, one needn’t worry about the growth of @xmath in the
sequence of pushouts @xmath : it only appears “on the @xmath -level,” as
we see here.

###### Proposition 6.4.7.

Preserve the notations of the previous proposition. Suppose,
furthermore, that @xmath has a bijective Lang map, and that Frobenius
acts by conjugation by a Frobenius semi-linear map on @xmath . Let
@xmath denote the centralizer of @xmath in @xmath .

Then the natural map @xmath is an isomorphism on connected components of
the identity, and @xmath injects into @xmath . In particular, @xmath .

###### Proof.

The fact that the exact sequence

  -- -------- --
     @xmath   
  -- -------- --

is @xmath -equivariant provides the homomorphism of group functors
@xmath . The bijective Lang map assumption implies that @xmath is
trivial (Theorem 6.2.6 ), which shows that this homomorphism is
injective.

We push out via the lower central series of @xmath , pass to Lie
algebras, and apply @xmath to each element of the exact sequence

  -- -------- --
     @xmath   
  -- -------- --

By the snake lemma,

  -- -------- --
     @xmath   
  -- -------- --

is exact. But by rank-nullity,

  -- -------- --
     @xmath   
  -- -------- --

and the latter group is zero, so the level- @xmath Frobenius-invariant
parts of the Lie algebras are isomorphic. By taking inverse limits along
the lower central series, we have @xmath .

Surjectivity on the level of Lie algebras, along with the injectivity of
@xmath , shows that @xmath is an isomorphism on connected components of
the identity. Injectivity on the level of groups implies, in particular,
injectivity on the level of @xmath . By assumption, @xmath , and we are
done. ∎

###### Remark 27.

One can deduce equality of connected components in some special
situations, although the author does not know if it should hold in
general. For example, if @xmath is simply connected and @xmath is
semi-simple, a theorem of Springer–Steinberg and Digne–Michel says that
@xmath is connected, which would imply equality on connected components
above. This theorem is applicable, for example, when @xmath come from
geometry in a context where Frobenius semisimplicity is known and @xmath
is the symplectic group.

#### 6.4.2 Flag varieties and Rapoport–Zink spaces

A word of motivation on the machinery that follows. The ideas behind
this section were inspired by Hain’s construction of the Albanese
manifold for the relative completion [ 45 , Section 13.1] , and the
reader who is more comfortable with complex constructions than @xmath
-adic ones is directed there for a sense of where we are going. Recall
that the theory of period domains associates to each polarizable Hodge
structure @xmath a partial flag variety

  -- -------- --
     @xmath   
  -- -------- --

where @xmath is a symplectic or orthogonal group for @xmath and @xmath
is a parabolic subgroup fixing the flag associated to the Hodge
filtration on @xmath . (The deep part of the theory actually cuts out a
smaller space which classifies flags that satisfy Riemann’s bilinear
relations.)

The complex case of period mappings proceeds as follows: suppose that
@xmath is a smooth and proper map of smooth complex manifolds. Then
locally (in the @xmath sense) around a point @xmath the fibration
trivializes, by a theorem of Ehresmann. Let @xmath be such a
trivializing neighborhood, which we may shrink and assume is simply
connected. For any point @xmath this trivialization gives a
diffeomorphism @xmath , hence an isomorphism of singular cohomology

  -- -------- --
     @xmath   
  -- -------- --

Finally, the comparison between singular and de Rham cohomologies
induces an isomorphism

  -- -------- --
     @xmath   
  -- -------- --

Furthermore, these cohomologies have the same Hodge filtration type,
meaning their associated gradeds have matching dimensions. Thus we
obtain an analytic map from @xmath to the flag variety parameterizing
flags with a fixed filtration type.

The theory of the Gauss–Manin connection allows a similar approach in
the @xmath -adic world, and we would like to emulate the complex case.
But we have our eyes set on the entire relative completion: when we
start talking about varying torsors instead of varying filtrations on a
fixed vector space, the Tannakian framework for filtrations and flag
varieties becomes essential.

Let us dive into the weeds and apply the theory of @xmath -adic period
domains as explained in the wonderful textbook of Dat, Orlik, and
Rapoport [ 28 ] . In order to recall the construction, we recap some
definitions. For @xmath fields, the category @xmath is the category of
@xmath -vector spaces @xmath equipped with a filtration on @xmath , with
morphisms taking one filtration into another after base change to @xmath
.

###### Definition 6.4.8.

Suppose @xmath is a vector space with filtration @xmath . Then the
degree of @xmath is

  -- -------- --
     @xmath   
  -- -------- --

The slope of @xmath is

  -- -------- --
     @xmath   
  -- -------- --

###### Definition 6.4.9.

Let @xmath be a neutral Tannakian category over @xmath , and @xmath an
extension of @xmath . By a filtration over @xmath on @xmath we refer to
a factorization of @xmath through @xmath . We denote the set of all such
filtrations by @xmath , and gradings are defined similarly.

###### Definition 6.4.10.

Write @xmath for the standard fiber functor on @xmath , for @xmath an
algebraic group. A @xmath -1-parameter subgroup, written @xmath -1PS, of
an algebraic group @xmath is a map @xmath defined over @xmath , where
@xmath . (The limit here is taken by divisibility.)

One shows that @xmath -1-parameter subgroups are in bijection with
@xmath -gradings of @xmath . If @xmath factors through the first
projection @xmath , this is just the simple fact that a morphism @xmath
is equivalent to a @xmath -grading on @xmath All of the filtrations we
consider will be of this type.

Now @xmath acts on the set of @xmath of @xmath by conjugation, since
they are each defined over @xmath .

###### Definition 6.4.11.

A PD-pair @xmath is a reductive group @xmath over @xmath along with a
@xmath -conjugacy class of @xmath -1PS @xmath defined over @xmath .

And, last but not least, we need the concept of a type of a filtration.
Recall that a @xmath -grading @xmath on a vector space induces a
decreasing @xmath -filtration by the formula @xmath , and this
construction generalizes in an obvious way to filtrations and gradings
on fiber functors.

###### Definition 6.4.12.

Let @xmath . Suppose there exists a @xmath -1PS @xmath (i.e. a @xmath
-grading of @xmath ) whose associated filtration is isomorphic to @xmath
. If @xmath denotes the conjugacy class of @xmath . We call @xmath the
type of @xmath .

###### Remark 28.

When there exists such a 1-PS, we call @xmath splittable. By the next
theorem, if @xmath is @xmath for @xmath a reductive group in
characteristic zero, then any filtration on @xmath is splittable.

Let @xmath be a filtration on @xmath . We will need the subgroup @xmath
, defined by @xmath .

The key to constructing flag varieties is that filtrations on fiber
functors can be seen group-theoretically through parabolic subgroups.

###### Theorem.

cf. [ 28 , Theorem 4.2.13] Let @xmath be a reductive algebraic group
over @xmath , a field of characteristic zero. Then @xmath is a parabolic
subgroup of @xmath , and @xmath , where @xmath is given a filtration via
@xmath and the adjoint representation of @xmath . Furthermore, @xmath
-filtrations of @xmath which are defined over @xmath are in bijection
with @xmath conjugacy classes of @xmath of @xmath .

###### Definition 6.4.13.

Let @xmath be a PD-pair, and denote by @xmath the stabilizer of @xmath
in @xmath . The reflex field of @xmath is the field @xmath .

Now any PD-pair gives rise to a generalized flag variety which we will
denote @xmath . Simply put, it classifies filtrations on the fiber
functor of @xmath of “type @xmath .”

###### Theorem.

[ 28 , Theorem 6.1.4]

There is a smooth, projective variety @xmath , defined over the reflex
field @xmath , with the property that

  -- -------- --
     @xmath   
  -- -------- --

Here @xmath runs over finite extensions of @xmath .

###### Remark 29.

In our case, @xmath will be a trivial extension of @xmath – this is
because the parabolic associated to the filtration we will care about is
@xmath , which is defined over @xmath .

The interaction with @xmath -adic Hodge theory comes through particular
kinds of filtrations on fiber functors, the so-called semistable and
weakly admissible filtrations. They depend on a concept of “slope” for
representations of PD-pairs. Following the definition of [ 28 ] we let
@xmath denote a perfect field of characteristic @xmath , @xmath the
fraction field of its Witt vectors, and @xmath an extension of @xmath .
Now every isocrystal has a unique slope decomposition,

  -- -------- --
     @xmath   
  -- -------- --

this means that for @xmath (and @xmath ) there exists a @xmath -lattice
@xmath where @xmath acts as @xmath on @xmath .

Finally, given a filtered isocrystal over @xmath (i.e. an isocrystal
@xmath over @xmath with a filtration @xmath on @xmath ), we define
another filtration @xmath on @xmath by

  -- -------- --
     @xmath   
  -- -------- --

Actually, we must briefly distinguish the whole isocrystal from the
underlying vector space @xmath and so we write @xmath

###### Definition 6.4.14.

Define the slope and degree of @xmath by

  -- -------- --
     @xmath   
  -- -------- --

and

  -- -------- --
     @xmath   
  -- -------- --

We say that @xmath is semi-stable if any sub-isocrystal @xmath has slope
at most @xmath , where the filtration on @xmath is induced by that of
@xmath . We call @xmath weakly admissible if it is semi-stable and has
degree zero.

Recall that a group in isocrystals over @xmath is a group scheme over
@xmath whose coordinate ring, comultiplication, inverse, and counit maps
all live in the category of isocrystals. Without comment, we use the
same terminology for any symmetric monoidal category. If @xmath denotes
the Tannakian fundamental group of the category of isocrystals over
@xmath , then @xmath acts (by definition) on the coordinate ring of any
group in isocrystals over @xmath , and thus on the group itself. We call
this action the canonical action.

###### Definition 6.4.15.

An augmented group scheme consists of a group in isocrystals @xmath and
a functor @xmath such that conjugating by the induced map @xmath is the
same action as the canonical action given above.

###### Example 6.4.16.

The natural fiber functor given by a @xmath -rational point on the
category of isocrystals on a scheme @xmath over a finite field @xmath
factors through the category of isocrystals over @xmath . This structure
gives the crystalline fundamental group the structure of an augmented
group scheme.

###### Definition 6.4.17.

Let @xmath be an augmented group scheme. In particular, the adjoint
representation and the augmentation combine to give @xmath the structure
of an isocrystal. A filtration @xmath over @xmath on @xmath is called
semi-stable or weakly admissible if the filtered isocrystal @xmath is
semi-stable or weakly admissible.

Having dispensed with these preliminaries, the mainstay of the theory of
@xmath -adic period domains is as follows [ 28 , Proposition 9.5.3] .

###### Theorem 6.4.18.

Let @xmath be a PD-pair over a @xmath -adic field @xmath such that
@xmath is also an augmented group scheme. There exists an open
rigid-analytic subspace

  -- -------- --
     @xmath   
  -- -------- --

which parameterizes weakly admissible @xmath -filtrations on @xmath of
type @xmath .

This means, in other words, that for each field @xmath over the reflex
field of @xmath , @xmath is in bijection with @xmath -filtrations on
@xmath that are weakly admissible.

#### 6.4.3 Applying period domains to group schemes that come with a
filtration

In our work, the filtration on a fiber functor will come from a
filtration on the coordinate ring of the fundamental group of the
underlying Tannakian category. Let @xmath be a reductive group in the
category @xmath , i.e. a group whose coordinate ring has the structure
of a @xmath -filtered isocrystal over @xmath with @xmath , and for which
the comultiplication and counit maps are compatible with the filtration.
The following construction was suggested by Paul Ziegler.

###### Proposition 6.4.19.

Suppose that the comultiplication map on @xmath is strict for the given
filtration. There is a unique filtration @xmath , ( @xmath being the
fiber functor associated to representations of @xmath ), such that the
induced right action of @xmath on @xmath reproduces the given filtration
on @xmath .

###### Proof.

If @xmath is a representation of @xmath , then the coaction

  -- -------- --
     @xmath   
  -- -------- --

is injective. (Indeed, the counit splits the injection.) Tensoring up to
@xmath , we have a map

  -- -------- --
     @xmath   
  -- -------- --

where now we’ve written subscripts instead of @xmath . Give the @xmath
on the right the trivial filtration, so that the tensor product on the
right has a filtration induced only by the one on @xmath . Then we let

  -- -------- --
     @xmath   
  -- -------- --

This filtration is functorial. When @xmath the coaction map is the
comultiplication map @xmath ; the counit then provides a sequence

  -- -------- --
     @xmath   
  -- -------- --

whose composition is the identity. We must show that even though
strictness means strictness for the tensor product filtration on @xmath
, it is still strict when the @xmath on the left of the tensor product
is given the trivial filtration.

Write @xmath . Consider @xmath ; @xmath , and

  -- -------- -- -------
     @xmath      (6.1)
  -- -------- -- -------

By strictness, @xmath , and then by 6.1 , we have @xmath ; in other
words, @xmath is still strict for the one-sided filtration. ∎

###### Definition 6.4.20.

We write @xmath for the canonical filtration on @xmath induced by the
previous proposition.

###### Remark 30.

Let @xmath be a group in @xmath . Then, setting

  -- -------- --
     @xmath   
  -- -------- --

we have @xmath acquires a filtration via the subspace, quotient, and
dual filtration. Furthermore, this filtration agrees with @xmath (from
the adjoint representation) due to Proposition 6.4.19 . Now if @xmath is
weakly admissible, then @xmath is also weakly admissible. To see this,
we can use the result of Fontaine and Colmez that every weakly
admissible filtered @xmath -module is actually admissible, i.e. comes
from a crystalline representation.

In particular, @xmath comes from a crystalline representation @xmath of
@xmath . This representation is in fact a commutative Hopf algebra,
because the functor

  -- -------- --
     @xmath   
  -- -------- --

(which is the inverse of @xmath ) is functorial and preserves tensor
products. Now @xmath is crystalline, because subobjects, quotients, and
duals of crystalline representations are crystalline. Finally, @xmath ,
so we see that @xmath is admissible and hence weakly admissible.

Now suppose that @xmath is defined over @xmath . As before, we define

  -- -------- --
     @xmath   
  -- -------- --

Recall the existence of a parabolic subgroup @xmath that sends the
filtration on the fiber functor to itself.

###### Proposition 6.4.21.

If @xmath is given the filtration @xmath , we have an equality @xmath .

###### Proof.

Let @xmath be an @xmath -representation of @xmath , for @xmath a @xmath
-algebra. Then if @xmath and @xmath corresponding to @xmath , the action
of @xmath is given by the composition

  -- -------- -- -------
     @xmath      (6.2)
  -- -------- -- -------

The key point is that the comodule map is strict for filtrations, even
when @xmath is given @xmath and @xmath has its given filtration, which
one checks using strictness of the coproduct for @xmath . Then we have

  -- -------- --
     @xmath   
  -- -------- --

If @xmath vanishes on @xmath , then @xmath is sent to @xmath by @xmath ,
and we are done. ∎

In other words, @xmath is the flag variety parameterizing filtrations on
@xmath of type @xmath .

#### 6.4.4 Sharpening the definition of admissible torsors even more

We now define a concept of weak admissibility for torsors.

Let @xmath be an augmented group scheme over @xmath , and @xmath a
finite extension of @xmath . Consider @xmath , a torsor for @xmath with
reductions of structure to @xmath and @xmath . Denote these reductions
of structure by @xmath and @xmath and take @xmath -trivializations
@xmath and @xmath , respectively.

Finally, let @xmath denote the element @xmath . The filtration @xmath on
@xmath can be shifted by @xmath : Let @xmath denote the new filtration
which is given by

  -- -------- --
     @xmath   
  -- -------- --

(Here @xmath means the adjoint action of a group on its Lie algebra.) In
fact, this new filtration obviously extends to the whole of @xmath .
Recall that @xmath has a semi-linear action of Frobenius, just because
@xmath is an augmented group scheme.

###### Definition 6.4.22.

We say that @xmath is weakly admissible if @xmath , equipped with the
filtration @xmath and this Frobenius action, is weakly admissible in the
sense of Definition 6.4.14 .

###### Remark 31.

It is not hard to see that the notion of weak admissibility does not
depend on the choice of trivializations for the reductions of structure:
Suppose another choice results in the filtration @xmath . Then @xmath ,
for @xmath and @xmath . First, @xmath preserves the filtration by
Proposition 6.4.21 (thus it doesn’t even change the induced filtration).
Second, @xmath is Frobenius-equivariant by definition (i.e. it is a
usual map of filtered @xmath -modules); but then the filtration given by
@xmath is weakly admissible if and only if @xmath is, for any filtration
@xmath . (This is the exact same argument as Proposition 6.4.24 , so we
leave it there.)

We may now state the sharpest admissibility criterion that we will use
in this work.

###### Definition 6.4.23.

Let @xmath be a group scheme in the category @xmath ; furthermore, fix a
map

  -- -------- --
     @xmath   
  -- -------- --

@xmath a reductive group which is an augmented group scheme in the same
category. (We require @xmath to be a map of schemes in filtered
isocrystals.) Finally, let @xmath be a @xmath -torsor in @xmath
-filtered @xmath -modules for some @xmath .

We say that @xmath is @xmath doubly admissible if @xmath is admissible
in the sense of having reductions of structure to @xmath and @xmath ,
and if furthermore @xmath , the pushforward of @xmath along @xmath , is
weakly admissible in the sense just defined. In general we will suppress
@xmath from our notation and just say that @xmath is doubly admissible.

###### Remark 32.

A well-known result of Colmez and Fontaine [ 23 ] says that a filtered
@xmath -module is weakly admissible if and only if it is of the form
@xmath for @xmath a crystalline representation. Thus we could just as
easily say that the second condition for double admissibility is that
the pushout @xmath is admissible, in the sense that @xmath is admissible
as a filtered @xmath -module.

#### 6.4.5 The de Rham moduli space: moduli of doubly admissible torsors

Armed with the notion of double admissibility for torsors, we refine the
notion of the de Rham moduli space. But first, an elementary
observation.

###### Proposition 6.4.24.

Let @xmath be a PD-pair in filtered @xmath -modules over @xmath . The
rigid subspace @xmath of the flag variety is preserved by the natural
action of the subgroup @xmath .

###### Proof.

Let @xmath , and consider @xmath with some filtration @xmath on the
fiber functor of @xmath of type @xmath . Let @xmath be a sub-isocrystal
of @xmath ; the @xmath condition implies that @xmath for @xmath . Thus
sub-isocrystals of @xmath are in bijection with sub-isocrystals of
@xmath . It is obvious that @xmath and @xmath have the same Hodge
polygon, since their filtrations have the same type.

The Newton polygon of any such @xmath is also fixed by @xmath : since
@xmath acts on @xmath via @xmath , the slopes of @xmath are the same as
those of @xmath . Thus the Newton polygon of @xmath lies over its Hodge
polygon iff the same is true of @xmath . This shows that @xmath is
weakly admissible iff @xmath is. ∎

###### Definition 6.4.25.

Consider a smooth @xmath -variety @xmath with good reduction and a
relative smooth normal crossing compactification, a vector bundle @xmath
on @xmath with reductive monodromy and nilpotent local monodromy, and a
basepoint @xmath . Consider Hain/Olsson’s filtration on the coordinate
rings of @xmath and @xmath , and let @xmath be the PD-pair associated to
@xmath . We define the de Rham moduli space @xmath associated to this
data as the pullback

  -- -- --
        
  -- -- --

We similarly define @xmath for each of the finite-dimensional quotients
@xmath .

The following statement follows easily from the earlier description of
admissible torsors and the definition of @xmath .

###### Proposition 6.4.26.

The stack @xmath is the moduli space of doubly admissible @xmath
-torsors with respect to the natural quotient @xmath .

We have the following fact, which follows from Proposition 6.4.5 and the
fact that the fibers of an admissible vector bundle are admissible (and
thus weakly admissible) isocrystals.

###### Corollary 6.4.27.

Preserve the notations of the previous definition. If @xmath is
admissible in the sense of Fontaine, then the relative de Rham path
torsors @xmath , with @xmath , are doubly admissible.

###### Proof.

We have already discussed the existence of Hodge and Frobenius
reductions of structure for @xmath , so we discuss only the weak
admissibility of the pushout @xmath .

The rest of the proposition will follow from Proposition 7.1.2 , since
@xmath lands in @xmath .

∎

### 6.5 Analyticity of the Albanese for the relative completion; the
crystalline fundamental group

We call the map

  -- -------- -- -------
     @xmath      (6.3)
     @xmath      (6.4)
  -- -------- -- -------

the relatively unipotent Albanese map, and we write @xmath for its
finite-level versions. It is essential for the Chabauty–Kim method that
the Albanese map be @xmath -adically analytic. By this we mean that for
every point @xmath , there is a @xmath -adic disc @xmath around @xmath
and a lift @xmath that is given by convergent power series after
embedding @xmath in affine space. We follow Kim’s general strategy [ 63
, pp. 11-12, bottom of p.14-top of p.15] . We suppose, as always, that
@xmath has unipotent local monodromy and reductive global monodromy and
@xmath has good reduction and is the complement of a smooth normal
crossings divisor over @xmath .

Fix a base point @xmath , with @xmath in the special fiber of (our
smooth model over @xmath of) @xmath .

###### Proposition 6.5.1.

The maps @xmath are @xmath -adically analytic.

###### Proof.

To keep the notation tidy, we denote by @xmath any of its finite-level
pushouts for the rest of this proof. Consider the @xmath -bundle @xmath
over @xmath with the property that its fiber over @xmath is @xmath . We
denote by @xmath its pullback to @xmath .

The analyticity will follow from the compatibility of the de Rham and
crystalline functors, which is the statement that

  -- -------- --
     @xmath   
  -- -------- --

for any @xmath . The fiber functor on @xmath is given by

  -- -------- --
     @xmath   
  -- -------- --

after tensoring up to @xmath . Here @xmath is a lift of @xmath to a
vector bundle with integrable connection on @xmath .

It suffices to consider the analyticity of the Albanese only in the
residue disc of @xmath , so we take @xmath . In this case

  -- -------- --
     @xmath   
  -- -------- --

The identity on the right hand side corresponds to the following path in
@xmath : for any vector bundle with integrable connection @xmath and
@xmath in the fiber of @xmath above @xmath , there is a unique element
@xmath such that @xmath and @xmath . (This follows from the fact that
the formal solutions to @xmath are @xmath -adically convergent in the
entire residue disc, which in turn follows from the fact that @xmath is
an @xmath -isocrystal [ 75 , 4.24(ii)] .) Then @xmath .

The key point here is that @xmath is @xmath -adic analytic in @xmath .
In particular, taking the universal bundle @xmath , we have a @xmath
-adic analytic section @xmath . Let us now construct a representative of
@xmath in a neighborhood of @xmath by constructing a Hodge
trivialization and a crystalline trivialization and “subtracting” one
from the other.

Now @xmath is an ind-vector bundle over @xmath , so its rigid
analytification is an ind-vector bundle over @xmath . Now there exists a
neighborhood @xmath of @xmath such that the torsor @xmath is trivial;
@xmath is trivial in that same neighborhood. Here @xmath refers to
analytification of locally free sheaves. Let @xmath be an analytic
trivialization of @xmath in @xmath . Write @xmath Now the standard
torsor coaction isomorphism gives rise to an isomorphism of ind-locally
free sheaves

  -- -------- --
     @xmath   
  -- -------- --

The map @xmath allows us to pull back the torsor isomorphism to an
isomorphism

  -- -------- --
     @xmath   
  -- -------- --

over @xmath . By definition, this is the map that, on the level of
torsors over @xmath , sends the identity section to @xmath .

We can do the same for @xmath (replacing @xmath by @xmath ), and form
the chain

  -- -------- --
     @xmath   
  -- -------- --

Now the identity of @xmath induces a map

  -- -------- --
     @xmath   
  -- -------- --

Post-composing this with the chain gives another rigid analytic map

  -- -------- --
     @xmath   
  -- -------- --

i.e a map @xmath . The analyticity of @xmath follows, since @xmath is a
representative for @xmath in @xmath .

∎

#### 6.5.1 Density of @xmath-adic period mappings

We would like to mimic Kim in showing that the map sending a point to
its de Rham torsor is Zariski-dense in the de Rham period space [ 63 ,
Theorem 1] . We indicate the direction of a proof, but would need to do
more work in defining complex-analytic Albanese maps for it to be
complete. The modular curve case is presented in [ 45 , Section 13.1] .

The following is a lemma of Lawrence and Venkatesh [ 67 , Lemma 3.2] .
Let @xmath be a number field, and @xmath a place of @xmath .

###### Lemma 6.5.2.

Suppose given power series @xmath such that all @xmath are absolutely
convergent, with no common zero, both in the @xmath -adic and complex
discs

  -- -------- --
     @xmath   
  -- -------- --

Write

  -- -------- --
     @xmath   
  -- -------- --

  -- -------- --
     @xmath   
  -- -------- --

for the corresponding maps. Then there exists a @xmath -subscheme @xmath
whose base change to @xmath (resp. @xmath ) is the Zariski closure of
the image of @xmath (resp. @xmath .)

Now let @xmath be defined over @xmath , and suppose that there exists a
holomorphic Albanese map

  -- -------- --
     @xmath   
  -- -------- --

in a complex neighborhood of the basepoint @xmath that satisfies the
following conditions: First, @xmath is given by power series defined
over @xmath , and second, this power series provides a representative
for the @xmath -adic analytic @xmath in a neighborhood of @xmath .

By embedding @xmath in projective space, we then have the following
statement:

###### Corollary 6.5.3.

Let @xmath be a Gauss–Manin situation (cf. 7.0.1 ) over a number field
@xmath such that @xmath and @xmath have good reduction at a place @xmath
of @xmath . To prove the Zariski-density of

  -- -------- --
     @xmath   
  -- -------- --

in the residue disc @xmath , it suffices to show the Zariski density of
the complex period map

  -- -------- --
     @xmath   
  -- -------- --

in a complex disc containing @xmath .

From here it is likely that one could imitate Brown’s proof from [ 18 ,
Section 4.4.1] to prove linear-independence of iterated integrals. Given
this linear independence, it is not far to Zariski-density [ 63 ,
Theorem 1] .

## Chapter 7 Applications to Fundamental Groups

#### 7.0.1 Cutting down the Selmer stack in the Gauss–Manin case

We now come to the definition of @xmath that will allow us to
demonstrate a small sliver of algebraicity of the Selmer stack; this
condition is the weight-restricted global Selmer stack. Consider the
pushout, then the untwisting map, then the restriction to residue
fields, as follows:

  -- -------- --
     @xmath   
  -- -------- --

Write @xmath for the groupoid of @xmath -dimensional families @xmath of
representations of the absolute Galois group of the residue field of
@xmath whose Frobenius eigenvalues at closed points of @xmath are
algebraic integers and have complex absolute value @xmath . (These
representations are said to have Frobenius weight @xmath .) Write @xmath
for those with a fixed residual pseudorepresentation.

Similarly, for a fixed @xmath we have the substack @xmath of @xmath .
This is the stack of global representations which are pure of weight
@xmath , i.e. representations all of whose restrictions to decomposition
groups outside of @xmath land in the stacks @xmath .

###### Definition 7.0.1.

The weight-restricted global Selmer stack with weight @xmath , @xmath
-adic Hodge type @xmath , and residual pseudorepresentation @xmath is
given by

  -- -------- --
     @xmath   
  -- -------- --

In other words, the weight-restricted Selmer stack is the fibered
product

  -- -------- --
     @xmath   
  -- -------- --

###### Remark 33.

It is not obvious that this should be representable by any sort of
geometric space, since the moduli spaces of local weight-restricted
representations are simply defined as substacks of the underlying
rigid-analytic stacks. Thus, in the next definition, we avoid using
weight restrictions on the local stacks because we want to ensure
representability.

We introduce the following notation.

###### Definition 7.0.2.

The type @xmath of a @xmath -equivariant @xmath torsor is the data

  -- -------- --
     @xmath   
  -- -------- --

of a set of residual pseudorepresentations @xmath , a @xmath -adic Hodge
type @xmath , and a Frobenius weight @xmath . In this situation we set

  -- -------- --
     @xmath   
  -- -------- --

The type @xmath in the local case, i.e. of a @xmath -equivariant @xmath
-torsor for @xmath , is exactly analogous except we omit the weight
@xmath . The space

  -- -------- --
     @xmath   
  -- -------- --

is defined exactly analogously as a union over all residual
pseudorepresentations, omitting any weight restriction.

Fortunately, we may restrict ourselves to a finite set of residual
representations in both the global and local cases. Let us recall an
idea of Faltings that underlies his proof of Mordell’s conjecture, which
one proves using Hermite-Minkowski finiteness.

###### Proposition 7.0.3.

Let @xmath be a number field, and @xmath a finite set of places of
@xmath . There are only finitely many semisimple representations of
@xmath that are pure of a fixed weight.

Now suppose that we are in the following situation:

( The Gauss–Manin case ) @xmath comes from the @xmath -th relative
geometric @xmath -adic étale cohomology of a family @xmath that has a
smooth and proper model over @xmath .

Since the fiber @xmath over any @xmath is smooth and proper, the
associated global Galois representation @xmath is unramified outside
@xmath and pure of weight @xmath . Thus we can apply the above
proposition to see that there are only finitely many options for the
semisimplification of @xmath ; a fortiori there are only finitely many
options for the pseudorepresentation associated to @xmath , and thus
only finitely many options for the residual pseudorepresentation
associated to @xmath . Call these pseudorepresentations @xmath .

On the local side, the local Galois group @xmath is topologically
finitely generated (Jannsen and Wingberg gave a list of generators and
relations [ 55 ] .) Any @xmath -representation of @xmath has a mod-
@xmath residual representation that is unique up to semi-simplification.
In any case, regardless of the choice of lattice it has only finitely
many residual representations due to finite generation. We denote by
@xmath the finitely many associated pseudorepresentations.

Last but not least, by embedding @xmath into @xmath and using the @xmath
-adic to complex de Rham comparison theorem we see that all of the local
representations @xmath ( @xmath , @xmath ) have the same @xmath -adic
Hodge type.

We summarize these observations as follows, assuming as above that we
are in the Gauss–Manin case.

###### Proposition 7.0.4.

Let @xmath . The global étale path torsor for the relative completion
@xmath lands in the stack @xmath , where @xmath has only a finite list
of pseudorepresentations, a single weight, and a single @xmath -adic
Hodge type.

The local étale path torsor for the relative completion, @xmath , lands
in the stack

  -- -------- --
     @xmath   
  -- -------- --

where @xmath has only a finite list of pseudorepresentations and a
single @xmath -adic Hodge type.

#### 7.0.2 @xmath is algebraic when @xmath is geometric

Proposition 7.0.3 has an even stronger consequence, which will allow us
to make the first step in passing from the rigid world (where dimension
theory is flabby) to the algebraic world (where dimension theory is much
more restrictive.) Indeed, in the Gauss–Manin case we will see that the
“bottom level” of the Selmer stack, Wang–Erickson’s representation
stack, is an algebraic stack. Recall that a morphism of rigid stacks is
said to be algebraizable if it is in the essential image of the map from
algebraic stacks over @xmath to rigid stacks over @xmath .

We will need Wang-Erickson’s hypothesis FGAMS , which is the hypothesis
that formal GAGA holds for adequate moduli spaces realized as quotients
by @xmath ; see [ 92 , Theorem 3.16] for a discussion of when this
hypothesis might hold.

###### Proposition 7.0.5.

  1  

     For any fixed weight @xmath , the weight-restricted representation
    stack @xmath is algebraizable.

  2  

     If FGAMS holds, then the fixed weight and crystalline locus @xmath
    is algebraizable.

  3  

     For any fixed weight @xmath , the image of the map @xmath lies in
    an algebraizable substack of the target.

  4  

     If FGAMS holds, then for any fixed weight @xmath , the image of the
    map @xmath lies in an algebraizable substack of the target.

###### Proof.

For 1 , consider the pseudorepresentation map

  -- -------- --
     @xmath   
  -- -------- --

Let @xmath be an extension of @xmath over which @xmath has a point. Now
@xmath can take only finitely many values by Proposition 7.0.3 . Thus
@xmath has finite image @xmath .

Wang–Erickson proves that the map @xmath is algebraizable [ 92 , Theorem
A] . In particular, @xmath is the analytification of an algebraic stack
of finite type over @xmath .

The argument is similar in the local cases 3 and 4 . Namely, the
restrictions @xmath may no longer be semisimple, but their
semisimplifications provide a finite list @xmath of semisimplifications
of the local representations associated to global points. Now
Wang-Erickson proves algebraicity of

  -- -------- --
     @xmath   
  -- -------- --

unconditionally, and the algebraicity of

  -- -------- --
     @xmath   
  -- -------- --

assuming FGAMS [ 92 , Corollary 6.8] .

These imply 2 , because the global crystalline representation stack is
the fibered product of the global stack with the local crystalline
stack.

∎

The main upshot of this algebraicity is that @xmath has the possibility
of landing in an algebraizable substack of @xmath .

Based on the algebraicity of the global fixed-weight Selmer stack, we
ask the following.

###### Question 7.0.6.

In the Gauss–Manin case and assuming FGAMS , is the weight-restricted
Selmer stack @xmath strat-representable in the category of algebraic
stacks?

### 7.1 Bloch–Kato logarithm

The only part of the Chabauty–Kim diagram of which we have said nothing
is the Bloch–Kato logarithm. For a linear crystalline representation
@xmath , the logarithm is a map

  -- -------- --
     @xmath   
  -- -------- --

In Kim’s unipotent formulation, the logarithm is promoted to an
algebraic map of pro-varieties

  -- -------- --
     @xmath   
  -- -------- --

given by sending a torsor @xmath to the torsor @xmath , obtained by
applying Fontaine’s de Rham or crystalline functors to the coordinate
ring of @xmath .

We note that Sakugawa develops a theory of the Bloch–Kato logarithm for
non-unipotent groups in [ 83 ] . Some remarks are in order which we hope
will show the advantage of the stacky approach to fundamental groups.
First of all, Sakugawa focuses on Selmer sets, i.e. pointed sets of
non-abelian cocycles. Second, Sakugawa needs to place a number of
conditions on his non-abelian Galois representations in order to
construct his logarithm for non-unipotent groups because he stays in the
land of sets.

The first condition is that the Lang map be a bijection on the de Rham
realization, and as we have shown, this holds on our @xmath for weight
reasons. However, it may not hold on all of @xmath : Since the Frobenius
action on @xmath is by conjugation, we see that the non-injectivity of
the Lang map is precisely measured by the centralizer of Frobenius
acting on @xmath . We are reminded that Lawrence and Venkatesh spend
much of their effort bounding this Frobenius centralizer, and so it is
not likely that we would be able to apply Sakugawa’s result in the
non-unipotent contexts we care about.

Second, Sakugawa imposes the condition that the Galois cohomology of the
de Rham realization of @xmath be trivial. We need to do the same, but it
is possible (see Remark 9 ) that this restriction can be lifted.

#### 7.1.1 The stacky logarithm and the Chabauty–Kim diagram

Now if

  -- -------- --
     @xmath   
  -- -------- --

is a torsor, we would like to set

  -- -------- --
     @xmath   
  -- -------- --

but we have to be careful: @xmath is not affinoid, as it is a torsor for
the non-affinoid @xmath .

Thus we must patch. We observe that if a family @xmath is crystalline
then @xmath commutes with arbitrary base change. In particular, we have
that

  -- -------- -- -------
     @xmath      (7.1)
  -- -------- -- -------

where @xmath is an affinoid open subset of @xmath .

###### Definition 7.1.1.

Let @xmath be as above. Then @xmath is defined as follows: Locally for
the Tate topology, @xmath corresponds to a torsor @xmath which has the
property that its coordinate ring is an ind-crystalline family of Galois
representations over @xmath ( @xmath an admissible subset of @xmath .)
This is by Remark 8 . Now we let the restriction of @xmath to @xmath be
@xmath . Finally, the gluing data for the various @xmath induces gluing
data on @xmath by ( 7.1 ), and we write @xmath for the glued torsor. We
define @xmath similarly.

We have that @xmath is a @xmath -torsor over @xmath , by Olsson’s
comparison theorem, as we explain below. This follows locally in the
Tate topology by applying @xmath to the coaction isomorphism

  -- -------- --
     @xmath   
  -- -------- --

Indeed, @xmath preserves tensor products, is functorial, and

  -- -------- --
     @xmath   
  -- -------- --

The coordinate ring of @xmath is locally given the usual “extrinsic”
Hodge filtration: the subspace filtration induced from @xmath , with the
trivial filtration on @xmath and the canonical filtration on @xmath .
Furthermore, it has a Frobenius action coming from the Frobenius on
@xmath

###### Proposition 7.1.2.

Suppose that both @xmath and @xmath are semisimple and simply connected.
We have that @xmath is a doubly admissible @xmath -torsor.

###### Proof.

This proof is basically a repeat of the argument that @xmath is
doubly-admissible, except with torsors over non-constant rigid bases.

The Frobenius reduction of structure is obvious Tate-locally from the
compatibility of the torsor map with Frobenius, and the Hodge reduction
of structure comes from the fact that the action of @xmath on the local
algebraic torsors @xmath is strict for the Hodge filtration because this
filtration is induced by the filtration on @xmath , cf. Remark 7 and
Proposition 6.4.5 .

We are ready to consider weak admissibility of the pushout @xmath . We
must check this on closed points of @xmath , so we assume that @xmath is
a finite extension of @xmath , and all of our calculations are
calculations with algebraic torsors. For each trivialization @xmath we
have an isomorphism @xmath . Furthermore, @xmath if and only if the map
@xmath is filtration-preserving. This follows because @xmath is defined
by the tensor product

  -- -- --
        
  -- -- --

and because the map vertical map is filtration-preserving if and only if
@xmath vanishes on @xmath , by strictness of the coaction as in
Proposition 6.4.21 .

Let @xmath , @xmath be trivializations of the reductions of structure
@xmath and @xmath over @xmath . These exist by the same argument with
Kneser’s theorem. Now @xmath and @xmath define isomorphisms

  -- -------- --
     @xmath   
  -- -------- --

with the property that @xmath is Frobenius-equivariant on coordinate
rings and @xmath is filtration-preserving on coordinate rings.

This produces a chain of isomorphisms

  -- -------- --
     @xmath   
  -- -------- --

whence an isomorphism @xmath . Let @xmath denote the image of the
filtration on @xmath via @xmath . Then we must show that the filtration
from @xmath on @xmath is weakly admissible. But for this it is
sufficient to show that @xmath is weakly admissible on @xmath itself.

But this follows from the properties of @xmath and @xmath ; since it is
filtration-preserving and the torsor action is strict, the pushforward
of the canonical filtration along @xmath gives the canonical filtration
on @xmath . Then we have a Frobenius-equivariant isomorphism @xmath from
a weakly admissible @xmath -module to another @xmath -module; thus the
image filtration is weakly admissible. We conclude that @xmath is weakly
admissible, and we are done.

∎

Using the compatibility of Olsson/Pridham’s comparison theorem with
filtrations, we thus have that the following diagram commutes.

  -- -- --
        
  -- -- --

The focus of the entire theory is on the following functor.

###### Definition 7.1.3.

The morphism

  -- -------- --
     @xmath   
  -- -------- --

is called the Bloch-Kato logarithm.

#### 7.1.2 Dimension theory for algebraic stacks

Essential for the classic method of Chabauty–Kim is the statement that
if @xmath is a morphism of schemes with @xmath , then @xmath lies in a
closed proper subscheme of @xmath . We now record the generalization of
this statement to the world of algebraic stacks; if the global Selmer
stack is algebraizable, then the map

  -- -------- --
     @xmath   
  -- -------- --

is obviously a map of algebraic stacks because it is functorial on the
category of @xmath -algebras. The material in this section comes from [
86 , Tag 0DRE ] , which was originally a preprint of Emerton and Gee.

Recall that the topological space @xmath has as an underlying set the
equivalence classes of morphisms from spectra of fields to @xmath . A
presentation of an algebraic stack is a groupoid @xmath in algebraic
spaces over @xmath , and an equivalence @xmath . We denote by @xmath the
identity map and @xmath the source map, and by @xmath the fiber of
@xmath over a point @xmath .

###### Definition 7.1.4.

[ 86 , Tag 0AFN ]

Let @xmath be a locally Noetherian algebraic stack over a scheme @xmath
. Let @xmath be a point of @xmath . Let @xmath be a presentation where
@xmath is a scheme and let @xmath be a point that maps to @xmath . We
define the dimension of @xmath at @xmath to be the element @xmath such
that

  -- -------- --
     @xmath   
  -- -------- --

The dimension is independent of the presentation and lift of @xmath that
are chosen [ 86 , Tag 0AFM ] .

Kim’s work uses the following basic statement:

###### Proposition 7.1.5.

Let @xmath be a map of schemes of finite type over a field @xmath with
@xmath . Then @xmath , the smallest closed subscheme of @xmath
containing @xmath , is strictly contained within @xmath .

###### Proof.

It is obvious that we may reduce to the case where @xmath and @xmath are
irreducible and affine. Furthermore, since @xmath is necessarily
quasi-compact, the image of the reduced morphism

  -- -------- --
     @xmath   
  -- -------- --

is the reduced subscheme underlying the scheme-theoretic image @xmath [
86 , Tag 056B ] . In any case, we see that it suffices to assume that
@xmath and @xmath are reduced, irreducible, and affine.

In such a case we have that the dimension of @xmath is given by the
transcendence degree of @xmath , and the same is true of @xmath [ 86 ,
Tag 00P0 ] . Suppose the image of @xmath were dense; then we would have
an injection of coordinate rings @xmath [ 86 , Tag 0CC1 ] .

This injection leads to an inclusion of fields @xmath . But
transcendence degree can only increase in extensions, so that the
dimension of @xmath must be at least the dimension of @xmath , a
contradiction. ∎

We need a stacky version. We restrict to the case of atlases whose
covering morphisms are representable by schemes because it is all we’ll
need.

###### Proposition 7.1.6.

Let @xmath be a map of stacks of finite type over a field @xmath with
@xmath . Suppose that the atlas covering maps for @xmath and @xmath are
representable by schemes. Then @xmath , the smallest closed substack of
@xmath through which @xmath factors, is strictly contained within @xmath
.

###### Proof.

By [ 86 , Tag 0CMK ] , the quasi-compactness of @xmath implies that
formation of scheme-theoretic image commutes with flat base change. Let
@xmath be an atlas of @xmath , so that @xmath is a presentation of
@xmath ; then the base-change of @xmath along the morphism @xmath yields
a map of schemes @xmath . We have that @xmath is a presentation of
@xmath . Now the dimension hypothesis can be rewritten as

  -- -------- --
     @xmath   
  -- -------- --

for all @xmath . Here the subscripts refer to the fiber of the
projection onto the first factor.

Finally,

  -- -------- --
     @xmath   
  -- -------- --

by [ 86 , Tag 0DRN ] , since we have a Cartesian diagram

  -- -- --
        
  -- -- --

where the vertical maps are projections onto the first factor (i.e. the
source map).

Thus @xmath , and by Proposition 7.1.5 the scheme-theoretic image of
@xmath is strictly contained in @xmath . But then, by compatibility with
base-change, the scheme-theoretic image of @xmath in @xmath could not be
the entirety of @xmath . ∎

### 7.2 An example: the projective line minus three points

We now apply the relative Chabauty–Kim philosophy to determine integral
points in the classical case of @xmath , with @xmath some finite set of
primes containing 2 and using a fixed auxilliary prime @xmath . Here
@xmath denotes the moduli space of elliptic curves with a marked
4-torsion point. Our proof of finiteness is conditional on a version of
the Fontaine–Mazur conjecture and the algebraicity of a certain Selmer
stack, however.

We hope the reader will bear with the absurdity of assuming such a
strong conjecture and an unknown algebraicity problem for a result such
as Siegel’s theorem on integral points on affine curves for some very
special affine curves; Siegel’s theorem has many elementary proofs, but
we the reader might appreciate that our method implies that combinations
of integrals of Eisenstein series ought to vanish on @xmath . In short,
this section should be viewed as an exposition of how one would apply
Chabauty–Kim for the relative completion if one knew that all relative
@xmath -adic Hodge theory considerations behaved nicely and all motivic
conjectures were true.

Now @xmath is isomorphic over @xmath to @xmath . Over @xmath one has the
universal family of elliptic curves corresponding to its interpretation
as a modular curve: this family is given by the normal form

  -- -------- --
     @xmath   
  -- -------- --

###### Remark 34.

Deligne realized that this family is 2-isogenous to the (shifted)
Legendre family

  -- -------- --
     @xmath   
  -- -------- --

See [ 60 , Section 2] for all of the above statements. Obviously, the
automorphism @xmath of @xmath shows that we may as well use the Legendre
family @xmath itself. Whether we choose to apply the relative
Chabauty–Kim method to the first family above or the Legendre family
does not matter to us. This is because isogenies induce isomorphisms on
étale, crystalline, and de Rham cohomology of elliptic curves as long as
2 does not divide the characteristic of any fields we work with, and so
the families of Galois representations, isocrystals, and vector bundles
we use are isomorphic.

Truthfully, the computations that follow are not particular at all to
@xmath and @xmath can be any modular curve for which Eisenstein classes
have been exhibited and shown to be non-trivial. This includes at the
very least @xmath for @xmath [ 64 , Section 3.1] . For all such curves
and universal families, the method of Lawrence and Venkatesh fails
because the de Rham moduli space collapses [ 67 , Section 1.3(a)] . Let
us show how our method remedies this problem.

Taking the local system or vector bundle @xmath induced by the first
cohomology of the universal family in each realization, we have
fundamental groups @xmath in each realization associated to any
basepoint @xmath . We consider the abelianization @xmath of the
unipotent part of @xmath in addition to the reductive part, so that we
are left with an extension of the form

  -- -------- --
     @xmath   
  -- -------- --

As detailed in [ 45 , Remark 13.3] , for any @xmath we have that

  -- -------- --
     @xmath   
  -- -------- --

is a quotient of @xmath in the de Rham and Betti realizations. Here
@xmath is the elliptic curve above @xmath . Write @xmath for this
quotient.

The same quotient exists in the étale and crystalline realizations. The
idea is that non-trivial Eisenstein classes have been given in every
realization, so that

  -- -------- --
     @xmath   
  -- -------- --

will always be a quotient of @xmath . The existence of the étale
quotient is instructive, and is shown for the modular curve @xmath in [
47 , Proposition 20.1] . For higher levels and all realizations, see [
64 , Section 3.1] .

It is a general fact that the Chabauty-Kim diagram may be applied to any
motivic quotient of the unipotent fundamental group by pushing out all
torsors to the quotient in question; the proofs apply verbatim to the
case of the pushout above. We may thus apply our relative Chabauty–Kim
diagram to the quotient @xmath , which is the relative completion pushed
out to the quotient:

  -- -------- --
     @xmath   
  -- -------- --

for each @xmath . We will show how to choose a @xmath such that the
dimension hypothesis holds for @xmath .

Now let us analyze the spaces @xmath and @xmath . This latter de Rham
space is easiest to study. The flag variety @xmath has dimension one.
Thus taking the stack-theoretic quotient by the centralizer of Frobenius
(which could be the whole of @xmath ) gives a space of dimension at
least -2, (speaking stack-theoretically).

Moving up the tower and analyzing the Hodge filtration on @xmath , we
see that @xmath is trivial. Now

  -- -------- --
     @xmath   
  -- -------- --

Therefore @xmath has dimension at least @xmath .

Let us analyze the étale side. We make the following assumptions.

###### Assumption 7.2.1.

The stack @xmath is strat-representable in the category of algebraic
stacks, where @xmath is the type associated to the finite list of
semisimple global representations of elliptic curves over @xmath and
@xmath . Furthermore, the @xmath -adic relative unipotent Albanese map
@xmath (i.e. at the level of @xmath ) is dense.

###### Remark 35.

Strat-representability of the global Selmer stack is not a problem for
our Chabauty arguments, because rational points land in one of the
substacks stratifying @xmath , and since there are finitely many, we can
just make the density argument on each one. This results in finitely
many @xmath -adic analytic functions that vanish on rational points.

Although one can bound @xmath using the @xmath theorems of Taylor and
Wiles, we are conditioning our proof on so much that we might as well
treat it as a black box and set @xmath .

Let us move up the tower on the étale side. Now @xmath fibers over
@xmath with fiber over a cocyle @xmath equal to a subquotient of @xmath
, where @xmath is the twist as defined in our discussion on stacky
cohomology. It suffices to bound the dimension of each of these twists.

Denote by @xmath the Galois representation @xmath . Then the fact that
@xmath acts on @xmath by right-multiplication gives

  -- -------- --
     @xmath   
  -- -------- --

for the twist of the Tate module; more generally, we have

  -- -------- --
     @xmath   
  -- -------- --

To estimate the dimensions of these twists, we note that, by the main
theorem of [ 66 ] which proves Fontaine–Mazur in dimension two, the
representations @xmath are motivic. (This is because we have put
unramifiedness and crystallinity conditions on @xmath , and restricted
the set of pseudorepresentations in the stack @xmath . The conditions
that Kisin requires on the reduction of @xmath are satisfied if we let
our set of residual pseudorepresentations @xmath be the smallest set
consisting of only those coming from @xmath of the curves in the
universal family, because all such residual representations satisfy
Kisin’s lifting conditions.)

The Euler characteristic formula [ 70 , Chapter 1, Section 5] gives

  -- -------- --
     @xmath   
  -- -------- --

where the negative denotes the negative eigenspace of complex
conjugation. This term has dimension

  -- -------- --
     @xmath   
  -- -------- --

Indeed, comparison with Hodge theory shows that complex conjugation acts
by @xmath on a one-dimensional subspace of @xmath , and so it acts
trivially on a @xmath -dimensional subspace of the relevant symmetric
power. This term dominates the étale side: it is approximately half the
dimension of the corresponding piece of the de Rham side.

Since @xmath has cohomological dimension two, it suffices to bound
@xmath for each @xmath from @xmath to @xmath , where a negative tensor
power indicates a dual, as usual. We consider the localization map

  -- -------- --
     @xmath   
  -- -------- --

###### Proposition 7.2.2.

[ 63 , Observation 2]

Conditional on the Fontaine–Mazur conjecture for Galois representations
of dimension @xmath , this localization has trivial kernel.

###### Proof.

By Poitou–Tate duality, this kernel is isomorphic to the kernel of the
localization

  -- -------- --
     @xmath   
  -- -------- --

which is denoted @xmath . Any element of @xmath can be viewed as an
extension

  -- -------- --
     @xmath   
  -- -------- --

where @xmath is the field of definition of @xmath , viewed as a trivial
representation. The fact that such an extension lies in @xmath implies
that this extension is crystalline at @xmath , since the localized
extension at @xmath is trivial and the direct sum of two crystalline
representations is crystalline.

By the Fontaine–Mazur conjecture, a representation unramified almost
everywhere and crystalline at @xmath is motivic, and in particular is
endowed with a weight filtration such that the above exact sequence is
strict for the weight filtration. An argument with this filtration
finishes the proof, since @xmath is pure of weight @xmath , while @xmath
has weight zero. The strictness of the map @xmath implies that there is
some element @xmath which maps to @xmath ; now by weight considerations
@xmath is trivial when @xmath , so that @xmath and we have shown that
@xmath splits. ∎

We proceed to compute the dimension of @xmath By local duality, this is
the same as @xmath When @xmath , the Hodge–Tate decomposition gives

  -- -------- --
     @xmath   
  -- -------- --

where @xmath and @xmath have dimension one. The last space in this
sequence has dimension one, corresponding to the term @xmath .

When @xmath , the weight filtration on @xmath has one-dimensional
associated gradeds with weights zero and two, or a two-dimensional
weight 1 eigenspace. (See, for example, [ 82 , Theorem 2] .) Then @xmath
again has dimension at most one. We conclude that

  -- -------- --
     @xmath   
  -- -------- --

and the dimension hypothesis holds so long as @xmath Comparing leading
terms shows that @xmath can be chosen large enough to ensure this
inequality. This concludes the proof.

It would be particularly interesting to find the explicit iterated
integrals that vanish on global points. These integrals should be
related to elliptic polylogarithms.

## Appendix A Tannakian Categories

###### Definition A.0.1.

For a topological group @xmath and a topological field @xmath , we will
denote by @xmath the category of continuous finite-dimensional
representations of @xmath . If @xmath is an algebraic group over a field
@xmath , @xmath means finite dimensional algebraic @xmath
-representations of @xmath in the sense of algebraic groups.

The theory of neutral Tannakian categories is the characterization of
categories that are equivalent to one of the form @xmath for @xmath a
(pro-)algebraic group. Such categories are abundant in mathematics, and
their study is rich precisely because they bring to bear all of the
tools of representation theory. We do not aim here to give a full
account of Tannakian categories; some nice references are ( [ 87 ] , [
32 ] ). Instead we recall one result that tends to appear in a “second
reading" for many students and is essential for our understanding of the
fundamental group.

### a.1 Interpretation via Zariski closures and universality

The Zariski closure of a representation arises throughout our work,
particularly in the example of the geometric monodromy group. There is,
indeed, a Tannakian interpretation to the Zariski closure.

###### Proposition A.1.1.

Let @xmath be a finite-dimensional representation of a group over a
field @xmath . Consider the smallest Tannakian subcategory of @xmath
containing @xmath , and denote this subcategory by @xmath . Then the
Tannakian fundamental group of @xmath is canonically isomorphic to the
Zariski closure of the image of @xmath in @xmath .

This interpretation via Zariski closures plays a second role, namely it
induces the universality of the Tannakian fundamental group as follows.
Let @xmath be the Tannakian fundamental group of @xmath . Consider the
collection @xmath of pairs @xmath where @xmath is an algebraic group
over @xmath and @xmath is a continuous and Zariski-dense homomorphism.
Now @xmath naturally forms an inverse system, and the assertion is that
@xmath is the inverse limit of @xmath . Thus it satisfies the universal
property of the inverse limit. All of this is stated and proven in an
open neighborhood of [ 87 , 6.5.17] , except for the continuity proviso.
This last add-on is a straightforward application of the aforementioned
theorem, along with the fact that @xmath contains only continuous
representations, and that @xmath is the direct limit of the full
subcategories @xmath .

## Appendix B Relevant Concepts in Arithmetic Geometry: Étale Local
Systems, Gauss–Manin, and Chen’s @xmath Theorem

We take this section to introduce the Tannakian categories that feature
in the Chabauty–Coleman–Kim process. An expert can safely skip this
introduction.

### b.1 Recollections on étale maps and local systems

The star of twentieth-century arithmetic geometry is the étale topology.
The basic theory of étale maps and the étale topos can be found in the
classic book of Freitag and Kiehl [ 37 ] . We take this section to
recall some of the properties of étale maps that we will need for our
later work. Of the two properties we emphasize, the first will help us
interpret the Tannakian fundamental group, and the second will play into
our main example in formal geometry. After reviewing these two
properties we show that the Tannakian étale fundamental group is the
unipotent completion of the profinite fundamental group.

  -----------------------------------------------------------------------
  Property                            Enables us to…
  ----------------------------------- -----------------------------------
  Homotopy Lifting                    Translate from deck transformations
                                      to automorphisms of fiber to
                                      automorphisms of fiber functor

  Remarkable Equivalence              Lift objects from finite fields to
                                      local rings

                                      
  -----------------------------------------------------------------------

The first such property is the “homotopy lifting property" for étale
maps, the proof of which can be found in [ 87 , Corollary 5.3.3] .

###### Lemma B.1.1.

Suppose @xmath , and @xmath are schemes, with @xmath connected. Let
@xmath be an étale map, and @xmath any morphism. Then a lift of @xmath
to @xmath is determined by the lift of any geometric point.

###### Remark 36.

We call this the lifting property not just because it involves lifting,
but because it emulates the lemma of the same name for covering spaces
in topology, in which the lift of a curve on a space is determined by
the lift of its starting-point.

When @xmath is finite étale, @xmath is connected, and @xmath acts
transitively on the fiber above a geometric point, we call @xmath
Galois. As far as the Tannakian point of view is concerned, the most
important case of the lifting lemma is when @xmath in the above and
@xmath is Galois. In that case, the lemma non-canonically identifies
@xmath with the fiber above any geometric point.

###### Definition B.1.2.

We define the profinite étale fundamental group of a scheme @xmath by

  -- -------- --
     @xmath   
  -- -------- --

where @xmath runs over all Galois covers of @xmath . (We will reserve
the phrase étale fundamental group and the notation @xmath for the
Tannakian counterpart.)

The other amazing property of étale maps is another form of lifting
statement, known as “Une equivalence remarquable de cat gories” – let us
remark upon it, then.

###### Lemma B.1.3.

Let @xmath be a scheme, and @xmath a closed subscheme with the same
underlying topological space. Then there is an equivalence of categories
induced by pullback to @xmath , given as follows:

  -- -------- --
     @xmath   
  -- -------- --

Again, there are too many complete references for this fact (the
original being [ 33 , IV, 18.1.2 ] ), and so we simply highlight the
“kernels of algebra" which grow into the proof.

###### Proof Sketch.

Regarding the existence of a lifting of an étale map

  -- -------- --
     @xmath   
  -- -------- --

one first studies the affine case. Indeed, the fact that @xmath and
@xmath have the same topological space means that Zariski-locally the
morphism @xmath looks like @xmath where @xmath is locally nilpotent
(i.e. every element of @xmath has some power that is zero.) Likewise the
local structure of étale maps says that Zariski-locally on the target we
have an isomorphism

  -- -------- --
     @xmath   
  -- -------- --

where the Jacobian of the set of @xmath s is invertible in @xmath . Now
our local lift of @xmath is just given by lifting these @xmath to
elements of @xmath .

A tiny bit of commutative algebra shows that an element @xmath is a unit
if and only if it is a unit in @xmath . The “only if" direction is easy.
Assume that @xmath is a unit in @xmath . Then there exist @xmath and
@xmath such that @xmath , so

  -- -------- --
     @xmath   
  -- -------- --

for some @xmath . Expanding the left hand side, we see that we can move
over @xmath and factor out an @xmath , and we see that @xmath is a unit
in @xmath . Thus the Jacobian of the lifts of @xmath is a unit in @xmath
, and we have shown that the lift is étale.

We now look to patch these local liftings. Let @xmath and @xmath be
affine subschemes of @xmath over an affine scheme @xmath with @xmath ,
and @xmath a lift of @xmath to @xmath . Now there is a unique open
subscheme @xmath given by restricting the structure sheaf of @xmath to
the open subset

  -- -------- --
     @xmath   
  -- -------- --

From this description we see that @xmath and thus that we have an
isomorphism

  -- -------- --
     @xmath   
  -- -------- --

We lift @xmath to an isomorphism @xmath by proving the fully
faithfulness in our lemma. To show that the map is full and faithful,
one first reduces to the affine case; from there one uses the fact that
étale morphisms are formally smooth; for details the reader is directed
to [ 86 , Tag 025H ] . Supposing that the reduction map is fully
faithful, there is an isomorphism @xmath lifting @xmath . In fact,
@xmath satisfy the cocycle condition because @xmath is the unique
lifting of @xmath , which is the identity. ∎

The remarkable equivalence is fascinating because it says that étale
coverings of a scheme are remarkably insensitive to the algebraic nature
of the scheme. We will use the remarkable equivalence repeatedly in our
examples of formal schemes, because it often allows one to lift objects
from @xmath , say, to compatible collections of objects over @xmath .

###### Definition B.1.4.

Let @xmath be a scheme. The large étale site on @xmath , denoted @xmath
, is the site associated to the Grothendieck topology whose objects are
schemes over @xmath , and whose coverings are jointly surjective étale
@xmath -maps.

The small étale site on @xmath , denoted @xmath , is the full
subcategory of the big étale site whose objects are schemes which are
themselves étale over @xmath .

###### Remark 37.

The big and small étale sites play very different roles in the geometric
theory. A good rule of thumb is that the small étale site is an enhanced
version of the Zariski topology on @xmath , while the large étale site
is the category on which to test properties like descent. In fact, in
view of the remarkable equivalence for étale maps, the small étale sites
of a scheme and any nilpotent thickening of it are isomorphic. If one
wants, one can say something even stronger: the small étale site is
invariant under universal homeomorphism [ 86 , Tag 04DZ ] . (Universal
homeomorphism, we recall, is the property of a morphism being a
homeomorphism after any base change.) This topological invariance is a
beautiful byproduct of the étale theory – the étale site treats a scheme
as much as possible like a topological space, but keeps enough algebraic
data that sheaf cohomology, for example, is still very interesting.

As the lifting property demonstrated by analogy, the étale topology is
the correct context in which to discuss local systems if we want them to
behave the same as holomorphic or topological local systems. We will
make this statement rigiorous soon enough. Unfortunately, local systems
with @xmath -coefficients are not quite as simple as locally constant
@xmath -sheaves on the étale site.

###### Definition B.1.5.

Let @xmath be a scheme. The category of @xmath -local systems (or lisse
sheaves) on @xmath has as its objects inverse systems @xmath , where
@xmath is a locally constant @xmath -sheaf for the étale topology, with
the condition that the projections @xmath induce isomorphisms

  -- -------- --
     @xmath   
  -- -------- --

The maps in the category of @xmath - local systems are given by

  -- -------- --
     @xmath   
  -- -------- --

Why don’t we use locally constant @xmath -sheaves on the étale site? One
could snarkily say that the whole theory of the étale topology is an
answer to this question. But this answer does not tell us why the
Zariski topology with locally constant sheaves is the incorrect option.
This question has a much easier answer, detailed in [ 71 , Chapter 1,
“The inadequacy of the étale topology”] .

There are basically two related problems: first of all, higher Zariski
cohomology of an irreducible variety with values in a constant sheaf is
trivial. For applications to the Weil conjectures, then, Grothendieck
and Deligne certainly needed a better cohomology theory. The second
problem is a question of local triviality. Indeed, let @xmath be a
morphism of schemes with @xmath irreducible. Then, again, the higher
pushforwards of the Zariski constant sheaf @xmath are trivial. Thus the
Zariski topology reveals little about the map @xmath , let alone any
sort of monodromy.

###### Remark 38.

There is a way to get around these pro-systems of sheaves, as discovered
by Bhatt and Scholze in [ 12 ] . In their pro-étale site, the @xmath
-local systems presented here are honest locally-constant @xmath
-sheaves.

In the topological case a covering space produces a local system by
pushing forward the constant sheaf, and we define an analogous
arithmetic analogue: for an étale cover @xmath , with @xmath invertible
on @xmath and @xmath , we consider the pushforward @xmath , and the
smooth and proper base change theorem says that this system of
pushforwards is a @xmath -local system. (See [ 71 , Theorem 20.2] .) On
the other hand, given a @xmath -local system @xmath on @xmath , one is
then challenged to find an étale cover @xmath such that @xmath is
isomorphic to @xmath . Such a construction indeed exists – although one
is forced to take pro-covers, a natural adjustment based on the
differences between the algebraic and analytic worlds.

The theorem that we are ultimately searching for is the following. (For
relatively elementary proofs of the finite level-statement below, see [
3 , Theorem 6.52] and [ 87 , Theorem 5.4.2] .) Recall that a scheme is
geometrically unibranch if its local rings at all points are
geometrically unibranch, a sortof integrality condition [ 86 , Tag 0BPZ
] . Normal schemes are geometrically unibranch.

###### Theorem B.1.6 ([12, Lemma 7.4.7 + Lemma 7.4.10]).

Suppose that @xmath is connected and geometrically unibranch. Then there
is a natural equivalence between the categories of @xmath local systems
on @xmath and the category of continuous @xmath representations of
@xmath , where continuity references the @xmath -adic topology in the
target and the profinite topology on the source.

Let us take a moment to open the dictionary between these two worlds.
Let us consider @xmath -modules for @xmath and @xmath -modules on @xmath
for now, and then we will reduce to this case. (We begin in the finite
world, as do all good things.) The main idea behind the dictionary is
that both modules on @xmath and finite representations of @xmath
correspond to finite étale covers of @xmath .

Indeed, the most difficult part of the proof is the following
representability result.

###### Proposition B.1.7.

Let @xmath be a locally constant sheaf of abelian groups on @xmath with
finite stalk @xmath at all geometric points. Then @xmath is represented
in the larger category @xmath by a commutative group scheme @xmath that
is finite and étale over @xmath .

Now by definition the profinite étale fundamental group of @xmath acts
on @xmath , and thus the stalk of @xmath over the basepoint @xmath
(which is the module @xmath .) This provides one direction of the
equivalence.

On the other hand, suppose we are given a @xmath -module @xmath on which
@xmath acts continuously. By continuity this action factors through a
finite quotient @xmath . Now the Galois theory of the étale fundamental
group says that there is an étale cover @xmath whose automorphisms are
@xmath . There is a @xmath -action on the constant sheaf @xmath ; we
have for all @xmath a map

  -- -------- --
     @xmath   
  -- -------- --

which takes a section over an étale open @xmath , @xmath , to the
section @xmath using the action of @xmath that we were given on the
codomain. We also see that @xmath , so that the maps @xmath become
genuine automorphisms

  -- -------- --
     @xmath   
  -- -------- --

by functoriality. The étale sheaf we desire is then

  -- -------- --
     @xmath   
  -- -------- --

the sections of @xmath that are fixed under the action of @xmath .

These two functors are inverses – a beginning reader is encouraged is
read the proof in the references we have given. To reduce to the case of
finite modules, one notes that any representation of @xmath must land in
a lattice

  -- -------- --
     @xmath   
  -- -------- --

by compactness of the profinite étale fundamental group. Then one forms
the reductions

  -- -------- --
     @xmath   
  -- -------- --

which are free @xmath -modules of rank @xmath to which one can apply the
previous theorem.

However, to move in the other direction from a @xmath -local system
@xmath to a representation of the fundamental group via the case of
finite modules requires one to find a @xmath -local system @xmath such
that @xmath . In general this is only possible when @xmath is
geometrically unibranch; for a counterexample see [ 12 , Example 7.4.9]
.

We may now mimic the construction of the topological fundamental group
via deck transformations.

###### Proposition B.1.8.

The category of @xmath -local systems, equipped with the fiber functor
that sends a local system to its fiber over a point @xmath , is a
Tannakian category whose associated pro-group scheme we denote @xmath .
We call this group the pro-algebraic étale fundamental group.

The previous theorem shows that the proalgebraic étale fundamental group
is the @xmath -algebraic envelope of the profinite fundamental group of
@xmath when @xmath is geometrically unibranch. This is a simple
consequence of the universal property of the algebraic envelope. (See
A.1 for standard details on algebraic envelopes and Tannakian
fundamental groups.)

### b.2 Vector bundles with integrable connection

The next essential component of the motivic fundamental group is the
category of vector bundles with integrable connection. Recall that (the
sheaf of sections of) a vector bundle over a scheme @xmath is a locally
free sheaf of @xmath -modules. It is common practice to conflate the
sheaf of sections and the total space of the vector bundle, which we can
recover using the formula @xmath .

###### Definition B.2.1.

Let @xmath be (the sheaf of sections of) a vector bundle. A connection
on @xmath is a map

  -- -------- --
     @xmath   
  -- -------- --

satisfying linearity and the Leibniz rule, namely:

  -- -------- --
     @xmath   
  -- -------- --

and

  -- -------- --
     @xmath   
  -- -------- --

for @xmath open, @xmath , and @xmath .

Finally, we denote by @xmath the kernel of @xmath , called the flat
sections of @xmath .

The same definition works for complex manifolds.

Not all vector bundles are created equal, of course. We often imagine
that there is a way to parallel transport – or “flow” – vectors from one
fiber of the bundle to another fiber, and that’s what the connection
gives us: for every path from @xmath to @xmath in the base, a connection
gives an automorphism of the fiber. But if we are working in the
topological category then a path and a homotoped version of the path
might give different automorphisms of the fiber. The condition that
ensures the homotopy-invariance of the endomorphism in the topological
category is flatness .

Suppose @xmath is a scheme over a field @xmath , and construct the sheaf
of differentials valued in @xmath : @xmath Denote the usual differential
on forms by @xmath . Now consider the map

  -- -------- --
     @xmath   
  -- -------- --

###### Definition B.2.2.

A connection @xmath on a vector bundle @xmath is called flat or
integrable if the composition

  -- -------- --
     @xmath   
  -- -------- --

is identically zero.

###### Remark 39.

We can give the reader one convenient way to think of flatness in the
algebraic category, where homotopy invariance cannot appear in the same
way as in the topological category. Flatness in fact ensures that @xmath
for each @xmath , so that @xmath becomes a chain complex. This handy
definition thus allows us to define the de Rham cohomology of @xmath as
the sheaf cohomology (or hypercohomology in the algebraic category) of
this complex.

Very often, our bundles with come with quite a bit more structure – this
structure is encoded by the notion of a polarized variation of Hodge
structures.

###### Definition B.2.3.

If @xmath is a complex manifold, then a real variation of Hodge
structures on @xmath of weight @xmath is a complex vector bundle with
flat connection @xmath together with a real structure @xmath and a
decreasing filtration by holomorphic sub-bundles @xmath on @xmath
satisfying the following conditions:

First, the filtration @xmath must induce a Hodge structure of weight
@xmath on each fiber of @xmath . Second, the flat connection @xmath on
@xmath must satisfy Griffiths transversality, which is the requirement
that

  -- -------- --
     @xmath   
  -- -------- --

There is an extremely strong sense in which the category of vector
bundles with integrable connection over @xmath captures much of its de
Rham theory. For example, this category will most definitely determine
@xmath . It will also contain the variation of Hodge structures coming
from the de Rham cohomology of the fibers of all smooth and proper
families @xmath – this is the Gauss–Manin connection that we will define
in the next section.

The category @xmath of finite dimensional vector bundles with integrable
connection over a scheme @xmath is a Tannakian category over @xmath ,
once one fixes a point @xmath , the fiber functor being given by the
vector bundle fiber over the basepoint. We denote its Tannakian
fundamental group by @xmath . For what follows, we often have a scheme
@xmath over a @xmath -adic field @xmath and a fixed embedding @xmath .
Then we denote by @xmath the fundamental group of @xmath and @xmath the
de Rham fundamental group of @xmath .

If we instead consider the subcategory of unipotent objects in @xmath
(the thick subcategory generated by the structure sheaf with its trivial
connection), we denote the corresponding fundamental group by @xmath .

We quickly note the following comparison theorem. Then we have the
following comparison isomorphism which is used to equip unipotent @xmath
-adic fundamental groups with Hodge structures: there is an isomorphism

  -- -------- --
     @xmath   
  -- -------- --

One obtains this comparison by comparing the universal objects in each
category, ultimately arising from a comparison between complex and
@xmath -adic de Rham cohomologies compatible with cup product. A similar
comparison between algebraic and holomorphic de Rham cohomologies
provides a comparison with the “analytic de Rham fundamental group” of
holomorphic flat vector bundles on the analytification of @xmath . We
therefore conflate the two types of complex vector bundles from now on.
For more details on when these comparison theorems hold for relative
completions of fundamental groups, see our discussion about universal
objects in the section on relative completions for the motivically
inclined.

An essential property of @xmath is that its coordinate ring has a mixed
Hodge structure – one obtains this filtration from the following theorem
about the complex unipotent fundamental group.

###### Theorem B.2.4.

[ 19 ]

  Coordinate Ring  

     There is an explicit description of @xmath in terms of iterated
    integrals of differential forms on @xmath . Concisely,

      -- -------- --
         @xmath   
      -- -------- --

    Here @xmath denotes the bar complex, which we touch on in the main
    body of the text.

  Comparison  

     We have an isomorphism

      -- -------- --
         @xmath   
      -- -------- --

    where the @xmath superscript refers to the (unipotent) Malcev
    completion of the topological fundamental group.

  Hodge Structure and Induced Hodge Structure  

     The above description of the coordinate ring induces a mixed Hodge
    structure on @xmath : the weight filtration is given by the length
    filtration of iterated integrals (plus the number of logarithmic
    terms in the non-projective case), and the Hodge filtration is given
    by the number of holomorphic forms in the integral. i.e. it is
    induced by the Hodge filtration on @xmath . A complete description
    of these filtrations is given in [ 49 ] .

    Owing to the comparison theorem above and the one mentioned before
    the theorem, @xmath and @xmath inherit rational and @xmath -mixed
    Hodge structures, respectively.

### b.3 The Gauss–Manin connection

One essential source of vector bundles with integrable connection is the
fiberwise de Rham cohomology of proper smooth morphisms of smooth
schemes @xmath . For such a family, we define the relative de Rham
cohomology to be @xmath . By [ 86 , Tag 02G1 ] the smoothness of @xmath
implies that @xmath is locally free on @xmath ; by properness, its
derived pushforward is at least coherent. We will define a connection on
this sheaf. (The existence of a connection implies that the sheaf is
locally free. See [ 58 , Proposition 8.8] .)

After analytic descriptions going back to Gauss and Manin in various
forms, Katz and Oda provided a purely algebraic description in the
mid-twentieth century [ 61 ] . Their key insight was that there is a
natural filtration on the complex @xmath given by

  -- -------- --
     @xmath   
  -- -------- --

We now introduce a fact from linear algebra that will allow us to
leverage this filtration to create a connection.

###### Fact B.3.1.

If

  -- -------- --
     @xmath   
  -- -------- --

is an exact sequence of vector spaces over a field (which we suppress in
our notation), we consider the natural filtration on @xmath given by

  -- -------- --
     @xmath   
  -- -------- --

Then we have that

  -- -------- --
     @xmath   
  -- -------- --

The proof of this fact is an exercise to the reader.

Now we apply the previous linear algebra fact to the exact sequence

  -- -------- --
     @xmath   
  -- -------- --

which arises from the smoothness of @xmath , and we have the calculation
of the associated graded: the @xmath ^(th) graded piece of the induced
filtration on @xmath is @xmath .

###### Definition B.3.2.

Consider the exact sequence @xmath obtained from the aforementioned
filtration on @xmath ; the connecting homomorphism @xmath produces a map

  -- -------- -- -------
     @xmath      (B.1)
     @xmath      (B.2)
  -- -------- -- -------

(The second isomorphism above is the calculation of the associated
graded, and the third is given by the projection formula.)

The resulting composition @xmath is called the Gauss–Manin connection.

Here is a concrete description of the connection when @xmath and @xmath
are both affine and @xmath , from Besser [ 11 , 1.7.1] .

###### Example B.3.3.

(Affine Gauss–Manin for @xmath .)

Suppose that @xmath and @xmath are smooth affine schemes over a field
@xmath , and that @xmath is a smooth @xmath -morphism. Then the
Gauss–Manin connection on the first relative cohomology has a simple
description. Let @xmath be a closed form with respect to the relative
differential. We pick a lift @xmath ; then @xmath , and in fact @xmath
is in the kernel of the map @xmath , because @xmath is closed and
differentiation commutes with the map to relative differentials. Now
using the linear algebra fact again for @xmath shows that this kernel is
precisely @xmath ; projecting to the associated graded we obtain an
element @xmath that must in fact live in @xmath . Taking cohomology
classes gives an element @xmath .

The @xmath -isocrystal structure on relative crystalline cohomology
implies that formal solutions to the Gauss–Manin connection over a
@xmath -adic field converge on residue tubes [ 57 , 3.1.2] , as we now
explain. In other words, the non-unipotent vector bundle with integrable
connection coming from the relative de Rham cohomology can be integrated
on residue tubes at the very least. In fact, one can say even more than
convergence – where the connection does converge, it is
Frobenius-equivariant for a natural Frobenius action on both fibers.
Lawrence and Venkatesh recall this idea in the work of Berthelot [ 9 ,
Prop. 3.6.4] . Let us follow suit.

For @xmath a number field, we denote by @xmath the ring of integers of
the completion of @xmath at @xmath , and if @xmath is a scheme over
@xmath , we denote by @xmath its special fiber. Write @xmath for the
residue field of @xmath .

###### Proposition B.3.4.

Let @xmath be a smooth and proper morphism of schemes over @xmath , for
@xmath a place of @xmath , and suppose that @xmath are points lying in
the same residue disc.

Then the formal solution to the Gauss–Manin equations between the fibers
of @xmath above @xmath and @xmath , which we denote by @xmath , can be
identified with the comparison isomorphism to crystalline cohomology of
the special fiber via the following commutative diagram:

  -- -- --
        
  -- -- --

(Note that the comparison to the special fiber endows the de Rham
cohomology groups above with a semilinear action of Frobenius, and
endows the crystalline cohomology with a filtration after tensoring to
@xmath .) In particular, @xmath converges in the whole residue disc. The
commutativity of this diagram is essential, because it says that the
Gauss–Manin connection is Frobenius-equivariant. This proposition, then,
is an analogue of the Tannakian interpretation of Coleman integrals by
Besser in a non-unipotent case – although it only works locally. It thus
plays an essential role in our extension of the Chabauty diagram to the
relative completion. We spell out this convergence for the entire
relative completion in Section 6.5 .

Finally, we relate one classical and one contemporary fact about vector
bundles.

###### Remark 40.

The astute reader might wonder what happened to the étale topology here.
The last section was so concerned that local systems on a scheme be
locally trivial in the étale topology. If we are aiming for a
Riemann-Hilbert correspondence that equates local systems and vector
bundles with integrable connection, then, why are our vector bundles not
described using local triviality in the étale topology? The reason is
the following statement, the third miracle of the étale topology that
we’ve seen thus far.

###### Theorem B.3.5.

There is an equivalence of categories

  -- -------- --
     @xmath   
  -- -------- --

induced by the inclusion of the Zariski site into the étale site. [ 86 ,
Tag 03DR ]

## Appendix C Stacks, Sites, and Pseudofunctors

As will have been clear by now, the arithmetic-geometric toolkit uses in
an essential way both the theories of stacks and non-archimedean
analytic spaces. After a brief review of stacks, we take this section to
introduce the Geometric Contexts of Porta and Yu [ 77 ] . Geometric
contexts will allow us to create a theory of stacks “modeled on” any
reasonable geometric theory.

Two brief comments: We have chosen to restrict ourselves to classical
(i.e. 1-truncated) stacks; hopefully non-homotopical readers will be
grateful. Second, we have taken the pseudofunctor approach to stacks
here since our eventual applications will be for moduli spaces.

The idea of a stack formed in the Grothendiek school from investigations
in moduli theory; indeed, early uses for stacks included the work of
Deligne and Mumford on the geometry of the moduli space of curves. The
aforementioned mathematicians, especially Artin, realized that many
moduli spaces could be exhibited as quotients of schemes. But a quotient
of a scheme might not be a scheme!

### c.1 Stacks and geometric contexts

If we’re going to use functors with values in groupoids, we had better
understand the collection of all groupoids.

###### Definition C.1.1.

A (strict) 2-category @xmath consists of the following data:

  (1)  

     A collection of objects, @xmath .

  (2)  

     For any two objects @xmath , a category @xmath . Its objects are
    called 1-morphisms of @xmath and its morphisms are called
    2-morphisms of @xmath . When one composes 2-morphisms in the
    category @xmath , one calls it vertical composition.

  (3)  

     For any three @xmath , a functor @xmath . The image of two
    1-morphisms is called their composition, and the image of two
    2-morphisms is called their horizontal composition.

This data must satisfy the following requirements:

The collection of objects and 1-morphisms, equipped with composition of
1-morphisms, forms a category.

Horizontal composition of 2-morphisms is associative.

The 2-identity morphism @xmath of the identity 1-morphism @xmath is a
unit for horizontal composition.

###### Example C.1.2.

The collection of groupoids, equipped with functors as 1-morphisms and
natural transformations as 2-morphisms, forms a 2-category.

###### Definition C.1.3.

Let @xmath be a 2-category. Then we say that a diagram

  -- -- --
        
  -- -- --

2-commutes if there is a 2-isomorphism (invertible 2-morphism) between
the top-right and bottom-left compositions.

If an object @xmath sits in a 2-commutative diagram

  -- -- --
        
  -- -- --

then we say that @xmath is the fibered product of @xmath and @xmath over
@xmath if, for any other 2-commuting diagram

  -- -- --
        
  -- -- --

there exists a 1-morphism @xmath such that the above diagram, now with
all maps from @xmath included, 2-commutes. In other words, @xmath
2-represents the functor of categories @xmath . This universal property
characterizes @xmath up to 2-equivalence, and in that case we write
@xmath .

###### Proposition C.1.4.

The 2-category of groupoids has 2-fibred products. If @xmath and @xmath
are groupoids with functors @xmath and @xmath , then their fibred
product is given explicitly by the formula

  -- -------- --
     @xmath   
  -- -------- --

  -- -------- --
     @xmath   
  -- -------- --

Now that we have this machinery we may introduce a notion that will
allow us to emulate the functor of points in the 2-categorical context.

###### Definition C.1.5.

A pseudofunctor @xmath from a category @xmath to a 2-category @xmath is
a map on objects and for any two objects, a map on 1-morphisms; for each
chain @xmath in @xmath there is specified a 2-morphism @xmath .

We may now begin to abstract the conditions for a good theory of stacks,
which will be based on the concept of a geometric context as defined in
[ 77 ] .

###### Definition C.1.6.

A geometric context @xmath consists of a Grothendieck site @xmath along
with a class of morphisms in @xmath satisfying:

-    Every representable presheaf on @xmath is a sheaf.

-    The class @xmath is closed under isomorphism, composition, and
    pullback.

-    Every covering in @xmath consists of morphisms in @xmath

-    For every morphism @xmath in @xmath , if there is a covering @xmath
    such that the composites @xmath are in @xmath , then so is @xmath
    itself.

###### Remark 41.

We have replaced Porta and Yu’s first condition on hypercompleteness
with the simple sheaf condition. However, by their Corollary 2.5 we have
that the two are equivalent for a 1-site.

We note that Porta and Yu use the following homotopical definition of
stack – the reader is welcome to look at the work of Hollander below for
the definition of a 2-sheaf.

###### Definition C.1.7.

A stack in groupoids on @xmath is a presheaf on @xmath valued in
groupoids that satisfies the 2-sheaf condition.

###### Definition C.1.8.

A classical stack in groupoids is a pseudofunctor @xmath such that all
descent data is effective [ 86 , Tag 02ZC ] and for any @xmath and any
two objects @xmath , the presheaf @xmath on @xmath is a sheaf.

We have the following theorem.

###### Proposition C.1.9.

( [ 53 , Theorem 1.1] ) A classical stack is a stack, and vice-versa.

Even though Porta and Yu use the language of higher stacks, we therefore
lose nothing by considering their theorems in the classical language of
stacks.

We will repeatedly use the following operation.

###### Fact C.1.10.

( [ 86 , Tag 0435 ] ) Given @xmath a category fibered in groupoids over
a site @xmath . Then there is a stack @xmath , called the stackification
of @xmath , which is universal in the following sense: there is a
1-morphism of categories fibered in groupoids

  -- -------- --
     @xmath   
  -- -------- --

and given another stack @xmath and a 1-morphism @xmath there exists a
1-morphism @xmath that factors the map @xmath . This property
characterizes @xmath up to unique 2-isomorphism.

The defining properties of stackification, up to unique 2-isomorphism,
are: First, given @xmath and @xmath , the map @xmath identifies the
latter functor as the sheafification of the former. Second, for every
@xmath there is a @xmath -covering @xmath of @xmath such that @xmath is
in the essential image of @xmath .

We can now define a geometric stack, based on the choice of a geometric
context @xmath . Do note that we use the notation @xmath for the Yoneda
functor of a sheaf ((-1)-stack) representable by an object @xmath , as
is common.

###### Definition C.1.11.

  Representability  

     A morphism @xmath of stacks is called representable if, for all
    stacks @xmath representable in @xmath and all maps @xmath , the
    2-fibered product @xmath is representable in @xmath .

  Properties of Representable Morphisms  

     A map of stacks @xmath is said to be in @xmath if it is
    representable and for any representable @xmath as above and map
    @xmath , the map @xmath is in @xmath . Note that, by
    representability and Yoneda, @xmath is in @xmath , so this condition
    makes sense.

  Effective Epimorphism  

     Let @xmath be a family of sheaves of groupoids on the site @xmath .
    We call this family an effective epimorphism if its Cech nerve is a
    simplicial resolution of @xmath . Fortunately, a theorem of Lurie
    says that a morphism of objects in an infinity-topos is an effective
    epimorphism if and only if the 1-truncation of the morphism is an
    effective morphism. The truncated version is unwound as follows. A
    family @xmath of sheaves of sets on @xmath is an effective
    epimorphism if for any @xmath the sequence

      -- -------- --
         @xmath   
      -- -------- --

    is an equalizer diagram.

  Atlas  

     An atlas of a stack @xmath is a family of representable maps @xmath
    from stacks which are representable in @xmath such that each map is
    in @xmath , and the map of sheaves @xmath is an effective
    epimorphism.

Intuitively, an atlas of a stack can be thought of as a space which one
wants to quotient by some equivalence relation to obtain the stack.

###### Definition C.1.12 (“Geometric Space” (0-Stack)).

We say that a sheaf on the site @xmath is a geometric space (the
analogue of algebraic space in our context) if it has an atlas of
representable stacks (representable by elements of @xmath ) and its
diagonal is representable. We say that a morphism of stacks is
representable by geometric spaces if the pullback by any test object in
@xmath is representable by a geometric space. We reserve the stand-alone
word representability for morphisms whose pullback by a test object is
actually representable in @xmath .

Do note that the terminology “geometric space” is non-standard, but it
accords closely with the use of the terminology “algebraic space” in the
classical context.

###### Definition C.1.13 (Geometric Stack (1-Stack)).

We say a stack @xmath is geometric if its diagonal morphism @xmath is
representable by geometric spaces and it has an atlas that is an @xmath
morphism from a representable stack (again, representable in @xmath ).
This second condition means that the atlas is representable by geometric
spaces, and also that for each test object @xmath , the geometric space
@xmath representing the pullback of the atlas by @xmath has its own
atlas @xmath such that the composition @xmath is in @xmath .

There are a couple of properties that one immediately wishes to check.

###### Proposition C.1.14.

Let @xmath be a 1-morphism of stacks in groupoids over @xmath that is
representable by geometric spaces. Let @xmath be a 1-morphism of stacks
in groupoids, not necessarily representable. Then the 2-fibered product
map @xmath is representable by algebraic spaces. Furthermore, if @xmath
has property @xmath , so does the pullback.

###### Proof.

Let @xmath be a test object and @xmath a test morphism; and consider the
pullback

  -- -------- -- -------
     @xmath      (C.1)
  -- -------- -- -------

On the other hand, considering the composition @xmath gives a pullback
@xmath which is representable by a geometric space by assumption. There
is a canonical isomorphism between the two pullbacks induced by their
universal properties, and thus the pullback ( C.1 ) is representable by
a geometric space.

The second statement follows in the same way. ∎

###### Proposition C.1.15.

Let @xmath and @xmath be maps of geometric stacks with property @xmath .
Then their composition has property @xmath .

###### Proof.

Let @xmath . Then @xmath , which one can see using the explicit
definition of 2-fibred product. Now @xmath is a geometric space by
assumption. For any second test object @xmath , we have that @xmath ,
which is again a geometric space by assumption. ∎

From our perspective in this work, for example when proving
representability of nonabelian Galois cohomology, we will want to know
when stacks in groupoids inherit the structure of algebraic stacks
simply by sitting in a long exact sequence. The following definition and
proposition give exactly such a criterion.

###### Definition C.1.16.

Let @xmath be a 1-morphism of stacks in groupoids on the site @xmath .
We say that @xmath is geometric if, for all representable stacks @xmath
and maps @xmath , the 2-fibre product @xmath is a geometric stack.

We have come to the key proposition, which is simply a translation of [
86 , Tag 05XX ] into the abstract language of geometric contexts.

###### Proposition C.1.17 (Geometric Morphisms Transfer Geometricity,
cf. Proposition 1.3.3.4 [90]).

Let @xmath be a geometric map of stacks in groupoids. Then if @xmath is
a geometric stack, so is @xmath .

###### Proof.

We create an atlas for @xmath as follows. By definition, @xmath has an
atlas @xmath . Now take the fibre product with @xmath ; by the
geometricity of the map, the fibre product @xmath is a geometric stack.
Thus it has an atlas @xmath , and we take the composition @xmath to be
the prospective atlas for @xmath .

We claim that @xmath is representable by algebraic spaces and belongs to
@xmath . It is representable because it is the pullback of a
representable morphism, and thus also has property @xmath by the above.
Now @xmath also has property @xmath by composition, and it is again an
effective epimorphism.

We have reduced to the following statement: Suppose @xmath is a
1-morphism of stacks in groupoids on the site @xmath . If @xmath is a
geometric space and @xmath is an effective epimorphism representable by
geometric spaces and in @xmath , then @xmath is a geometric stack. This
is [ 86 , Tag 05UL ] , which transfers verbatim to a general geometric
context. ∎

But our stacks will rarely come to us as stacks – rather, they will be
the stackification of a pseudofunctor. Fortunately, we have the
following useful fact ( [ 86 , Lemma 04Y1 ] ):

###### Fact C.1.18.

Stackification commutes with 2-fibered products.

Thus when we check representability in Proposition C.1.17 , we are
allowed to show that the stackification of the fiber of pseudofunctors
is representable by a geometric stack – this is easier than checking the
fiber of the stackification.

### c.2 Facts on quotient stacks

We will also need some basics on quotient stacks.

###### Definition C.2.1.

Let @xmath be a geometric space for a geometric context @xmath , and
@xmath a group geometric space in the same context acting on @xmath .
(In other words, we have a map @xmath that satisfies the usual
commutativity diagrams.)

The quotient of @xmath by @xmath is a stack in groupoids, denoted @xmath
. It is defined starting with the quotient groupoid

  -- -------- --
     @xmath   
  -- -------- --

for any test object @xmath and stackifying.

We also need the following proposition.

###### Proposition C.2.2.

Suppose that @xmath is as above, and additionally that @xmath has a
terminal object. Let @xmath be an object of @xmath and @xmath a group
object in @xmath acting on @xmath in the usual abstract sense. Then if
the map from @xmath to the terminal object is in @xmath , the stack
quotient @xmath is a geometric stack.

###### Proof.

By definition @xmath is a stack in groupoids on @xmath ; to prove
geometricity we follow the proof of the scheme-theoretic case, which is
[ 86 , Tag 04X0 ] . The crux of the proof is showing that the map

  -- -------- --
     @xmath   
  -- -------- --

is a smooth atlas. Let @xmath and @xmath be a test morphism. Then the
base change @xmath is locally of the form @xmath . This is because, by
the second fact of stackification, we may @xmath -locally on @xmath lift
@xmath to a point of @xmath , and then

  -- -------- --
     @xmath   
  -- -------- --

Now the base change of @xmath by @xmath is just the projection @xmath
But this projection is the pullback of the map from @xmath to the
terminal object, which is in @xmath by assumption. Thus the pullback is
also in @xmath , and we conclude that

  -- -------- --
     @xmath   
  -- -------- --

is an atlas. ∎

## Appendix D Rigid and Formal Geometry

### d.1 Definitions and properties

A wonderful exposition of formal schemes is the lecture notes of Bosch [
14 ] , which we follow. The origins of the theory, and a more technical
treatment, are in [ 33 , Chapter 1, Section 10] , and the Stacks Project
follows this approach [ 86 , Tag 0AHY ] .

###### Definition D.1.1.

We call a topological ring @xmath an adic ring if there exists an ideal
@xmath such that the topology on @xmath is the same as the @xmath -adic
topology, i.e. the topology whose system of neighborhoods of the
identity is given by @xmath . We call @xmath an ideal of definition for
@xmath , and write @xmath when we want to choose an ideal of definition
for @xmath .

We assume here that all adic rings are complete and Hausdorff. A formal
scheme should have a full structure sheaf’s worth of functions, with
only the special fiber visible in the underlying topological space. We
formalize this idea as follows.

###### Definition D.1.2.

  Local structure  

     The formal spectrum of @xmath , denoted @xmath , is a locally
    ringed space whose set of points is the set of open prime ideals of
    @xmath . Its topology is the one generated by sets of the form

      -- -------- --
         @xmath   
      -- -------- --

    The value of the structure sheaf on such an open set is given by

      -- -------- --
         @xmath   
      -- -------- --

    Any locally ringed space isomorphic to @xmath for some @xmath as
    above is called an affine formal scheme.

  Global structure  

     A formal scheme is a locally ringed space @xmath that has a
    covering by open neighborhoods which are isomorphic as locally
    ringed spaces to affine formal schemes.

  Morphisms  

     A morphism of formal schemes is a morphism as locally ringed
    spaces.

###### Remark 42.

If @xmath is quasi-compact and quasi-separated (cf. [ 86 , Tag 0AJA ] ,
[ 86 , Tag 0AJ7 ] ), the ideals of definition in each affine piece glue
to a global ideal sheaf of definition @xmath [ 94 , Proposition 3.32] .
This means that for each open @xmath , @xmath forms an ideal of
definition of @xmath . Any formal schemes dealt with in this work have
such a global ideal of definition.

This definition accords with the idea that only the special fiber should
be visible in the underlying set of points of a formal scheme: Since
@xmath is adic, a prime ideal is open if and only if it contains a power
of @xmath , for @xmath an ideal of definition. But such ideals are in
bijection with @xmath . The open-ideal formalism thus allows us to
dispense with a choice of ideal of definition.

Formal schemes have equivalent definitions as colimits of schemes over
the reductions @xmath for all @xmath . We freely use this description
below.

Finally, we discuss some properties of morphisms of formal schemes.

###### Definition D.1.3.

A morphism @xmath of formal schemes is called adic if, under the
canonical morphism @xmath , each ideal sheaf of definition of @xmath
generates an ideal sheaf of definition of @xmath .

### d.2 The formal geometric context

We now move to define the properties that will underpin formal stacks,
namely smooth morphisms. We will not need the étale site in the body on
this work, but we nevertheless describe it here because it is likely
important for future work on Selmer stacks, and it is a natural topic in
the study of stacks.

###### Definition D.2.1.

Let @xmath be an adic morphism of quasi-compact and quasi-separated
formal schemes, and write @xmath for the reduction of @xmath modulo
@xmath , where @xmath is an ideal of definition for @xmath ; these are
maps of schemes. We say that @xmath is an étale map if @xmath is etale
for every @xmath .

###### Remark 43.

Any morphism we use will occur in the simpler case where @xmath and
@xmath above are each adic over an adic ring @xmath , and @xmath and
@xmath are given by the reductions @xmath and @xmath .

We also pause to note that the notion of étale can be extended past adic
morphisms using lifting properties. For the more general definition
along with a proof that it agrees with the definition given above for
adic morphisms, see [ 88 ] .

###### Definition D.2.2.

We say that an adic morphism @xmath of formal schemes is smooth if
@xmath every reduction @xmath as above is smooth.

Again, this definition can be extended past the adic case, and the
differences between the two definitions are discussed in [ 88 ] . For
the proof of the next statement, see [ 86 , Tag 0DE9 ] .

###### Fact D.2.3.

Fix a formal scheme @xmath . The category of all formal schemes adic
over @xmath with adic morphisms between them and étale covering families
as covers forms a Grothendieck site.

This site satisfies all of the properties we know and love when it comes
to the big étale topology for schemes.

###### Proposition D.2.4.

The étale topology is subcanonical, i.e. the Yoneda embedding sends
formal schemes over @xmath to sheaves on the formal étale site.

###### Proof.

Let @xmath be a formal scheme over @xmath . Now the étale topology for
schemes is subcanonical ( [ 86 , Tag 03O3 ] ) and the colimit of sheaves
is a sheaf, and thus @xmath is a sheaf on the big étale site for
schemes. We are now reduced to the following fact: suppose that @xmath
is a presheaf on a site @xmath and that every element of @xmath can be
written as the filtered colimit of elements in a subsite @xmath . Then
if @xmath is a sheaf on @xmath , it is a sheaf on @xmath . We leave this
statement as an exercise for the reader. ∎

The key point is the following [ 95 ] . If @xmath is an adic ring, we
denote by @xmath the site of formal schemes locally finitely presented
over @xmath equipped with the étale topology.

###### Proposition D.2.5.

Fix an adic ring @xmath . Then the triple

  -- -------- --
     @xmath   
  -- -------- --

is a geometric context. The same is true if we replace étale morphisms
with coverings for the formal Zariski topology.

###### Proof.

  (1)  

    This is just Proposition D.2.4 .

  (2)  

    Closure under isomorphism is obvious. Closure under composition
    follows because if @xmath , @xmath factor through @xmath and @xmath
    , then we have the factorization

      -- -------- --
         @xmath   
      -- -------- --

    for the composition. Regarding pullbacks, if @xmath is any map, then
    @xmath factors via pullbacks of the factoring maps; pullbacks
    commute with factorization of maps.

  (3)  

    Each reduction @xmath is étale as a scheme map, and is thus smooth.

  (4)  

    The property of being étale is étale-local on the source for
    schemes, and this statement extends trivially to formal schemes.

∎

### d.3 Rigid analytic geometry and the generic fiber construction: from
@xmath to @xmath and back again

We have defined cohomology and Selmer stacks as functors on a certain
site of rigid varieties. However, the theorems that we will need on
moduli of representations of profinite groups are written in the
language of formal stacks. We thus show in this section how to transfer
results from formal stacks to rigid analytic stacks. We refer the reader
to [ 38 , Chapter 8] for the theory of rigid geometry.

For the remainder of this section @xmath will be a discrete valuation
ring of characteristic zero and @xmath will be its field of fractions;
@xmath denotes the category of rigid analytic varieties over @xmath .
When we use the word affinoid, we mean strictly affinoid, i.e. a
quotient of the Tate algebra @xmath . A rigid space is a locally @xmath
-ringed space @xmath that is locally isomorphic to spaces of the form
@xmath , where @xmath is a quotient of a Tate algebra and @xmath has the
Tate topology. We will often use the following construction.

###### Theorem D.3.1.

[ 25 , Proposition A.3.1]

There is an analytification functor

  -- -------- -- -------
     @xmath      (D.1)
     @xmath      (D.2)
  -- -------- -- -------

That satisfies the following property: Suppose that @xmath is separated.
If @xmath is affinoid then @xmath .

Fix a rigid variety @xmath One consequence of the above theorem is that
if @xmath is a contravariant functor on rigid spaces affinoid over
@xmath and @xmath is an admissible affinoid covering of @xmath such that
@xmath is representable by a scheme @xmath , then @xmath is
representable as a rigid space and is given over @xmath by @xmath .

###### Definition D.3.2.

A map of rigid analytic spaces @xmath is étale at @xmath if the
associated map of local rings

  -- -------- --
     @xmath   
  -- -------- --

is flat and unramified. We call @xmath étale if it is étale at all
@xmath . A map of rigid spaces is smooth if it satisfies the classical
Jacobian criterion [ 86 , Tag 01V9 ] , locally in the Tate topology.

###### Definition D.3.3.

[ 38 , Section 8.2] The big étale site on @xmath is defined as follows.
An object therein is a rigid space over @xmath , morphisms are usual
morphisms of rigid spaces, and a family of maps @xmath is deemed a
covering family if @xmath are étale and for any (equivalently, some)
choice of admissible affinoid coverings @xmath , we have that

  -- -------- --
     @xmath   
  -- -------- --

and this union is an admissible covering for the @xmath -topology on
@xmath .

Then we have the following fact, which follows identically as in the
case of schemes.

###### Fact D.3.4.

The big étale site of rigid analytic varieties over @xmath with smooth
morphisms as atlases forms a geometric context. If we replace étale
covers with covers in the Tate Grothendieck topology, then the resulting
category is a site.

###### Remark 44.

Whenever we mention a rigid stack in this work we are referring to
stacks in the Tate topology with smooth morphisms as atlases, but as we
mention the possibility of using the étale topology in the introduction,
we have discussed it here.

We now recall the rigid generic fiber construction, introduced by
Berthelot, which constructs a rigid analytic variety from a formal
scheme. On affine pieces, this takes an admissible @xmath -algebra
@xmath to @xmath , and one extends this construction to all formal
schemes by gluing. The key point is that two formal schemes which are
related by a so-called formal blowing-up have the same associated rigid
space. We remind the reader of the general theorem.

###### Theorem D.3.5.

[ 14 , Theorem 3]

Let @xmath be a complete valuation ring of height 1 with field of
fraction @xmath . Then the functor

  -- -------- --
     @xmath   
  -- -------- --

induces an equivalence between the category of all admissible formal
@xmath -schemes which are quasi-compact, localized by the class @xmath
of admissible formal blowing-ups, and the category of all
quasi-separated rigid @xmath -spaces that are quasi-compact.

Since the rigid generic fiber respects étale and smooth maps, we have by
left Kan extension an analytification functor from the 2-category of
formal stacks over @xmath to the 2-category of rigid stacks over @xmath
. By definition of Kan extension, this functor is computed using the
following 2-colimit formula: for @xmath a formal stack and @xmath a
rigid affinoid, then the rigid generic fiber of @xmath is

  -- -------- --
     @xmath   
  -- -------- --

Here the colimit runs over all morphisms from the generic fibers of
formal schemes @xmath to the test affinoid @xmath .

For us, the important claim is that the moduli problem of torsors is
respected by the operation of taking rigid generic fibers. We adapt the
discussion of [ 20 , Lemma 3.15(ii)] , with a sprinkle of [ 4 , Lemma
3.2.4] . For the next proposition, it is important to note that if a
profinite group @xmath acts continuously on the formal scheme @xmath ,
then functoriality furnishes a continuous action of @xmath on @xmath –
see [ 4 , Proposition 3.1.12] for a thorough explanation. Furthermore,
every such action arises from a @xmath -action on a formal model of
@xmath ( [ 4 , Lemma 3.2.4] .)

If @xmath is an algebraic group over @xmath and @xmath acts continuously
on @xmath , then we have an an obvious notion of continuous cohomology
groupoids @xmath on the site @xmath .

###### Proposition D.3.6.

If the stack @xmath on @xmath is representable by a formal stack then
its rigid analytification @xmath represents the stackification of the
pseudofunctor

  -- -------- --
     @xmath   
  -- -------- --

on affinoid @xmath -algebras.

###### Proof.

Stackification is also a left Kan extension, so it commutes with generic
fibers and we may deal only with the unstackified cohomology
pseudofunctor. Thus the universal property under question is that for
any affinoid @xmath -algebra @xmath we have a bijection

  -- -------- --
     @xmath   
  -- -------- --

where the colimit runs over all @xmath with rigid generic fiber @xmath .

First of all, there is always a continuous ring map from @xmath to
@xmath which induces the map above. To see surjectivity, consider a
continuous cocycle

  -- -------- --
     @xmath   
  -- -------- --

Now continuity and compactness of @xmath imply that the image of @xmath
lies in a compact subset of @xmath , i.e. in @xmath for some model
@xmath of @xmath

If @xmath is torsion free then @xmath is injective, as the map @xmath is
injective. Since every @xmath maps to a torsion free ring, then, the map
from the colimit is injective.

∎

Last but not least, we need the following statement on the
representability of quotients of rigid-analytic varieties.

###### Lemma D.3.7.

Let @xmath be a rigid-analytic space over a non-archimedean field @xmath
, and @xmath a rigid-analytic group that is flat and locally of finite
presentation over @xmath . Let @xmath be a rigid-analytic 0-stack over
@xmath (cf C.1.12 .) Assume that @xmath , @xmath , and @xmath have
formal models over @xmath . Then the quotient stack @xmath is
representable by a rigid stack.

###### Proof.

We take formal models for @xmath , @xmath , and @xmath , denoted @xmath
, @xmath , and @xmath , respectively. By the main theorem of [ 15 ] ,
@xmath may be taken to be flat over @xmath . In particular, letting
@xmath be the ideal sheaf of definition of @xmath and @xmath the
reductions of our formal schemes modulo @xmath , @xmath is flat over
@xmath and it acts on the algebraic space @xmath . By [ 86 , Tag 06FI ]
, @xmath is an algebraic stack over @xmath .

Now we have an equivalence

  -- -------- --
     @xmath   
  -- -------- --

because (2-)colimits commute. Thus @xmath is representable by a formal
stack over @xmath . The commuting of colimits also shows that

  -- -------- --
     @xmath   
  -- -------- --

because rigid generic fibers are given by the colimit along formal
models. We conclude that @xmath is representable by a rigid stack over
@xmath . ∎

###### Remark 45.

All of the rigid stacks in this work have underlying formal models,
owing to the fact that Wang-Erickson’s representation stacks are given
by him as formal stacks; furthermore, all constructions in Theorem 4.0.1
can be done using constructions on formal models (and often the
rigid-analytic theorem we cite was proven by reduction to formal model.)

One approach which does not work is naively assuming that all rigid
stacks with diagonal representable by rigid varieties have formal
models, as we see here: Suppose, indeed, that the diagonal of @xmath
representable by rigid spaces – not by 0-stacks. We might think that we
obtain a formal model of a rigid stack @xmath with presentation @xmath
by taking formal models of @xmath and @xmath , which yields a stack in
groupoids over @xmath which is easily seen to have rigid generic fiber
@xmath . Unfortunately, smooth rigid spaces do not necessarily have
smooth formal models [ 14 , p. 225] , so the resulting groupoid may not
be a formal stack.

### d.4 Strat-representability

We now introduce the idea of strat-representability. This concept does
not seem to have been named in the past, but it is encountered in work
of Toën [ 89 , Corollary 3.3.4] . We use Rydh’s definition of
stratifications of stacks [ 81 ] ; see [ 39 , Definition 5.2.1.1] for
more discussions on stratifications of stacks.

For a rigid stack @xmath , we let @xmath denote the set of morphisms
@xmath , where @xmath is a finite extension of the base field of @xmath
, with the equivalence relation given by equating two morphisms @xmath
from @xmath if there exists another finite extension @xmath over the
base field and a 2-commutative diagram

  -- -- --
        
  -- -- --

See [ 86 , Tag 04XE ] for the algebraic case, which easily generalizes
to the formal case.

###### Definition D.4.1.

A stratification of an algebraic, formal, or rigid stack @xmath is a
sequence of finitely presented closed substacks

  -- -------- --
     @xmath   
  -- -------- --

such that @xmath .

The theorem we will need is [ 81 , Theorem 8.3] :

###### Theorem D.4.2.

Let @xmath be a quasi-compact and quasi-separated algebraic stack and
let @xmath be a morphism of finite presentation. Then there is a
stratification

  -- -------- --
     @xmath   
  -- -------- --

of @xmath such that @xmath is flat over @xmath for all @xmath .

Since the rigid generic fiber respects closed immersions and is
point-preserving, a stratification of a formal stack induces a
stratification of its generic fiber.

In the below definition, we allow any Grothendieck topologies on the
site of schemes, formal schemes, or rigid varieties.

###### Definition D.4.3.

We say that a stack @xmath on the category of schemes (resp. formal
schemes, rigid varieties) is @xmath -strat-representable if @xmath is
representable as an algebraic (resp. formal, rigid analytic) stack.

We say that a tower

  -- -------- --
     @xmath   
  -- -------- --

is @xmath -strat-representable if @xmath is @xmath -strat-representable
and for every affine scheme (resp. affine formal scheme, affinoid rigid
analytic variety) @xmath and morphism @xmath there is a finite
increasing sequence

  -- -------- --
     @xmath   
  -- -------- --

of closed immersions such that the towers

  -- -------- --
     @xmath   
  -- -------- --

are @xmath -strat-representable. If @xmath is obvious, we just say that
the tower is strat-representable.

We will say that a single stack @xmath is strat-representable if it fits
into a strat-representable tower. Finally,

  -- -------- --
     @xmath   
  -- -------- --

is a pro-stack such that any finite truncation is strat-representable,
we say that the pro-stack is pro-strat-representable.

We will informally say that the locally closed subspaces @xmath are the
“pieces” of the stratification.

A key example to keep in mind is the following. Let @xmath be the
category of algebraic, formal, or rigid stacks.

###### Example D.4.4.

Let @xmath be a Noetherian stack in the category @xmath , and @xmath a
coherent sheaf on @xmath . Then @xmath can be viewed as the “total
space” @xmath on @xmath ; this stack associates to any @xmath the
groupoid @xmath . We will show that

  -- -------- --
     @xmath   
  -- -------- --

is strat-representable.

Let @xmath be an atlas. There exists a stratification @xmath of @xmath
such that @xmath is locally free over @xmath for every @xmath [ 86 , Tag
051S ] . Setting @xmath , @xmath is free over @xmath for every @xmath .
Write @xmath for this restriction. Now @xmath is represented by the
sheaf @xmath over these complements. This follows because, for locally
free sheaves, pullback commutes with dual. Such representability holds,
in fact, if and only if @xmath is locally free! (See [ 73 ] .) This is
why we can’t do better than strat-representability in general.

In fact, representability of total spaces of locally constant sheaves
works perfectly in the rigid context. The following construction is a
special case of relative analytification, cf. [ 25 , A.1] .

###### Example D.4.5.

Let @xmath be a rigid-analytic space, and @xmath a locally constant
sheaf of @xmath -modules. Then the total space functor is representable
as a rigid-analytic space over @xmath .

Let @xmath be an admissible affinoid covering of @xmath such that @xmath
on @xmath . The gluing data for @xmath extends to gluing data of @xmath
, and thus to gluing data of @xmath . This produces a rigid space @xmath
over @xmath ; it represents the total space functor because of the
classical identity @xmath .

###### Remark 46.

Kobi Kremnitzer has suggested that the “correct” framework for
strat-representability is in derived geometry. Indeed, if @xmath is a
smooth scheme then any coherent sheaf on it has a finite resolution by
locally free sheaves of finite type; in other words, it is dualizable.
Then the total space functor is represented by the spectrum of the
symmetric algebra of the dual, now interpreted in the derived sense.